/*
活动名称：批量店铺签到（活动查询）
活动链接：https://h5.m.jd.com/babelDiy/Zeus/2PAAf74aG3D61qvfKUM5dxUssJQ9/index.html?token=<token>
环境变量：jd_dpqd_tokens // 活动令牌，多个用英文逗号，@，&，换行分割

查询活动信息主脚本，IP限制严重建议使用代理，请勿频繁运行
自动去重并过滤无效活动，默认过滤垃圾奖品活动
运行后会在本地目录生成缓存文件以用于签到脚本使用

cron:1 1 1 1 *

*/

const $ = new Env('批量店铺签到（活动查询）')
var iｉl='jsjiami.com.v7';const I1lIli=iii1II;(function(li1i1I,illIii,ii1il1,lI1llI,illIil,Ill1I,i11iiI){return li1i1I=li1i1I>>0x9,Ill1I='hs',i11iiI='hs',function(lIli11,lllI1I,lillI1,IlIlii,i1l1i1){const I1lIll=iii1II;IlIlii='tfi',Ill1I=IlIlii+Ill1I,i1l1i1='up',i11iiI+=i1l1i1,Ill1I=lillI1(Ill1I),i11iiI=lillI1(i11iiI),lillI1=0x0;const liil11=lIli11();while(!![]&&--lI1llI+lllI1I){try{IlIlii=-parseInt(I1lIll(0x271,'OK4@'))/0x1+parseInt(I1lIll(0x1bf,'ju6V'))/0x2*(-parseInt(I1lIll(0x246,'LX%B'))/0x3)+parseInt(I1lIll(0x1e1,'iCqH'))/0x4+-parseInt(I1lIll(0x248,'lN(3'))/0x5*(parseInt(I1lIll(0x1c1,')biV'))/0x6)+parseInt(I1lIll(0x27b,'7Qc#'))/0x7+parseInt(I1lIll(0x1e9,'#Hmi'))/0x8+-parseInt(I1lIll(0x255,'x^GZ'))/0x9*(-parseInt(I1lIll(0x1cc,'srG%'))/0xa);}catch(iiillI){IlIlii=lillI1;}finally{i1l1i1=liil11[Ill1I]();if(li1i1I<=lI1llI)lillI1?illIil?IlIlii=i1l1i1:illIil=i1l1i1:lillI1=i1l1i1;else{if(lillI1==illIil['replace'](/[nhrgVEAIbwdWQGMXNT=]/g,'')){if(IlIlii===lllI1I){liil11['un'+Ill1I](i1l1i1);break;}liil11[i11iiI](i1l1i1);}}}}}(ii1il1,illIii,function(l1l111,l1iIII,llI1I1,IlIlil,lIli1I,II1il,lllI11){return l1iIII='\x73\x70\x6c\x69\x74',l1l111=arguments[0x0],l1l111=l1l111[l1iIII](''),llI1I1=`\x72\x65\x76\x65\x72\x73\x65`,l1l111=l1l111[llI1I1]('\x76'),IlIlil=`\x6a\x6f\x69\x6e`,(0x15eb80,l1l111[IlIlil](''));});}(0x19800,0xe658a,Iii11l,0xce),Iii11l)&&(iｉl=I1lIli(0x281,'@gPS'));const common=require('./utils/Rebels_jdCommon'),{H5st,jsTk}=require('./utils/Rebels_H');console[I1lIli(0x233,'LX%B')](''),console[I1lIli(0x260,'l9zm')](I1lIli(0x1b9,']j4r')+$[I1lIli(0x191,'GUFp')]+'变量说明=========='),console[I1lIli(0x16a,'(Aam')]('jd_dpqd_tokens\x20//\x20活动ID，多个用英文逗号分割'),console[I1lIli(0x1a9,'hieY')](I1lIli(0x26f,'2z4e')+$[I1lIli(0x1ed,')TOd')]+I1lIli(0x262,')biV')),console[I1lIli(0x25d,'mRK7')]('');let tokensList=(process[I1lIli(0x1dc,'8J9Z')][I1lIli(0x16d,'vAq6')]||'')['split'](/[,@&|\n]+/g)[I1lIli(0x27d,']j4r')](Boolean);const printEnvValue=process[I1lIli(0x20f,'1lAY')]['jd_dpqd_print_env']===I1lIli(0x1e5,'ju6V');function Iii11l(){const ii1ilI=(function(){return[...[iｉl,'XMjwAEsgjWdiEahVmXiNb.GcwogXmnT.dwvMI7Qr==','A1fjW6FcSG','fJldNCohcG','WQyUuX4rW6pdHCoAu28','WPldUJK','WPFcUCoHgJu','WOPUW5VcUdVdTfO8lmonkmocW4PncqG','z8kRWRe','meldSCkYqCkTcha','y1D4W4e','WRfCWOxdJSo6','5B+J5AEW5PwN6zss776Q','kKmC','ACozga','W65eW6ZcNNH+','WQJdI8kdn2m','ru1JW47cVa','lL7dVmkDqCkOhG','5ysAy+wmTG','ySocgv7cPSoB','Dmong8kE','4P2ydUAFO+EERUISREAXKuS','v+E7UoAFGoAuIoMxKo+/Gq','WRZcU8oI','W6rcW6FcR29+','W7z8lMy','WR1ZWQ3dHq','z2fgW77cGG','WRzHWPpcOuhdTSo+','W4NcNCkB','vmoJWQVdMCkfWR3dHGC','WQiZqG','WOrEW6xcP8otWPhcH8onrKxdNYKlpv0','WQFdR2ZdNJC','WPmzpSk1WPnmW6BdS3ebW5ddV8ofW6dcUq','oGxcUSkuW7C','W55CW5y','WPNdNCoyWQy2WQKzg2W','ymovh0dcVCotvgddVhpcMq','5RwI5yUO5Bo65z+yWO4','uItcH0OCW5C','WPrYW5BcGhxdJx5NiCoDCCodW6WrcW','W75iW67cJNH+fgO','W6DLW4FcMCkl','vKHUW6RcIW','kKRdTSkk','vqZdLG','m+E7SEADLo++PEs7JUAULUAxLoEdVEACHUwtJ8kBW74','BGldJ8k8','n0KG','WPrrW7/dLSkD','WRZdPSoBWOyE','WODcr8oCnSk9','aNBdSWi','tow7LUIVLEENUEMAGUEzUEA0MUwiTE++RG','WOmbWOpdJmkdbtJdHXGF','4P6XWOhMNAdOGPtMRytNOzRLPzJNKjhcTW','WOrfWR7cPt0ZWR9vWPC','hCk+WQ/dTCkWkI5BuSkbeZLK','5Q+V5PE+562q5yIb','W4zAW5ZcNG','WQZdU2VdVWC','oI/cKSkeW4DnwSo0h8k+WQtdUeVcPSkIWQ8wWPZcGmoZW7i','WQ08oZtcHa','BHxcTW','WRhcICoxbsi','WPhdVI1JWOe','WPZdM8ooWO8','5Q+95Pwu56235yIz','agmVBSkH','WRpdJrZdINJcTmk2WQW3','pIRdJ8oE','5yAV57Im5y64','4PU9c+ATKoAVN+I/ToIIL+s9T+IMMUEzSos7IEwkGoEAPUE+HEwUVEAuL+s5T++9VEITJoAXG+AgUEwMQos5Ro+8LG','D8ofghS','tSoJWQVdMSkuWQC','yYddH8kBDG','F8ofqgzt','s8klWO4','uSkuWOddKru','W5qxW7/cTq4cWQ9uWRddMG','WPnzW4i','WOJdH8ooWOqPWQWJaW','5O2v56wY57I85P+oqW1uW6VdV8o+rKH0WQu','WQ19WR/dK8oU','WR9WWP3dHCoZ','yCowdmkIW4zXWRK','qCofAf1JiG','W7b8ia','WQLNWQFdNG','W7lcTcyRsG','WRbUW7VcMf4','WQaCCmk1W5m','WPLtWRZcPCo+W4NcLmotaNNdHW4wyentWOBdKmkE','hNGmq8kX','WR8+gYBdQ8kmDa'],...(function(){return[...['oSknvI7dQmkbgrpcOcm','dhldS8kvBa','f07cLqFcRZzCiMaaWQdcSCke','FLmHA8oc','r2fhqq/cGqHQfuddO8oBimoVWOxdJIO','j18iA8kbWPm','q156lLzDea','WRNdMMRdVZy','W5qhW7JcTr8f','WOviqSoDpCoYWR19','W7VcVHuaBSkTW5RcKq3dLCkXWOldSa','WR53WQddT8oJiuNdQhmLztGcW4RcJG','f8kWW7BcHmosW7/dIaZdTmoRW5G2','oHZdKmo0bq','Fu0BtCopWPC','W5beW5BdGCktr380sHdcN8k4WPqqWP/dVSovqt3cUq','AbvHW5L2d1pdQmkJW7vsWRWD','WPZdNmouWP0J','WQuZtXyCW6FdImk1u3rbrJ4B','WRNdRCo5WQqH','WQVdOG5lWR4','WRb9WQa','BqpdKmkZB0VdVmkFWRVcUq','roEpSowGV+wnRUMgQo+/Qq','vKvTeG','xSoEBG','dUITU+AZMUwNTEI2PJNINOqY5PEw5zcA5BUc5PsK5O2D','WRhdPJX0WOu','WRi/maRcRSkozh3dVCopt8kzWOqN','WPDXWRpdGmof','ELv2wfy','WO/cLvldPLTWWQT0WRpcMCowz8k6','W4VcVGCeBG','tSoYafxcVq','WRtcNeZcMd0','BbNdKSkICbJcT8oXWRNcVqKVdCoQW6KbE3qFWPKQW7ldKmkg','WQNdL3ldTXZdVGldRCopl8kuW55ZCK3dMaulW5OY','WR7dJIqDqLOOoSodW5rZWPm','W50aW7/cRaTrW7qcWPhcI8kAzqpcKmo+iCornmoXWRK','t8oVW6ZcRCo1CgXRzCkJnYbgW6K','uCoQagxcHq','xqldHqi','W6KNWOG','yCokgSk7W5X7','uL91h1e','smoPWQZdKW','W7GBW7lcIda','W5XbW7ZcVCkA','jdddLCoy','WOXrWPddTCoN','zLVcPs7cQq','W5xcGmkvaSo1WQpdOCogW5VcRxDboW','WOVdI8ojWQyLWQ0KaxBcRSk0WQ7dQbOt','WRe1gq/cSSkwzgpdQSou','W6rcW6C','WPb4W4BcPa','mutdUa','AmkCWRldGYm','W69MjgSwWQldPW','WR/cLvFdPG','WRKOhaFcUCkr','vfvVd1Pdaq','sHldHa','W7BcUuNdUfO','chBdPXq','W6fdW7BcI3fLou8EWPO','DKeqsCoB','WRq0ca','rhPxqG','iUIUJEAyPoAoKCoGWQ7MIkdKV6hNLQpKU5xNKR0','uHtdJLu','W59wW4lcImkslq0','q8oOWOJdT8kI','nuKW','qWBdHWFdSq','nexdQCkFsmkYcv3dHCo2','W5/MTi3LIi3LTAZNUlJNU6tMNzhKU5y','sNrhxW','WQ/LUiJORzlNPOpPM7tNMBxMTQ/LIilVVQq','W6viW7pcMxXRoa','rvDDW63cHa','WRTIWPpdNSoH','FudcVs7cQfaogxj2chjMnfTfW7FdHW4h','A1eeuq','WPxdHcSnqKyV','WRlcThldOfW','FxWbDmoO','sSk9WOq6dG','tmkbWOi','WQFdTgFdMXS','W7P2fKzpWRRdPSo0u3zllq','W6ePWPBdOG','5BQq6zgk56Ae5yIv','kM4wB8kp','smoujwdcNq','tSoPWQi','wSoAq2XI'],...(function(){return['BUE6JoAFO+++UUs5RoAVKUAxIoEbHEACSowtMWz+','qINdKepdLq','t8ocWP3dI8kk','W43cOH0','WP94W4u','5l2b5OkG5yUe','vmo5W6hcNCoI','jHLkbmkxW5JcJcNdTCoi','WOiaySkoW7a','uHJdM0tcSN8ab3mN','xSkwW5NcJmor','DX1oE8kJWQvfW6xdMG','xKWptmoG','Cb5onSkjWOHLW7xdHai','WO7dSftdQaO','WR14W5JcOezMgSkZWRBcJI0','WR/dVCkW','sbldMwpdTG','WPO2FYKW','W4JcTXKcF8o2DXddLSoBCCoRbmohW4fmW6fYD8k7WP3cNGpdJM/dQNdcQhuFW7JdIHf2eJddTcpdM8o9WQ3dPhpcGmoSp2tcSXNdKsjtWOzGiItcOmkmWRKBWP7cVbaoWPjprCoAwYldJfBdVG','WPNdGHKnvG','WPaDm8kh','WPvdW6VcG8o/','W7b2kw8hWRK','k07dQSk9Fa','nvGjA8kiWPPiW7VdJq','jXBdUh7dQYmIa0Hrg24','W7hcIZtcPr7dKdhdNmo+cG','WOe+xq','vqBdNWtdNmk9','th5avLFdIq','WO/dO8ovWQSK','WPTEW6JcLKy','o0FdSmkrvG','pfqLWOe2','WQmVqG','4PMnCEIVJEwgNowSMUs7N+w/GoIKQEEAJoEoL+wIMEwoI+MhG+wqJUweOoI+SoIJHUIgREAFUo+8RW','WPxMTy/LIkpLTk7NURFNURJMNOtKUQS','m2ddMHZdSq','W4ZcRaO','WR/cM03dOG','4P6/n+AEIoIaVoATTEEJL+wKK+EqL2G','W4xcRrS','WQ/cLvldPLS','jZhdISoxc8kArCk9nSki','WObgwCo3oCoTWPe','oh4EWQGq','W4DoFCofW4mlWRNdJhWJW6ZdM8o8','WPPeW5FdK8keua','WR7dS8kN','WRhcIvBdRuueW6K2W68','mL4ozW','vw1FW4xcGG','qvvQo1Xehf9nW5BdSIfrzxu','WOPyWPZdOSkTexddJ14zkq','W6RdIaJcSWCmW6OWWR7cICozrCk8W5G','kJ7dHCof','WPGtlq','tCoJW7ZcOq','FunMW4W','5P+X55Y75AEa5zkq772z','W69iW7tcQ354nhGuWPPqW4JcKffQ','wmkOWOpdOGG','WP1IW4/cO3pdIW','F01S','fwpdUbJdJKddPqr2','kJtcJSkzW4berSo3nG','W5FcHIGFqW','y8oreMa','kutdTmkBsG','WOpcISoHeay','W4WtW6ZcLXu','AWNcHSksW4xcL1i','8ykBL2O','WQVcIfddUva','W7VMT4hLIPhLTBhNU7RNU6BMNOBKUOa','5RE75yIr5BE05lICtG','tXpdL1xdR24peKuQWPxcR8kZWO7cSCkZiSkCWROoFc/dPSo9WPebuI7cRW/dVxqhv8kAjsJdP8o9zq','tqZdMGBdHG','WO3dJCojWO4WWRa5dLBcVG','WPzYW4tcG8oL','W7bzW5hcVKS','aoIVRoAXRowKGoI0HSkb4P+WlW','W7JcS8oQ','A8oFda','tdtcH2GgW5S','WPvzW4ZdSa','4PYcF+IgPUAEMUI+T+IIV+MbPUwlJos7K+MxPEIUL34','WQtdUCkUpfmTmSkA','AmkCWOFdRbq','qtlcNwyeW5POWPTEaW','WQSHur4','smk1W7K','WQxdL3a'];}())];}())];}());Iii11l=function(){return ii1ilI;};return Iii11l();};let TokensMap=null;const CacheFile=__dirname+I1lIli(0x27e,'l9zm');!(async()=>{await Main();})()['catch'](liIii=>$[I1lIli(0x227,'X@dj')](liIii))['finally'](()=>$[I1lIli(0x18c,'#Hmi')]());function iii1II(_0x2572ab,_0x4cdfae){const _0x2ad483=Iii11l();return iii1II=function(_0xd3c898,_0x3c9026){_0xd3c898=_0xd3c898-0x16a;let _0x39dcd5=_0x2ad483[_0xd3c898];if(iii1II['WwddkU']===undefined){var _0x484878=function(_0x244a22){const _0x9991a0='abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789+/=';let _0x2aca9e='',_0x280386='';for(let _0x43f2b6=0x0,_0x20541f,_0xaa62b,_0x11dd3c=0x0;_0xaa62b=_0x244a22['charAt'](_0x11dd3c++);~_0xaa62b&&(_0x20541f=_0x43f2b6%0x4?_0x20541f*0x40+_0xaa62b:_0xaa62b,_0x43f2b6++%0x4)?_0x2aca9e+=String['fromCharCode'](0xff&_0x20541f>>(-0x2*_0x43f2b6&0x6)):0x0){_0xaa62b=_0x9991a0['indexOf'](_0xaa62b);}for(let _0x1fb393=0x0,_0x532746=_0x2aca9e['length'];_0x1fb393<_0x532746;_0x1fb393++){_0x280386+='%'+('00'+_0x2aca9e['charCodeAt'](_0x1fb393)['toString'](0x10))['slice'](-0x2);}return decodeURIComponent(_0x280386);};const _0xa96541=function(_0x5bb3b8,_0x4e7482){let _0x2af1d1=[],_0x282742=0x0,_0x133767,_0x178730='';_0x5bb3b8=_0x484878(_0x5bb3b8);let _0x5ee46f;for(_0x5ee46f=0x0;_0x5ee46f<0x100;_0x5ee46f++){_0x2af1d1[_0x5ee46f]=_0x5ee46f;}for(_0x5ee46f=0x0;_0x5ee46f<0x100;_0x5ee46f++){_0x282742=(_0x282742+_0x2af1d1[_0x5ee46f]+_0x4e7482['charCodeAt'](_0x5ee46f%_0x4e7482['length']))%0x100,_0x133767=_0x2af1d1[_0x5ee46f],_0x2af1d1[_0x5ee46f]=_0x2af1d1[_0x282742],_0x2af1d1[_0x282742]=_0x133767;}_0x5ee46f=0x0,_0x282742=0x0;for(let _0x587920=0x0;_0x587920<_0x5bb3b8['length'];_0x587920++){_0x5ee46f=(_0x5ee46f+0x1)%0x100,_0x282742=(_0x282742+_0x2af1d1[_0x5ee46f])%0x100,_0x133767=_0x2af1d1[_0x5ee46f],_0x2af1d1[_0x5ee46f]=_0x2af1d1[_0x282742],_0x2af1d1[_0x282742]=_0x133767,_0x178730+=String['fromCharCode'](_0x5bb3b8['charCodeAt'](_0x587920)^_0x2af1d1[(_0x2af1d1[_0x5ee46f]+_0x2af1d1[_0x282742])%0x100]);}return _0x178730;};iii1II['iEtNQT']=_0xa96541,_0x2572ab=arguments,iii1II['WwddkU']=!![];}const _0x32ec12=_0x2ad483[0x0],_0x4e43fb=_0xd3c898+_0x32ec12,_0x1ecc89=_0x2572ab[_0x4e43fb];return!_0x1ecc89?(iii1II['lygkNJ']===undefined&&(iii1II['lygkNJ']=!![]),_0x39dcd5=iii1II['iEtNQT'](_0x39dcd5,_0x3c9026),_0x2572ab[_0x4e43fb]=_0x39dcd5):_0x39dcd5=_0x1ecc89,_0x39dcd5;},iii1II(_0x2572ab,_0x4cdfae);}async function Main(){const II1ii=I1lIli,II1ll1={'uIUeU':II1ii(0x19f,'RE)5'),'lBmmi':'活动已结束\x0a','LgNXh':function(IlI1Ii,i11I1I){return IlI1Ii<=i11I1I;},'mYmIE':'Rebels','CBiuE':II1ii(0x1c5,'8J9Z'),'MoyTH':II1ii(0x1e8,'&HOW'),'IuyOw':'3.2.1.0','ugTZZ':function(l1il1i,ll1){return l1il1i<ll1;},'Xmaqm':function(iI1llI,llliii){return iI1llI(llliii);},'asmwE':function(IllI11,l1llIi){return IllI11>l1llIi;},'WJwoq':function(II1llI,i11I11){return II1llI-i11I11;},'hNQxz':function(l1llIl,ii1I1l){return l1llIl===ii1I1l;},'RwKYF':'bsCtB','mDXvj':II1ii(0x270,'EIaR'),'bpGha':II1ii(0x215,'ZfQI'),'ZNXiu':function(ii1I1i,llI){return ii1I1i!==llI;},'EjeCN':II1ii(0x1d2,'ZfQI'),'tCMWG':II1ii(0x20b,'hieY'),'anMJB':function(llliI,iI1li1){return llliI===iI1li1;},'mBUBF':'，已发完','dTssH':function(lllii1,liIli){return lllii1>liIli;},'NIRzd':II1ii(0x21e,'fIDb'),'Vohgy':function(liIll,IilIi1){return liIll!==IilIi1;},'dcSdq':'RLOQk','tClBb':II1ii(0x1e0,'a%!1'),'xtQTV':'sSxYu','EhxuJ':function(iI1liI,l1lIiI){return iI1liI>l1lIiI;},'UCDCg':II1ii(0x18a,'hieY'),'ewVRh':II1ii(0x1a1,')TOd'),'lFRbD':'缓存写入完毕，所在目录：','veuCX':function(llliiI,IilIiI){return llliiI!==IilIiI;},'FOTlG':'JjLfG','UVvbx':'\x0a环境变量：','nozSk':II1ii(0x1d1,'0D$B'),'xFfFi':function(i1i1I1,IlII1){return i1i1I1!==IlII1;},'lLtth':II1ii(0x19b,'t$KY')};try{if(tokensList[II1ii(0x25a,'7Qc#')]>0x0)tokensList=[...new Set(tokensList[II1ii(0x21d,'X@dj')](lll=>lll!==''))];if(II1ll1['LgNXh'](tokensList['length'],0x0)){console[II1ii(0x22c,'RE)5')](II1ii(0x1d6,'!htJ'));return;}TokensMap=new Map(tokensList[II1ii(0x1c2,'fIDb')]((llli1,iIli1i)=>[llli1,{'index':iIli1i+0x1,'venderId':'','shopName':'','activityId':'','startTime':'','endTime':'','isValid':!![],'rules':[],'minLevel':null,'maxLevel':null}])),console[II1ii(0x213,'p6BW')](II1ii(0x258,'EIaR')),console[II1ii(0x25d,'mRK7')]('🏬\x20开始查询\x20'+tokensList[II1ii(0x207,'@X3T')]+'\x20个店铺');const IiI11=[];console[II1ii(0x260,'l9zm')](''),$['UA']=common['genUA'](II1ll1[II1ii(0x1a8,'mRK7')]),{jsToken:$['jsToken']}=await jsTk($['UA'],II1ll1['CBiuE'],{'bizId':II1ll1[II1ii(0x17f,'lN(3')],'v':II1ll1['IuyOw'],'qs':II1ii(0x243,'2pS#')+tokensList[0x0]});for(const iI1lii of tokensList){let IilIii=!![];$[II1ii(0x17d,'nQsD')]=iI1lii;let iI1lil=0x0;$['getActivityInfo']='',$[II1ii(0x186,'vAq6')]=![];const l1lIi1=0xa;while(!$[II1ii(0x1ef,'X@dj')]&&II1ll1[II1ii(0x24e,'vAq6')](iI1lil,l1lIi1)&&!$[II1ii(0x1de,'qbG#')]){$[II1ii(0x27a,'&HOW')]='',await II1ll1['Xmaqm'](sendRequest,II1ii(0x231,'iCqH')),await $[II1ii(0x23c,'EIaR')](0x3e8),iI1lil++,II1ll1['asmwE'](iI1lil,II1ll1['WJwoq'](l1lIi1,0x1))&&(II1ll1[II1ii(0x219,'&HOW')](II1ll1[II1ii(0x269,'8J9Z')],II1ll1[II1ii(0x1b4,'7Qc#')])?iillli[II1ii(0x1b6,'ZfQI')](I1l1Ii[II1ii(0x263,'&HOW')]+'\x20活动信息获取失败'):(console[II1ii(0x19a,'a%!1')](''+$['TokenErrorMsg']),$['errMsg']=''));}if(!$[II1ii(0x1e7,'nQsD')])continue;const iIli1l=$[II1ii(0x238,'ZfQI')]['venderId'],i1i1II=$[II1ii(0x185,'0D$B')]['id'],liiIIl=$['getActivityInfo'][II1ii(0x178,'pOe^')],iil1iI=$['getActivityInfo'][II1ii(0x24d,'c(Ol')]||[],IlIllI=$['getActivityInfo'][II1ii(0x184,'RE)5')]||[],il1i1I=$['getActivityInfo']['startTime'],lI1li1=$['getActivityInfo'][II1ii(0x265,']oYR')],iI11II=$[II1ii(0x24b,'LX%B')](II1ll1[II1ii(0x1a2,'&HOW')],il1i1I),iIII1I=$[II1ii(0x197,'OK4@')]('yyyy-MM-dd\x20HH:mm',lI1li1);let ilil1i=![];const IlIIi=[],IiI1l=[...IlIllI,...iil1iI];for(const lil11l of IiI1l){if(II1ll1[II1ii(0x16f,'gArS')](II1ll1[II1ii(0x23b,')TOd')],II1ll1['EjeCN']))I1i111[II1ii(0x18d,'vAq6')](ilI1li,IIliI);else{const I1lIl1=lil11l['level'],lil11i=lil11l['prizeList']||[],IlIIl=[];for(const lI1liI of lil11i){if(II1ll1['hNQxz'](II1ii(0x1a7,']j4r'),II1ll1[II1ii(0x22a,')TOd')]))iii1Il[II1ii(0x259,'2z4e')](lI1IiI),i1lI=![];else{let lllii='';const iI11Ii=lI1liI[II1ii(0x261,'0D$B')],iIII1l=lI1liI['type'],lllil=lI1liI[II1ii(0x1f1,'ZfQI')],iI11Il=lI1liI[II1ii(0x266,'(Aam')],iIII1i=II1ll1['anMJB'](iI11Il,0x5);switch(iIII1l){case 0x1:lllii=II1ii(0x1b7,'c(Ol');break;case 0x4:lllii=iI11Ii+'京豆';break;case 0x6:lllii=iI11Ii+II1ii(0x1ad,'2z4e');break;case 0x9:lllii=''+lI1liI?.[II1ii(0x175,'1lAY')][0x0]?.[II1ii(0x1df,'2pS#')];break;case 0xa:lllii=iI11Ii+II1ii(0x221,'a%!1');break;case 0xe:lllii=iI11Ii/0x64+II1ii(0x257,'0D$B');break;default:lllii=II1ii(0x1ee,'E6Kn')+iIII1l+'）';}if(![0x1,0x6]['includes'](iIII1l)&&!iIII1i)ilil1i=!![];IlIIl['push'](lllii+'（共'+lllil+'份'+(iIII1i?II1ll1['mBUBF']:'')+'）');}}IlIIi[II1ii(0x223,']oYR')]({'days':I1lIl1,'prize':IlIIl,'havePrize':ilil1i});}}const illlII=await common[II1ii(0x235,'2z4e')]({'venderId':iIli1l});console[II1ii(0x1b0,'7Qc#')]('【'+iI1lii+'】\x0a'+(illlII&&'店铺名称：#'+illlII+'\x0a')+II1ii(0x21a,'Dx[o')+iI11II+II1ii(0x225,'EIaR')+iIII1I);IlIIi[II1ii(0x1c9,'EwUb')]>0x0&&console[II1ii(0x187,'X@dj')](IlIIi[II1ii(0x1b5,'8J9Z')](iil1i1=>(iil1i1[II1ii(0x1f6,'2z4e')]===0x0?II1ii(0x253,'(Aam'):'连续'+(iil1i1[II1ii(0x1ac,')biV')]<0xa?'\x20':'')+iil1i1[II1ii(0x195,'gArS')]+'天')+'：'+iil1i1[II1ii(0x1fc,'#Hmi')][II1ii(0x208,'l9zm')]('，'))[II1ii(0x19e,'gArS')]('\x0a'));console['log']('');const iIII11=Date['now']();il1i1I&&iIII11<il1i1I&&(console[II1ii(0x194,'vAq6')](II1ii(0x236,'c(Ol')+iI11II+'\x20开始，晚点再来吧~\x0a'),IiI11[II1ii(0x268,'&HOW')](iI1lii),IilIii=![]);if(lI1li1&&II1ll1[II1ii(0x1b3,'OK4@')](iIII11,lI1li1))II1ll1[II1ii(0x1c0,'1lAY')]==='arMtV'?(lIIil1[II1ii(0x1ec,'pOe^')]===0x192?Iilli1[II1ii(0x284,'r[z0')](I1l1Il[II1ii(0x1dd,'#Hmi')]+II1ii(0x1fd,'#Hmi')):llIll1[II1ii(0x1d5,'@gPS')](Illl1l[II1ii(0x1f7,'EIaR')]+'\x20活动信息获取失败'),IiiIlI[II1ii(0x192,'X@dj')]=!![]):(console[II1ii(0x24f,'Je)1')](II1ii(0x1fe,'1lAY')+iIII1I+II1ii(0x23e,')TOd')),IiI11[II1ii(0x256,'qbG#')](iI1lii),IilIii=![]);else liiIIl===0x3&&(II1ll1[II1ii(0x21f,')TOd')](II1ii(0x251,'p6BW'),II1ll1[II1ii(0x1c6,'XN2a')])?(console['log'](II1ll1[II1ii(0x1ae,'ju6V')]),IiI11[II1ii(0x252,'0D$B')](iI1lii),IilIii=![]):l1lIii[II1ii(0x213,'p6BW')](I11iI1['token']+II1ii(0x19d,'l9zm')));if(!ilil1i){if(II1ll1[II1ii(0x199,'7Qc#')](II1ll1[II1ii(0x27c,'qbG#')],II1ll1[II1ii(0x203,'X@dj')])){llIli1[II1ii(0x1e3,'fIDb')](II1ll1[II1ii(0x202,'Dx[o')]);for(const ilil1l of I1lllI){Iliil1[II1ii(0x25d,'mRK7')](ilil1l);}}else IiI11['push'](iI1lii),IilIii=![];}const IiI1i=TokensMap[II1ii(0x226,'E6Kn')](iI1lii);IiI1i['venderId']=iIli1l,IiI1i['shopName']=illlII,IiI1i[II1ii(0x201,'0D$B')]=i1i1II,IiI1i['startTime']=il1i1I,IiI1i[II1ii(0x275,'nQsD')]=lI1li1,IiI1i[II1ii(0x1fa,'Je)1')]=IilIii,IiI1i[II1ii(0x183,'srG%')]=IlIIi,II1ll1[II1ii(0x1be,']j4r')](IlIIi['length'],0x0)&&(II1ll1[II1ii(0x282,'0D$B')]===II1ll1[II1ii(0x182,'&HOW')]?(IiI1i[II1ii(0x217,'EIaR')]=IlIIi[0x0][II1ii(0x244,'GUFp')],IiI1i['maxLevel']=IlIIi[IlIIi[II1ii(0x1cf,'t$KY')]-0x1][II1ii(0x1c7,'iCqH')]):Ii1iI1[II1ii(0x20c,'@X3T')]&&lilIli['venderId']&&i1illl[II1ii(0x1a4,']j4r')](I1llil+':'+I1llii['activityId']+':'+lilIll[II1ii(0x278,'2pS#')])),TokensMap['set'](iI1lii,IiI1i);}if(IiI11[II1ii(0x1d0,'gArS')]>0x0){console[II1ii(0x1d9,'8J9Z')](II1ii(0x245,'ju6V'));for(const I1lIii of IiI11){II1ll1['ewVRh']===II1ll1[II1ii(0x272,']j4r')]?console[II1ii(0x1d9,'8J9Z')](I1lIii):(delete II1lii['data'],delete lIIii1['headers']['Content-Type']);}}const lli=Object['fromEntries'](TokensMap),liIlI=II1ll1[II1ii(0x211,'qbG#')](require,'fs');liIlI['writeFileSync'](CacheFile,JSON[II1ii(0x1f4,'c(Ol')](lli,null,0x2)),console[II1ii(0x20e,'Fnjh')](II1ll1['lFRbD']),console[II1ii(0x23d,'t$KY')](CacheFile);if(printEnvValue){if(II1ll1[II1ii(0x1ca,'EIaR')](II1ll1[II1ii(0x254,'ju6V')],II1ll1[II1ii(0x1e6,')TOd')]))I1iIil[II1ii(0x1f2,')TOd')](II1ll1[II1ii(0x24c,'1lAY')]),lI1Iil['push'](lilIiI),i1l1I=![];else{console[II1ii(0x189,'EIaR')](II1ll1[II1ii(0x23a,'LX%B')]);let i11ill=[];for(const [IIIIIi,IIIIIl]of TokensMap){IIIIIl['activityId']&&IIIIIl['venderId']&&('cMhLb'!==II1ll1[II1ii(0x1c3,'OK4@')]?iI1lll['log'](II1ii(0x247,'XN2a')+l1lIll+'\x20请求响应\x20'+(I1l1II[II1ii(0x1a0,'X@dj')]||IIli1I)):i11ill[II1ii(0x287,'nQsD')](IIIIIi+':'+IIIIIl['activityId']+':'+IIIIIl[II1ii(0x22d,'7Qc#')]));}console['log'](i11ill[II1ii(0x181,'qbG#')](','));}}}catch(IIIl1i){II1ll1[II1ii(0x1f0,'hieY')]('zevdY',II1ll1['lLtth'])?i1l1l1['log'](IlI1I[II1ii(0x21c,']oYR')](IIIl1l=>(IIIl1l['days']===0x0?II1ii(0x24a,'gArS'):'连续'+(IIIl1l[II1ii(0x1ea,'qbG#')]<0xa?'\x20':'')+IIIl1l[II1ii(0x229,'&HOW')]+'天')+'：'+IIIl1l[II1ii(0x280,'0D$B')][II1ii(0x228,'EwUb')]('，'))[II1ii(0x23f,')y7t')]('\x0a')):console[II1ii(0x21b,'ju6V')](II1ii(0x209,'qbG#')+IIIl1i);}}async function handleResponse(lllll,i11ili){const IIIIII=I1lIli,iil1l1={'VZkvP':function(lllli,iiili1){return lllli!==iiili1;},'yclmX':IIIIII(0x286,'qbG#'),'XTwAW':function(ill11i,lllill){return ill11i===lllill;},'BLgCS':IIIIII(0x250,'E6Kn'),'UwPmQ':function(ill11l,I1lIiI){return ill11l===I1lIiI;},'gMaIu':'RscBb','njNiz':IIIIII(0x25c,'(Aam'),'CyYYH':IIIIII(0x264,'&HOW'),'XnDoy':'yOWQL'};try{switch(lllll){case'getActivityInfo':if(i11ili[IIIIII(0x188,'ZfQI')]===0xc8&&iil1l1[IIIIII(0x1f8,'E6Kn')](i11ili[IIIIII(0x18b,'EwUb')],!![])&&i11ili[IIIIII(0x1da,'#Hmi')])iil1l1['XTwAW'](iil1l1['BLgCS'],'PimFj')?(lliilI[IIIIII(0x1e2,'l9zm')]=lili1,iil1l1[IIIIII(0x179,'2z4e')](ll1l1,0x193)&&IiiIi1['log'](l1ii1)):$[IIIIII(0x185,'0D$B')]=i11ili['data'];else{if(i11ili[IIIIII(0x22e,'@gPS')]){if(iil1l1[IIIIII(0x283,'p6BW')](i11ili['code'],0x192)){if(iil1l1[IIIIII(0x1d8,'GUFp')](iil1l1[IIIIII(0x1aa,'1lAY')],iil1l1[IIIIII(0x25b,')y7t')]))console[IIIIII(0x17b,')biV')]($[IIIIII(0x1f7,'EIaR')]+IIIIII(0x1d7,'lN(3'));else{li1Ii[IIIIII(0x1ce,'!htJ')](iil1l1[IIIIII(0x276,'1lAY')]);let Ill11=[];for(const [liiIII,li1i11]of i1IIl){li1i11['activityId']&&li1i11['venderId']&&Ill11['push'](liiIII+':'+li1i11[IIIIII(0x25f,'lN(3')]+':'+li1i11[IIIIII(0x20a,'fIDb')]);}i1illI['log'](Ill11[IIIIII(0x17e,'7Qc#')](','));}}else'XpFWC'===iil1l1['njNiz']?lliiil['log'](lliiii):console[IIIIII(0x1eb,'iCqH')]($[IIIIII(0x200,'t$KY')]+'\x20活动信息获取失败');$[IIIIII(0x19c,'EIaR')]=!![];}else iil1l1[IIIIII(0x26d,'ju6V')](iil1l1[IIIIII(0x26a,'ZfQI')],iil1l1['XnDoy'])?Ii1iIl['log'](iliIIi):(console['log']('❓'+lllll+'\x20'+JSON[IIIIII(0x1cb,'ju6V')](i11ili)),$[IIIIII(0x285,')y7t')]=!![]);}break;}}catch(IlIlll){console['log'](IIIIII(0x1db,'ZfQI')+lllll+'\x20请求响应\x20'+(IlIlll[IIIIII(0x198,'LX%B')]||IlIlll));}}async function sendRequest(IIIl1I){const lillII=I1lIli,iil1ii={'yVxwF':'GET','pTZGP':lillII(0x22f,'Dx[o'),'RfOko':lillII(0x1ff,'OK4@'),'doyan':lillII(0x1a3,'srG%'),'IBkFh':function(ilil11,illlI1){return ilil11(illlI1);},'iNKci':'4.4','xsBNw':lillII(0x174,')y7t'),'cEFdY':lillII(0x1e4,'#Hmi'),'LgwKd':function(IIIl11,I1lIi1){return IIIl11/I1lIi1;},'WoPUf':lillII(0x205,'fIDb'),'NcgvE':lillII(0x273,'gArS'),'vAdST':lillII(0x26c,'Dx[o'),'dcoHU':'keep-alive','yggKm':lillII(0x1bb,'OK4@'),'xWVzC':lillII(0x177,'lN(3'),'JOJXU':'no-cors','rzeut':lillII(0x176,'XN2a'),'hZlQX':function(liiIIi,lil11I){return liiIIi<lil11I;},'vxzeO':lillII(0x26b,'!htJ'),'lpjpT':lillII(0x1ba,'!htJ'),'bjKne':function(Iliii1,iIiIi){return Iliii1>iIiIi;},'kgZHj':function(iil1ll,iiilil){return iil1ll!==iiilil;},'hHHes':lillII(0x242,'0D$B'),'SQPLP':'BjDXx','nrMFi':function(iil1li,lillIl){return iil1li===lillIl;},'PKKkZ':lillII(0x1b8,'pOe^'),'megpq':function(iIiIl,iiilii){return iIiIl>=iiilii;},'UvZVM':function(li1i1i,IlIli1){return li1i1i===IlIli1;},'zLGTc':'HtqrE','OsbRj':function(illIiI,lI1lli){return illIiI!==lI1lli;},'OdNsH':'oMeaB'};if($[lillII(0x237,'@X3T')])return;let IlIlli='',il1i1i=null,lil111=null,i11ilI=iil1ii['yVxwF'],ii1ii1={},llllI={};switch(IIIl1I){case iil1ii['pTZGP']:llllI={'appId':lillII(0x173,'x^GZ'),'functionId':iil1ii['RfOko'],'appid':iil1ii[lillII(0x171,'@XET')],'body':{'token':$['token'],'venderId':iil1ii[lillII(0x172,'2z4e')](parseInt,$[lillII(0x239,'X@dj')])||''},'version':iil1ii[lillII(0x1a6,'#Hmi')],'ua':$['UA']},ii1ii1=await H5st[lillII(0x26e,'vAq6')](llllI),IlIlli=iil1ii[lillII(0x210,')TOd')],lil111=Object['assign']({},ii1ii1['paramsData'],{'jsonp':iil1ii[lillII(0x232,'c(Ol')]});break;default:console['log'](lillII(0x224,'srG%')+IIIl1I);return;}const lllil1={'t':Math[lillII(0x1d3,'EIaR')](iil1ii[lillII(0x214,'E6Kn')](Date[lillII(0x240,'a%!1')](),0x3e8))+'000','loginType':'2','x-api-eid-token':$[lillII(0x22b,'r[z0')]};il1i1i&&Object['assign'](il1i1i,lllil1);lil111&&Object[lillII(0x274,'ju6V')](lil111,lllil1);const iil1il={'url':IlIlli,'method':i11ilI,'headers':{'Accept':iil1ii['WoPUf'],'Accept-Encoding':iil1ii[lillII(0x16e,'&HOW')],'Accept-Language':iil1ii[lillII(0x190,'x^GZ')],'Connection':iil1ii['dcoHU'],'Content-Type':iil1ii[lillII(0x1f9,'lN(3')],'Host':'api.m.jd.com','Referer':iil1ii[lillII(0x1f5,'@XET')],'Sec-Fetch-Dest':'script','Sec-Fetch-Mode':iil1ii['JOJXU'],'Sec-Fetch-Site':'same-origin','User-Agent':$['UA']},'params':lil111,'data':il1i1i,'timeout':0x7530,'httpsTlsOptions':common[lillII(0x234,'0D$B')]()};i11ilI===lillII(0x216,'hieY')&&(delete iil1il['data'],delete iil1il[lillII(0x1a5,'XN2a')][iil1ii[lillII(0x25e,'hieY')]]);const ilil1I=0x1;let i11il1=0x0,ii1iiI=null,lllilI=null;while(iil1ii['hZlQX'](i11il1,ilil1I)){if(iil1ii[lillII(0x1c8,'Dx[o')]===iil1ii['lpjpT'])i1l1[lillII(0x18f,'OK4@')](''+IIII1i[lillII(0x170,'#Hmi')]),IiilI1[lillII(0x222,'2z4e')]='';else{iil1ii['bjKne'](i11il1,0x0)&&await $['wait'](0x7d0);const llI1Il=await common[lillII(0x18e,'nQsD')](iil1il);if(!llI1Il[lillII(0x220,'EIaR')]){if(iil1ii[lillII(0x241,'l9zm')](iil1ii['hHHes'],iil1ii['SQPLP'])){lllilI=llI1Il['status'],$[lillII(0x279,'@XET')]=$['token']+'：'+lllilI+lillII(0x196,'Je)1'),ii1iiI=lillII(0x1fb,'iCqH')+IIIl1I+lillII(0x204,'gArS')+llI1Il[lillII(0x1d4,'a%!1')],i11il1++;continue;}else i1II1[lillII(0x20e,'Fnjh')]('❌\x20脚本运行遇到了错误\x0a'+iIIl11);}if(!llI1Il[lillII(0x20d,'@gPS')]){if(iil1ii[lillII(0x180,'LX%B')](iil1ii['PKKkZ'],lillII(0x1b1,'(Aam')))ilI1lI[lillII(0x16a,'(Aam')]('❓'+IiiIll+'\x20'+IIlii[lillII(0x1f3,'GUFp')](IlI1il)),IilliI[lillII(0x212,'@gPS')]=!![];else{ii1iiI='🚫\x20'+IIIl1I+lillII(0x16b,'pOe^'),i11il1++;continue;}}await handleResponse(IIIl1I,llI1Il[lillII(0x17a,'t$KY')]),ipBlack=![];break;}}iil1ii[lillII(0x193,']j4r')](i11il1,ilil1I)&&(iil1ii[lillII(0x1c4,'@gPS')](iil1ii['zLGTc'],iil1ii[lillII(0x1bc,'Fnjh')])?($[lillII(0x17c,']oYR')]=ii1iiI,lllilI!==0x193&&(iil1ii[lillII(0x16c,'p6BW')](lillII(0x230,'1lAY'),iil1ii[lillII(0x1af,'2z4e')])?console[lillII(0x267,'EwUb')](ii1iiI):Iillil[lillII(0x277,'lN(3')](l1lIli,lIIiiI))):(lI1Iii[lillII(0x206,'2z4e')]('活动已于\x20'+i1li+lillII(0x1b2,'qbG#')),li1II[lillII(0x218,')TOd')](IliI11),i1ll=![]));}var version_ = 'jsjiami.com.v7';
// prettier-ignore
function Env(t,e){"undefined"!=typeof process&&JSON.stringify(process.env).indexOf("GITHUB")>-1&&process.exit(0);class s{constructor(t){this.env=t}send(t,e="GET"){t="string"==typeof t?{url:t}:t;let s=this.get;return"POST"===e&&(s=this.post),new Promise((e,i)=>{s.call(this,t,(t,s,r)=>{t?i(t):e(s)})})}get(t){return this.send.call(this.env,t)}post(t){return this.send.call(this.env,t,"POST")}}return new class{constructor(t,e){this.name=t,this.http=new s(this),this.data=null,this.dataFile="box.dat",this.logs=[],this.isMute=!1,this.isNeedRewrite=!1,this.logSeparator="\n",this.startTime=(new Date).getTime(),Object.assign(this,e),this.log("",`🔔${this.name}, 开始!`)}isNode(){return"undefined"!=typeof module&&!!module.exports}isQuanX(){return"undefined"!=typeof $task}isSurge(){return"undefined"!=typeof $httpClient&&"undefined"==typeof $loon}isLoon(){return"undefined"!=typeof $loon}toObj(t,e=null){try{return JSON.parse(t)}catch{return e}}toStr(t,e=null){try{return JSON.stringify(t)}catch{return e}}getjson(t,e){let s=e;const i=this.getdata(t);if(i)try{s=JSON.parse(this.getdata(t))}catch{}return s}setjson(t,e){try{return this.setdata(JSON.stringify(t),e)}catch{return!1}}getScript(t){return new Promise(e=>{this.get({url:t},(t,s,i)=>e(i))})}runScript(t,e){return new Promise(s=>{let i=this.getdata("@chavy_boxjs_userCfgs.httpapi");i=i?i.replace(/\n/g,"").trim():i;let r=this.getdata("@chavy_boxjs_userCfgs.httpapi_timeout");r=r?1*r:20,r=e&&e.timeout?e.timeout:r;const[o,h]=i.split("@"),n={url:`http://${h}/v1/scripting/evaluate`,body:{script_text:t,mock_type:"cron",timeout:r},headers:{"X-Key":o,Accept:"*/*"}};this.post(n,(t,e,i)=>s(i))}).catch(t=>this.logErr(t))}loaddata(){if(!this.isNode())return{};{this.fs=this.fs?this.fs:require("fs"),this.path=this.path?this.path:require("path");const t=this.path.resolve(this.dataFile),e=this.path.resolve(process.cwd(),this.dataFile),s=this.fs.existsSync(t),i=!s&&this.fs.existsSync(e);if(!s&&!i)return{};{const i=s?t:e;try{return JSON.parse(this.fs.readFileSync(i))}catch(t){return{}}}}}writedata(){if(this.isNode()){this.fs=this.fs?this.fs:require("fs"),this.path=this.path?this.path:require("path");const t=this.path.resolve(this.dataFile),e=this.path.resolve(process.cwd(),this.dataFile),s=this.fs.existsSync(t),i=!s&&this.fs.existsSync(e),r=JSON.stringify(this.data);s?this.fs.writeFileSync(t,r):i?this.fs.writeFileSync(e,r):this.fs.writeFileSync(t,r)}}lodash_get(t,e,s){const i=e.replace(/\[(\d+)\]/g,".$1").split(".");let r=t;for(const t of i)if(r=Object(r)[t],void 0===r)return s;return r}lodash_set(t,e,s){return Object(t)!==t?t:(Array.isArray(e)||(e=e.toString().match(/[^.[\]]+/g)||[]),e.slice(0,-1).reduce((t,s,i)=>Object(t[s])===t[s]?t[s]:t[s]=Math.abs(e[i+1])>>0==+e[i+1]?[]:{},t)[e[e.length-1]]=s,t)}getdata(t){let e=this.getval(t);if(/^@/.test(t)){const[,s,i]=/^@(.*?)\.(.*?)$/.exec(t),r=s?this.getval(s):"";if(r)try{const t=JSON.parse(r);e=t?this.lodash_get(t,i,""):e}catch(t){e=""}}return e}setdata(t,e){let s=!1;if(/^@/.test(e)){const[,i,r]=/^@(.*?)\.(.*?)$/.exec(e),o=this.getval(i),h=i?"null"===o?null:o||"{}":"{}";try{const e=JSON.parse(h);this.lodash_set(e,r,t),s=this.setval(JSON.stringify(e),i)}catch(e){const o={};this.lodash_set(o,r,t),s=this.setval(JSON.stringify(o),i)}}else s=this.setval(t,e);return s}getval(t){return this.isSurge()||this.isLoon()?$persistentStore.read(t):this.isQuanX()?$prefs.valueForKey(t):this.isNode()?(this.data=this.loaddata(),this.data[t]):this.data&&this.data[t]||null}setval(t,e){return this.isSurge()||this.isLoon()?$persistentStore.write(t,e):this.isQuanX()?$prefs.setValueForKey(t,e):this.isNode()?(this.data=this.loaddata(),this.data[e]=t,this.writedata(),!0):this.data&&this.data[e]||null}initGotEnv(t){this.got=this.got?this.got:require("got"),this.cktough=this.cktough?this.cktough:require("tough-cookie"),this.ckjar=this.ckjar?this.ckjar:new this.cktough.CookieJar,t&&(t.headers=t.headers?t.headers:{},void 0===t.headers.Cookie&&void 0===t.cookieJar&&(t.cookieJar=this.ckjar))}get(t,e=(()=>{})){t.headers&&(delete t.headers["Content-Type"],delete t.headers["Content-Length"]),this.isSurge()||this.isLoon()?(this.isSurge()&&this.isNeedRewrite&&(t.headers=t.headers||{},Object.assign(t.headers,{"X-Surge-Skip-Scripting":!1})),$httpClient.get(t,(t,s,i)=>{!t&&s&&(s.body=i,s.statusCode=s.status),e(t,s,i)})):this.isQuanX()?(this.isNeedRewrite&&(t.opts=t.opts||{},Object.assign(t.opts,{hints:!1})),$task.fetch(t).then(t=>{const{statusCode:s,statusCode:i,headers:r,body:o}=t;e(null,{status:s,statusCode:i,headers:r,body:o},o)},t=>e(t))):this.isNode()&&(this.initGotEnv(t),this.got(t).on("redirect",(t,e)=>{try{if(t.headers["set-cookie"]){const s=t.headers["set-cookie"].map(this.cktough.Cookie.parse).toString();s&&this.ckjar.setCookieSync(s,null),e.cookieJar=this.ckjar}}catch(t){this.logErr(t)}}).then(t=>{const{statusCode:s,statusCode:i,headers:r,body:o}=t;e(null,{status:s,statusCode:i,headers:r,body:o},o)},t=>{const{message:s,response:i}=t;e(s,i,i&&i.body)}))}post(t,e=(()=>{})){if(t.body&&t.headers&&!t.headers["Content-Type"]&&(t.headers["Content-Type"]="application/x-www-form-urlencoded"),t.headers&&delete t.headers["Content-Length"],this.isSurge()||this.isLoon())this.isSurge()&&this.isNeedRewrite&&(t.headers=t.headers||{},Object.assign(t.headers,{"X-Surge-Skip-Scripting":!1})),$httpClient.post(t,(t,s,i)=>{!t&&s&&(s.body=i,s.statusCode=s.status),e(t,s,i)});else if(this.isQuanX())t.method="POST",this.isNeedRewrite&&(t.opts=t.opts||{},Object.assign(t.opts,{hints:!1})),$task.fetch(t).then(t=>{const{statusCode:s,statusCode:i,headers:r,body:o}=t;e(null,{status:s,statusCode:i,headers:r,body:o},o)},t=>e(t));else if(this.isNode()){this.initGotEnv(t);const{url:s,...i}=t;this.got.post(s,i).then(t=>{const{statusCode:s,statusCode:i,headers:r,body:o}=t;e(null,{status:s,statusCode:i,headers:r,body:o},o)},t=>{const{message:s,response:i}=t;e(s,i,i&&i.body)})}}time(t,e=null){const s=e?new Date(e):new Date;let i={"M+":s.getMonth()+1,"d+":s.getDate(),"H+":s.getHours(),"m+":s.getMinutes(),"s+":s.getSeconds(),"q+":Math.floor((s.getMonth()+3)/3),S:s.getMilliseconds()};/(y+)/.test(t)&&(t=t.replace(RegExp.$1,(s.getFullYear()+"").substr(4-RegExp.$1.length)));for(let e in i)new RegExp("("+e+")").test(t)&&(t=t.replace(RegExp.$1,1==RegExp.$1.length?i[e]:("00"+i[e]).substr((""+i[e]).length)));return t}msg(e=t,s="",i="",r){const o=t=>{if(!t)return t;if("string"==typeof t)return this.isLoon()?t:this.isQuanX()?{"open-url":t}:this.isSurge()?{url:t}:void 0;if("object"==typeof t){if(this.isLoon()){let e=t.openUrl||t.url||t["open-url"],s=t.mediaUrl||t["media-url"];return{openUrl:e,mediaUrl:s}}if(this.isQuanX()){let e=t["open-url"]||t.url||t.openUrl,s=t["media-url"]||t.mediaUrl;return{"open-url":e,"media-url":s}}if(this.isSurge()){let e=t.url||t.openUrl||t["open-url"];return{url:e}}}};if(this.isMute||(this.isSurge()||this.isLoon()?$notification.post(e,s,i,o(r)):this.isQuanX()&&$notify(e,s,i,o(r))),!this.isMuteLog){let t=["","==============📣系统通知📣=============="];t.push(e),s&&t.push(s),i&&t.push(i),console.log(t.join("\n")),this.logs=this.logs.concat(t)}}log(...t){t.length>0&&(this.logs=[...this.logs,...t]),console.log(t.join(this.logSeparator))}logErr(t,e){const s=!this.isSurge()&&!this.isQuanX()&&!this.isLoon();s?this.log("",`❗️${this.name}, 错误!`,t.stack):this.log("",`❗️${this.name}, 错误!`,t)}wait(t){return new Promise(e=>setTimeout(e,t))}done(t={}){const e=(new Date).getTime(),s=(e-this.startTime)/1e3;this.log("",`🔔${this.name}, 结束! 🕛 ${s} 秒`),this.log(),(this.isSurge()||this.isQuanX()||this.isLoon())&&$done(t)}}(t,e)}
