/*
活动名称：批量店铺签到（活动查询）
活动链接：https://h5.m.jd.com/babelDiy/Zeus/2PAAf74aG3D61qvfKUM5dxUssJQ9/index.html?token=<token>
环境变量：jd_dpqd_tokens // 活动令牌，多个用英文逗号，@，&，换行分割

查询活动信息主脚本，IP限制严重建议使用代理，请勿频繁运行
自动去重并过滤无效活动，默认过滤垃圾奖品活动
运行后会在本地目录生成缓存文件以用于签到脚本使用

cron:1 1 1 1 *

*/

const $ = new Env('批量店铺签到（活动查询）')
var iｉl='jsjiami.com.v7';const illIil=iii1II;(function(illIiI,lI1lli,Ill1l,llI1Il,ii1iii,i11iil,Ill1i){return illIiI=illIiI>>0x9,i11iil='hs',Ill1i='hs',function(ii1iil,lllI1l,i11iii,llI1Ii,lllI1i){const lI1llI=iii1II;llI1Ii='tfi',i11iil=llI1Ii+i11iil,lllI1i='up',Ill1i+=lllI1i,i11iil=i11iii(i11iil),Ill1i=i11iii(Ill1i),i11iii=0x0;const li1i1l=ii1iil();while(!![]&&--llI1Il+lllI1l){try{llI1Ii=-parseInt(lI1llI(0x16a,'gFRZ'))/0x1*(-parseInt(lI1llI(0x1ee,'nKVi'))/0x2)+parseInt(lI1llI(0x16f,'mSy8'))/0x3*(-parseInt(lI1llI(0x17b,'3S75'))/0x4)+parseInt(lI1llI(0x188,'aBsW'))/0x5+-parseInt(lI1llI(0x1f4,'2KSS'))/0x6*(parseInt(lI1llI(0x191,'aBsW'))/0x7)+parseInt(lI1llI(0x1c2,'Ak23'))/0x8+-parseInt(lI1llI(0x172,'[Gai'))/0x9+-parseInt(lI1llI(0x19b,']#ax'))/0xa;}catch(II1i1){llI1Ii=i11iii;}finally{lllI1i=li1i1l[i11iil]();if(illIiI<=llI1Il)i11iii?ii1iii?llI1Ii=lllI1i:ii1iii=lllI1i:i11iii=lllI1i;else{if(i11iii==ii1iii['replace'](/[uGOHKlXhtWbdMxTVIU=]/g,'')){if(llI1Ii===lllI1l){li1i1l['un'+i11iil](lllI1i);break;}li1i1l[Ill1i](lllI1i);}}}}}(Ill1l,lI1lli,function(lI1lll,iIiII,iil1lI,iiiliI,li1i1I,illIii,ii1il1){return iIiII='\x73\x70\x6c\x69\x74',lI1lll=arguments[0x0],lI1lll=lI1lll[iIiII](''),iil1lI='\x72\x65\x76\x65\x72\x73\x65',lI1lll=lI1lll[iil1lI]('\x76'),iiiliI='\x6a\x6f\x69\x6e',(0x15fb3e,lI1lll[iiiliI](''));});}(0x18200,0x5c144,Iii11l,0xc3),Iii11l)&&(iｉl=0xc3);const common=require(illIil(0x1ce,'8n$#')),{H5st,jsTk}=require('./utils/Rebels_H');console[illIil(0x18a,'2KSS')](''),console[illIil(0x1c5,'ZgWf')](illIil(0x104,'A#Y(')+$['name']+illIil(0x101,'0oZ8')),console[illIil(0x168,'q!)j')]('jd_dpqd_tokens\x20//\x20活动ID，多个用英文逗号分割'),console['log']('=========='+$['name']+illIil(0x111,'LN^V')),console[illIil(0x16d,'9BnW')]('');let tokensList=(process[illIil(0x1a9,'!Hyq')][illIil(0x10c,'Al4P')]||'7BB34B26B3CD8D3866715F1BA774D9C5,F097E3780427E3BE7D823197A5D4ED21,DE539A44A0D75945F71A85B278A1F2F9,BD11388643AABFDB0BF04B1C3EC11358,49991D9AF154F6074195D424505C0995')[illIil(0x12e,'9BnW')](/[,@&|\n]+/g)[illIil(0xe9,'3S75')](Boolean);const printEnvValue=process['env'][illIil(0x186,'1cm4')]===illIil(0x1d6,'aZ^o');function Iii11l(){const lllI1I=(function(){return[iｉl,'IMjhsjliaKhmuKXi.TVcomx.HvxW7GdUbhdtOxdK==','W6fTcbldVuLoWQ5Dzq','W58bW4/cLhZdPq','4PYdWR/OHztMNiZOVAJOO6BPGzxLI53KU4pPLlNORjhdUW','gmkxwmoz','W7LuW7jKigqnvCoPWOuRW5pdVSoiWQK','p0BdV8ob','WOVcOKXd','5lY15OoA5yUw','57YB5A6T5ys35ysW5A2G5Q6P77Yd5OI85z2555MN5B+y77+g','WQxdPmoVwG','W4qfWP3cK8kFCun/uSoUbW','W5b5WRtcKmopWQu','W4ZdJrRdIr1mW7zeWRdcHW','whruestdHSkgCCoufmkH','WOhcTcNcUvC','WQ9TW6VdLNGHW67cRXXnqG','4P29WOlNRy8','W6C6WQBcRW','W6RcPCkPjCkjwLDHW6urEwldQw0','WQrTW7hdOMqM','m3G7ubZcJG','n8keWQu1WPS','n8keWR8OW69jW7u','WO/cKbBcKfi','cZ1EhG','W7TGdbRdOvq','W61fW6DrnMm','WRNcObzqW6xcRwpcLCkEWRy','W4PZW6LRdq','WPdcSr00W4NdUG','zGZcMmoBvgWb','eSoSF8k5W78','nbe6WORdNW','vw10gK8','oCoaWPTGW5vfoHijW6pdV8k2WQ4','W6yWW4ddSSkDW6zz','Fmk1W4/dRmkTW7WuW5VcH8oay0NcQa','dYDge0K','W4mmWQxcM8kp','gc0OyxC','x0STwCoQk8k+','rvaQx8o3','WOxcKCooW7yZv8oiimkVnG','WQzGW7K','hc1zn0qDW7ddSsn+jmohWQSXW4i','W7mDWOFcISkLi8oDvSkTWQ/dPComW6hdMG0','5yE957Uq5y65','sfeGxW','WRNdVSo7D8kPdG','W5LKWQe','W78Huq','amoGk8o8gSkPja','w+ISJ+AXVUwrSEw5QMe','nCoxWOJdU3S','WRmnW4i','WOxcJmoUW7yZv8oi','ACozW7jwW6T9W6/cPbqTW5K','WPNdM8kH','WR3cSb1m','WQz3W6hdT8kkdcvkt8oEztNcRW','WQrNW7G','W4RcISoLnu0','W7K9ySkTWPPLEa','ouDPmW','s8otAG','W7RcI8kUgSkR','W7qRqSkdWPj0F8kwkvddTZbDWPtdTa','WQpdImoGumovW78J','tWXMde8+W7y','W5OtW4xcJG','ubuelCo5','wYGQamoK','ds1deKiBW5ddOW','ybdcQW','WPVcSqCsW57dPLhdTCk4WQrvWR7cKGtcPa','W600WRq9','f8kxwW','qCkZW6OsWQu','nmo3WQpdJq','WPBcScW3W43dO1ZdNmkHWQjfWPNcId3cRSkJFW','CZir','W7ZdSfSrW7pdPdRcMSkVWRlcRmk7iW','4P+vW5JMN4ROGOVMRzFNOPlLPlBNK7mO','WQFdPmo2','W6XuW7DqjMmq','W4CYWPZcGCk/','5B275AsZ5PEk6zwi77+K','o+EmJEwJOownT+MgNo+/HG','W708WQaR','bsyvrx8','W7ZdSLKvW73cKulcLCk1WR7cLq','W5u/WRJcKCoD','zCobWQzTgsWEWOBcGgaEzaFcSmoRWPTkp8oIstFcMmkoWR7cNbFdLCkKW7VcQ8oCvuqJWPmDu8o0W64ilSoNhvxdV8kwWOddNMfUW7roxCk0WONcPCogeXhdIZhdTSoNW702WPy1rtXUCSoJjW','W63cQCkVfSkS','xxm9BmoB','W4NdJaS'].concat((function(){return['iSk1WRiNWQK','4PIOi+IUIEweU+wSI+s5QEw/R+ILRUEAUUEoVUwJI+wpUoMeKUwtP+wfG+I8SEIITEIfQ+ADSE++Tq','W4xcJSo/mvhdGq','WO/dOCo4WOry','WRVdPCohWRrskCkIt8oiWPxdHmk4W5C','qvxcIq','4PIvk+ISSEwgLEwSPUs6I+w9IoILQ+EzPEEoL+wINowmOUMeK+wtNowePoI/H+IJToIeOUADK+++Jq','hgldKG','eYKdWOBdQq','i8oWkq','B8kqW5OuWO8izGO4W73dTmkvWRNdTSk/','eIzzzmogvSoZEHnaW4vvh8oSg3D+W63cO8ocW5C','WRChW4tdTmkDW7Hz','W6rSgq','W50AW7hcVLW','W43cISoOjq','bsWe','WQ3dLSou','ACkPW5a','5BMF6zoY56wW5yQd','W6WSWP3cRmkF','WRenWOJdS8kxW7Hz','u8o3vZio','eHOhWOJdIbuyW6WiWPG','omovy8kZW6m','bZyoqNBdUa','4P6GW5/OHQlMNRVOVO/OOBlPG6VLIzhKUyRPLzVORyZcLG','fqKCWP3dGca1W6ezWQPiW7nR','W4GxW5lcMx7dUvldPq','zSoqjSoFmG','qX8wWRtdK14','WQb8W7fiW57cOvFdOSo3','WRH6W7jdW50','WPVcHtuCW74','WRfXW6BdVd0dW5pdJbLeb8k3zXqajW','D8oDW79EjdPlW4hdHr1rz1RdOCo+WOGzFSk2','W5tcSmkcfx4','rwnRhG','pmo5WR0','W7hdJaFdJr9GW6b3WRZcGu3cOHG','W7GxWPq','CmomoSoHgG','s8ozyWyOiW','W7SWWQBcScj+WQ7cKtDvxSkvqG','WQ3cUsFcO0G','W7NcRmk2jCk8','iKLN','WQFcGez/WOS','W7VcISk4eha','x8oAe8ofna','WOxcRffm','tgTXm0tdGSoixq','fI1EbuyoW7W','mCkXu8oBWQG','cSkUESo+WRa','vCoxsCoiWPCTWRmgWRZdQeGiCmkcW4uzWQBcGCkpzdWurW','AmkMW5ldTW','n0JdOq','WR7NU6lMN5NVVkNKUyJMRlhMLO3NGPRMN6xLK5ySWPa','tw0xCmob','vw10gK/cIq','5RwR5yMj5Bon5z2iW7O','WQBdPCoUw8k1gXRdGdu','ECohWQD4','5Rs25yID5BsG57Uo5PY1ha','WP8KW6W','csjgh2q','fIXduComtmoVAsPgW5vMfmoyaq','hG94cSk5ymo9W4azWOixEhq','WPlcUurFWRFcVSoZbmoQ','WQhcQGK','W40gW53cIw7dUa','WRb4W7PsW7y','WPpdJHVcQSkV','W506WQyRdISQWOnAW7TfWRSB','WRhdUstcHCkVk8kaWOZcLmoFW7CQBwii','FmkXFa7cICkeiG','WRFdVYtcRCk6nSkDWOpcTmop','WRBdLCoHvCoj','W6RcImkmh0a','WOBcKmorW7K','E+EpPUwITowpIoMfOo+8OG','5lUN5lIH54II5Qcy5B+f6zEe6k+G','WRJcTGTLWRRcRvVcMmke','pmkeWQuhWQ5s','WQ9YW7BdTtXUW7RcHbTmrSklsGjnkmk/','W6FcU8kg','FSkUFHJcJ8kAxCkaa0RcJmk0','xaZdMLe6W67dPc8','q8kUW7BdOSkB','W5mGWQWzoa','aWSCW4FdIeG2W6LsWPPEW7a','q3bhgwu','W77cV8o2WP5oWPyVpW','BCkBW4ObWOurAG','WRymW5hdTCkkW4LpimoWzSoCW48/kdhcNmkhW4JcMK4','W6ZcT8k3eMa','i8kvWQOsWQ5UW6JcRaG'].concat((function(){return['WPdcTg93WPC','z8oAWRTZ','dGOOEx0','WQxcKIdcM04','emoizmkCW71W','W6dcUSkhW6uiEmo2z8omWQG','W7ewWPFcN8kVoSor','W7NcOCkcW6W','AXRcUmo1xh0gbMruW4lcMCozW4zX','W4dcHCoLm1FdImkbWRjyWQG1h8oeW6uKW77dGepcTZibW7yiWR7dMhhcV3lcVmoMW5BcOatcG3pdPeGkW7Gc','WQVcTWfjWO/cS3VcHSkEWR3cRq','WRNdVSo7','W4FdKttdJJu','dIyxyxddVSkIzSo/bSktlhxcKNC','W6/cPSoYbg0','WQVMT73LIBxLTR7NUldNU6dMNBZKUP4','g8oDc2xdTW','hsfbaKiB','8kYOTg4','5RAY5yU95Bs/5lUaqa','EfeLx8oHhCk/W5SrWRK7ruq','hdPq','WPlcPLbJWQlcH8o/','ggfoeSkW','ds4GWPhdKW','W7agWP7cNSoC','xuJcHZ9NaSkZlmkm','oCoZW4hdGSkkW7SgW64','bG0hsxa','CEE6M+ADSUAwGoMxK++9SW','sWxdJfi','W7VcNSkTbvi','W4RdGqJdJaq','W7/ORPxMS6FLKz3LUAZcQG','W7uBWOFcOSkWpSoawCknWR8','W53cHmo6m0S','W5NcP8k4p8kv','WR7cObO','FmkuW7BdL8kL','rftcJsL3kSk/la','WQ7dKIJcQ8kT','5yY06ysW6k2m5PQzyGpcKvZdSx/cNSkHW6JdVG','zmkBW4i7WPK','qaqiWRJdSW','muldSCkjaJrsttaD','eb19DCon','emoyy8kCW6X3u8k4tSkd','WRP9W7DCW4S','vmoqeCoIimk7','rahdKffzW67dPsnQWOm','WQxcSrPuWRNdPYddM8kFW63dSmk8DfBcTSouWOtdU1yw','WPpcQd3cRbyjtY5JW6XYW7tcHe3dRCoK','DZK5kSodWQJdOmoZm8ovl1ZdKeW','WRFLVy/LPj7VV4VMM6JNGOZLHP7MNyVLKlhdMdG','WOZcRf1HWQBcNmo/bq','d+A1N+wiNEs/GoAaM+ImUownN+wLU+I0Uq','ocDdaKihW63cQH5ZlCoR','5O2d56w057UL5P6DW4W9k8oDFrNcS0qoW48','W7JcHmoglKi','ngifxrS','qCoxemoh','W4BdJaJdJq','p0tdOmoKeq','iMi+tcm','W6RNU5ZMN4hVVkRKUQxMRRhMLO7NGAVMNQhLKlynW5m','yCkUW67cJIOeWRy8WORcKbtcT8oh','W5iDW5S','jSkeWQueWR9iW4JcPq','5P+/55205AEk5zoZ77+t','5Q+I5PEF566q5yM1','v8oozbS5','WQP1W41Fk0Cl','5ywEgowmHW','WRRdRmoiWRfwiCkIvSoLWQNdNmkCW60','nCoKWQJdKwa','s1S6','CSolfSomga','Fd4sj8ofWRddSmovdSoE','wG4KWOZdSa','jeLPkq','hszq','5Q+G5PAb56+l5yIr','vCodgSoC','WOZcOqa7','WPNcRayFW6S','E+IVKoAzSUApKdzz5OMV5l6/55sR5lQT55oi','WQWsW4NdUCkm','tw14','mSkXWQaqWRG','Ab7cUmov','8l2PRCo9','W6W2WOVcPmkN','WRFdLCoTC8kH','FCoaWQf1','WR8YebmW'];}()));}()));}());Iii11l=function(){return lllI1I;};return Iii11l();};let TokensMap=new Map();function iii1II(_0x1821b4,_0x298248){const _0x1d150a=Iii11l();return iii1II=function(_0x557589,_0x43958b){_0x557589=_0x557589-0xe8;let _0x4b0e39=_0x1d150a[_0x557589];if(iii1II['tEpdMi']===undefined){var _0x1c4afd=function(_0x33afed){const _0x1996fc='abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789+/=';let _0x64feae='',_0x484223='';for(let _0x54705c=0x0,_0xbfdc7e,_0x5bdeaf,_0x120f4c=0x0;_0x5bdeaf=_0x33afed['charAt'](_0x120f4c++);~_0x5bdeaf&&(_0xbfdc7e=_0x54705c%0x4?_0xbfdc7e*0x40+_0x5bdeaf:_0x5bdeaf,_0x54705c++%0x4)?_0x64feae+=String['fromCharCode'](0xff&_0xbfdc7e>>(-0x2*_0x54705c&0x6)):0x0){_0x5bdeaf=_0x1996fc['indexOf'](_0x5bdeaf);}for(let _0x3e4812=0x0,_0x2f3ae3=_0x64feae['length'];_0x3e4812<_0x2f3ae3;_0x3e4812++){_0x484223+='%'+('00'+_0x64feae['charCodeAt'](_0x3e4812)['toString'](0x10))['slice'](-0x2);}return decodeURIComponent(_0x484223);};const _0x551fb8=function(_0x1fe3c7,_0x42a3a8){let _0x474d5d=[],_0xb5f4a7=0x0,_0x3e0434,_0x1d5e5f='';_0x1fe3c7=_0x1c4afd(_0x1fe3c7);let _0x2aa5e3;for(_0x2aa5e3=0x0;_0x2aa5e3<0x100;_0x2aa5e3++){_0x474d5d[_0x2aa5e3]=_0x2aa5e3;}for(_0x2aa5e3=0x0;_0x2aa5e3<0x100;_0x2aa5e3++){_0xb5f4a7=(_0xb5f4a7+_0x474d5d[_0x2aa5e3]+_0x42a3a8['charCodeAt'](_0x2aa5e3%_0x42a3a8['length']))%0x100,_0x3e0434=_0x474d5d[_0x2aa5e3],_0x474d5d[_0x2aa5e3]=_0x474d5d[_0xb5f4a7],_0x474d5d[_0xb5f4a7]=_0x3e0434;}_0x2aa5e3=0x0,_0xb5f4a7=0x0;for(let _0x38ca2f=0x0;_0x38ca2f<_0x1fe3c7['length'];_0x38ca2f++){_0x2aa5e3=(_0x2aa5e3+0x1)%0x100,_0xb5f4a7=(_0xb5f4a7+_0x474d5d[_0x2aa5e3])%0x100,_0x3e0434=_0x474d5d[_0x2aa5e3],_0x474d5d[_0x2aa5e3]=_0x474d5d[_0xb5f4a7],_0x474d5d[_0xb5f4a7]=_0x3e0434,_0x1d5e5f+=String['fromCharCode'](_0x1fe3c7['charCodeAt'](_0x38ca2f)^_0x474d5d[(_0x474d5d[_0x2aa5e3]+_0x474d5d[_0xb5f4a7])%0x100]);}return _0x1d5e5f;};iii1II['SSReNd']=_0x551fb8,_0x1821b4=arguments,iii1II['tEpdMi']=!![];}const _0xc7363f=_0x1d150a[0x0],_0x3d6276=_0x557589+_0xc7363f,_0x545c59=_0x1821b4[_0x3d6276];return!_0x545c59?(iii1II['aDHOlw']===undefined&&(iii1II['aDHOlw']=!![]),_0x4b0e39=iii1II['SSReNd'](_0x4b0e39,_0x43958b),_0x1821b4[_0x3d6276]=_0x4b0e39):_0x4b0e39=_0x545c59,_0x4b0e39;},iii1II(_0x1821b4,_0x298248);}const CacheFile=__dirname+'/rs_dpqd_tokens.json';!(async()=>{const IillIl={'TMuik':function(llliil){return llliil();}};await IillIl['TMuik'](Main);})()[illIil(0x174,'5xK@')](liIl1=>$[illIil(0x167,'JkEU')](liIl1))[illIil(0x17a,'xoNs')](()=>$[illIil(0x166,'nqm]')]());async function Main(){const Ill1I=illIil,II1lll={'gIKYn':function(II1lli,ii1I1I){return II1lli>ii1I1I;},'xNxoa':function(IiIl,IiIi){return IiIl!==IiIi;},'bDqAz':'GjUYJ','eDHlT':Ill1I(0x198,'f*6z'),'JueAb':Ill1I(0x15a,'9BnW'),'WrEpa':Ill1I(0x141,'[Gai'),'xTngY':Ill1I(0x1e3,'nKVi'),'MHbcJ':'DenWb','Bzdfi':function(iI1ll1,IlI1Il){return iI1ll1===IlI1Il;},'IIGZQ':function(l1il1l,liIil){return l1il1l!==liIil;},'tKZSR':function(IllI1I,liIii){return IllI1I<liIii;},'brXfD':function(II1ll1,IlI1Ii){return II1ll1===IlI1Ii;},'QoWxg':Ill1I(0x1f7,'jh!a'),'FuLNW':Ill1I(0x1af,']d*9'),'ERKnc':function(i11I1I,l1il1i){return i11I1I-l1il1i;},'Ghcvs':Ill1I(0x201,'A#Y('),'oNdic':Ill1I(0x1b9,'Ak23'),'bhmeG':Ill1I(0x13e,'^[wY'),'TBEEO':function(ll1,iI1llI){return ll1>iI1llI;},'OCdNu':Ill1I(0x156,']d*9'),'ZGUuv':Ill1I(0x1d7,'aZ^o'),'nVSvN':function(llliii,IllI11){return llliii!==IllI11;},'FMcRH':'yCyHI','stodp':function(l1llIi,II1llI){return l1llIi===II1llI;},'zwdtX':'hhAWM','qyJZT':'AlJry','DjiNT':function(i11I11,l1llIl){return i11I11-l1llIl;},'obddu':function(ii1I1l,ii1I1i){return ii1I1l>ii1I1i;},'eAREi':Ill1I(0x145,'RXDW'),'vqjHB':function(llI,llliI){return llI(llliI);},'IFDGI':Ill1I(0x13f,'WaXH')};try{if(II1lll[Ill1I(0x1fb,'uhHC')](tokensList[Ill1I(0x199,'5xK@')],0x0))tokensList=[...new Set(tokensList[Ill1I(0x14b,'bU%&')](liIll=>liIll!==''))];if(tokensList['length']<=0x0){if(II1lll[Ill1I(0x133,'[etd')](II1lll[Ill1I(0x134,'JkEU')],'GjUYJ'))IIII11[Ill1I(0xfa,'[etd')]&&i1illi[Ill1I(0x11b,'mSy8')]&&l1i111[Ill1I(0x148,'[Gai')](iliII1+':'+II11I1['activityId']+':'+Iii11I['venderId']);else{console['log'](II1lll['eDHlT']);return;}}const iI1li1=[];console[Ill1I(0x1c5,'ZgWf')](''),$['UA']=common[Ill1I(0x14c,'mSy8')](II1lll['JueAb']),{jsToken:$[Ill1I(0x175,'LN^V')]}=await jsTk($['UA'],Ill1I(0x193,'aZ^o'),{'bizId':II1lll[Ill1I(0x1b4,'gFRZ')],'v':II1lll[Ill1I(0x1ab,'[etd')],'qs':Ill1I(0x1d3,'*!cW')+tokensList[0x0]});for(let [iI1liI,l1lIiI]of tokensList['entries']()){if(II1lll['xNxoa'](II1lll[Ill1I(0x17d,'Al4P')],II1lll[Ill1I(0x1bb,'jh!a')]))I1lliI[Ill1I(0x12f,'*!cW')](Ill1I(0x1b1,'0oZ8')+llIllI);else{let IilIiI=!![];const i1i1I1=iI1liI+0x1;l1lIiI[Ill1I(0xff,'^[wY')](':')&&II1lll['Bzdfi'](l1lIiI[Ill1I(0x1e6,'jh!a')](':')['length'],0x3)&&(l1lIiI=l1lIiI['split'](':')[0x0]);if(II1lll[Ill1I(0x136,'BJuz')](l1lIiI[Ill1I(0x1c1,'U7Pc')],0x20)||!/^[A-Z0-9]*$/['test'](l1lIiI)){console[Ill1I(0x173,'Ak23')](Ill1I(0x147,'gFRZ')+i1i1I1+Ill1I(0x1e9,'aBsW'));continue;}$['token']=l1lIiI,TokensMap[Ill1I(0xfd,'aBsW')](l1lIiI,{'index':null,'venderId':'','shopName':'','activityId':'','startTime':'','endTime':'','isValid':!![],'rules':[],'minLevel':null,'maxLevel':null});let IlII1=0x0;$[Ill1I(0x1a1,'WaXH')]='',$[Ill1I(0x137,'f*6z')]=![];const IiI11=0x1;while(!$[Ill1I(0x164,'[etd')]&&II1lll[Ill1I(0x1ad,'U7Pc')](IlII1,IiI11)&&!$[Ill1I(0x143,'NN*d')]){if(II1lll[Ill1I(0x205,'NN*d')](II1lll[Ill1I(0x112,'5xK@')],II1lll[Ill1I(0x17e,'Al4P')]))lI1Ili[Ill1I(0x171,'aBsW')](IliilI+':'+i1II1[Ill1I(0x106,']d*9')]+':'+iIIl11['venderId']);else{const iI11II='2|4|1|3|0'['split']('|');let iIII1I=0x0;while(!![]){switch(iI11II[iIII1I++]){case'0':IlII1>II1lll[Ill1I(0x1e0,'MRic')](IiI11,0x1)&&(console[Ill1I(0x1dd,'aBsW')](''+$[Ill1I(0x1e1,'Of&k')]),$[Ill1I(0x108,'gFRZ')]='');continue;case'1':await $[Ill1I(0x176,'ZgWf')](0x3e8);continue;case'2':$[Ill1I(0x1a1,'WaXH')]='';continue;case'3':IlII1++;continue;case'4':await sendRequest(II1lll[Ill1I(0x1c3,'RXDW')]);continue;}break;}}}if(!$['getActivityInfo'])continue;const lli=$[Ill1I(0x179,'LN^V')]['venderId'],liIlI=$[Ill1I(0x1da,'AmvP')]['id'],lll=$[Ill1I(0x1da,'AmvP')][Ill1I(0x149,'^hck')],llli1=$['getActivityInfo'][Ill1I(0x1a2,'AmvP')]||[],iIli1i=$[Ill1I(0x1e2,'MRic')][Ill1I(0x15b,'!Hyq')]||[],iI1lii=$[Ill1I(0x206,'uhHC')][Ill1I(0x1f8,'mSy8')],IilIii=$[Ill1I(0x13b,'U&gL')][Ill1I(0x1ff,'[etd')],iI1lil=$['time'](II1lll[Ill1I(0xf4,'uhHC')],iI1lii),l1lIi1=$[Ill1I(0x18f,'Of&k')](Ill1I(0x10b,'RXDW'),IilIii);let iIli1l=![];const i1i1II=[],liiIIl=[...iIli1i,...llli1];for(const ilil1i of liiIIl){const IlIIi=ilil1i[Ill1I(0x190,'uhHC')],IiI1l=ilil1i[Ill1I(0xf2,'^[wY')]||[],illlII=[];for(const iIII11 of IiI1l){let IiI1i='';const llll1=iIII11['discount'],lil11l=iIII11['type'],i1i1Il=iIII11[Ill1I(0x1b0,'uhHC')],I1lIl1=iIII11[Ill1I(0x151,'U&gL')],lil11i=I1lIl1===0x5;switch(lil11l){case 0x1:IiI1i=II1lll[Ill1I(0x103,'GA6N')];break;case 0x4:IiI1i=llll1+'京豆';break;case 0x6:IiI1i=llll1+Ill1I(0x1aa,'Ak23');break;case 0x9:IiI1i=''+iIII11?.['interactPrizeSkuList'][0x0]?.[Ill1I(0xee,'qma(')];break;case 0xa:IiI1i=llll1+Ill1I(0x120,'Al4P');break;case 0xe:IiI1i=llll1/0x64+Ill1I(0x165,'bl^C');break;default:IiI1i=Ill1I(0x11c,'JkEU')+lil11l+'）';}if(![0x1,0x6]['includes'](lil11l)&&!lil11i)iIli1l=!![];illlII['push'](IiI1i+'（共'+i1i1Il+'份'+(lil11i?'，已发完':'')+'）');}i1i1II[Ill1I(0x148,'[Gai')]({'days':IlIIi,'prize':illlII,'havePrize':iIli1l});}const iil1iI=await common[Ill1I(0x146,'Ak23')]({'venderId':lli});console[Ill1I(0x1a7,'uhHC')]('【'+l1lIiI+'】\x0a'+(iil1iI&&'店铺名称：#'+iil1iI+'\x0a')+Ill1I(0x18d,'8n$#')+iI1lil+Ill1I(0xf5,'3S75')+l1lIi1);II1lll[Ill1I(0xf1,'[Gai')](i1i1II[Ill1I(0x1eb,'mSy8')],0x0)&&console[Ill1I(0x1dd,'aBsW')](i1i1II['map'](IlIIl=>(IlIIl['days']===0x0?Ill1I(0x11d,'^[wY'):'连续'+(IlIIl[Ill1I(0x185,'^C]w')]<0xa?'\x20':'')+IlIIl[Ill1I(0xf6,'@znJ')]+'天')+'：'+IlIIl[Ill1I(0x107,'a)#)')][Ill1I(0x1e7,'0oZ8')]('，'))['join']('\x0a'));console['log']('');const IlIllI=Date[Ill1I(0x1ed,']#ax')]();iI1lii&&IlIllI<iI1lii&&(console[Ill1I(0x1d0,'pf9K')](Ill1I(0x1d4,'mSy8')+iI1lil+Ill1I(0x10d,'[Gai')),iI1li1[Ill1I(0x12b,'1cm4')](l1lIiI),IilIiI=![]);if(IilIii&&II1lll[Ill1I(0xe8,'nKVi')](IlIllI,IilIii))II1lll[Ill1I(0x100,'MRic')](II1lll[Ill1I(0x1fc,'RXDW')],Ill1I(0x194,'^hck'))?(console['log'](Ill1I(0xeb,'Of&k')+l1lIi1+Ill1I(0x1d1,'U&gL')),iI1li1['push'](l1lIiI),IilIiI=![]):I1i11I['log']('❌\x20未能正确处理\x20'+llIliI+Ill1I(0xf9,'9BnW')+(I1l1I1['message']||I1i111));else II1lll[Ill1I(0x1c7,'jh!a')](lll,0x3)&&(console[Ill1I(0x1bd,'^C]w')](II1lll['ZGUuv']),iI1li1[Ill1I(0x14f,'3S75')](l1lIiI),IilIiI=![]);!iIli1l&&(II1lll['nVSvN'](II1lll[Ill1I(0x1c6,'qma(')],II1lll[Ill1I(0x207,'5xK@')])?IlI11[Ill1I(0x162,'a)#)')](iIIIIl['map'](lllii=>(lllii[Ill1I(0x13c,'pf9K')]===0x0?Ill1I(0x129,'@znJ'):'连续'+(lllii[Ill1I(0x17c,'bl^C')]<0xa?'\x20':'')+lllii[Ill1I(0x12a,'gFRZ')]+'天')+'：'+lllii[Ill1I(0x11e,'U7Pc')][Ill1I(0x1fa,'aZ^o')]('，'))[Ill1I(0x127,'ZgWf')]('\x0a')):(iI1li1['push'](l1lIiI),IilIiI=![]));const il1i1I=TokensMap[Ill1I(0x123,'nqm]')](l1lIiI);il1i1I[Ill1I(0x160,'nqm]')]=i1i1I1,il1i1I['venderId']=lli,il1i1I[Ill1I(0x1ef,'@znJ')]=iil1iI,il1i1I[Ill1I(0x1e4,'MRic')]=liIlI,il1i1I[Ill1I(0x1dc,'qma(')]=iI1lii,il1i1I[Ill1I(0x1f5,'WaXH')]=IilIii,il1i1I[Ill1I(0x16e,'0oZ8')]=IilIiI,il1i1I[Ill1I(0x1b7,'a)#)')]=i1i1II,i1i1II[Ill1I(0x154,'1cm4')]>0x0&&(II1lll[Ill1I(0x1e5,'xoNs')](II1lll[Ill1I(0x1df,'a)#)')],II1lll[Ill1I(0x1f9,'qma(')])?(i1ll[Ill1I(0x183,'8n$#')]('活动已于\x20'+i1l1lI+Ill1I(0x118,'a)#)')),i1iliI[Ill1I(0x140,'JkEU')](I1iIii),IllII1=![]):(il1i1I[Ill1I(0x1ca,'*!cW')]=i1i1II[0x0][Ill1I(0x182,'Of&k')],il1i1I[Ill1I(0x10e,'qma(')]=i1i1II[II1lll[Ill1I(0x19a,'2KSS')](i1i1II['length'],0x1)][Ill1I(0x1a6,'5xK@')])),TokensMap['set'](l1lIiI,il1i1I);}}if(II1lll[Ill1I(0xf8,'NN*d')](iI1li1[Ill1I(0x14a,'Ak23')],0x0)){if(II1lll[Ill1I(0x1f3,'*!cW')](II1lll[Ill1I(0x14e,'RXDW')],II1lll[Ill1I(0x16c,'^C]w')])){console['log']('\x0a建议移除的活动：');for(const iIII1l of iI1li1){console[Ill1I(0x204,'JkEU')](iIII1l);}}else lilIil[Ill1I(0x200,']#ax')](i1l11),i1l1li=![];}const lllii1=Object[Ill1I(0x203,'aBsW')](TokensMap),liIli=II1lll['vqjHB'](require,'fs');liIli[Ill1I(0x1b2,'2n3t')](CacheFile,JSON[Ill1I(0x1d5,'JkEU')](lllii1,null,0x2)),console[Ill1I(0x168,'q!)j')](II1lll[Ill1I(0x184,'WaXH')]),console[Ill1I(0x180,'A#Y(')](CacheFile);if(printEnvValue){console[Ill1I(0x128,'AmvP')](Ill1I(0x18e,'gFRZ'));let iI11Il=[];for(const [iIII1i,iil1i1]of TokensMap){iil1i1['activityId']&&iil1i1['venderId']&&iI11Il[Ill1I(0x114,'gFRZ')](iIII1i+':'+iil1i1['activityId']+':'+iil1i1['venderId']);}console['log'](iI11Il[Ill1I(0x13d,'qma(')](','));}}catch(il1i11){console[Ill1I(0x11a,'bl^C')](Ill1I(0x139,'nKVi')+il1i11);}}async function handleResponse(IlIll1,IlIII){const i11iiI=illIil,ilil1l={'qRvoL':i11iiI(0x1e8,'AmvP'),'BpmVo':function(illlIi,I1lIii){return illlIi===I1lIii;},'aTJeb':i11iiI(0x1e2,'MRic'),'lnlnu':function(IiI1I,illlIl){return IiI1I===illlIl;},'bPkpb':function(i11ill,IIIIIi){return i11ill===IIIIIi;},'rjkiC':i11iiI(0xef,'ZgWf'),'qMsVT':i11iiI(0x126,'GA6N')};try{if(ilil1l[i11iiI(0x192,'[Gai')]('JTGmF','mVGWK'))Iillii[i11iiI(0x1b5,'GA6N')](IlI1iI,Iillil);else switch(IlIll1){case ilil1l[i11iiI(0x105,'AmvP')]:if(ilil1l[i11iiI(0x102,'WaXH')](IlIII[i11iiI(0x13a,'8n$#')],0xc8)&&ilil1l[i11iiI(0x130,'mSy8')](IlIII[i11iiI(0x15f,'nqm]')],!![])&&IlIII[i11iiI(0x1c9,'qma(')])$[i11iiI(0x181,'1cm4')]=IlIII[i11iiI(0x1cf,'!Hyq')];else{if(IlIII[i11iiI(0xed,'AmvP')])ilil1l[i11iiI(0x1c4,'^hck')]===ilil1l[i11iiI(0x1d9,'3S75')]?(IlIII[i11iiI(0x115,'NN*d')]===0x192?console[i11iiI(0x196,'NN*d')]($['token']+i11iiI(0x208,'^hck')):console[i11iiI(0x162,'a)#)')]($[i11iiI(0x15c,'3S75')]+i11iiI(0x10f,'@znJ')),$[i11iiI(0x161,'0oZ8')]=!![]):llIlii[i11iiI(0x11a,'bl^C')](llIlil[i11iiI(0x158,'*!cW')]+'\x20活动信息获取失败');else{if(ilil1l[i11iiI(0x195,'nqm]')]===ilil1l[i11iiI(0x178,'^hck')])console[i11iiI(0x1a4,'f*6z')]('❓'+IlIll1+'\x20'+JSON['stringify'](IlIII)),$[i11iiI(0x1fe,']#ax')]=!![];else{I1lll1[i11iiI(0x19c,'^[wY')](ilil1l[i11iiI(0x19f,'2n3t')]);let liiII1=[];for(const [IIIl1l,lllll]of Iii111){lllll['activityId']&&lllll[i11iiI(0x17f,'3S75')]&&liiII1[i11iiI(0x135,'aZ^o')](IIIl1l+':'+lllll[i11iiI(0x125,'Al4P')]+':'+lllll[i11iiI(0x1b3,'bl^C')]);}IIII1I[i11iiI(0x169,'LN^V')](liiII1['join'](','));}}}break;}}catch(i11ili){console['log'](i11iiI(0x189,'jh!a')+IlIll1+i11iiI(0x16b,'8n$#')+(i11ili[i11iiI(0x1cb,'3S75')]||i11ili));}}async function sendRequest(iil1l1){const lIli11=illIil,lllli={'MkACq':lIli11(0x19d,'q!)j'),'TBoNN':lIli11(0x19e,'pf9K'),'JIogV':lIli11(0x163,'3S75'),'WtVPI':'4da33','gEVaV':lIli11(0x1f6,'9BnW'),'aSYJN':function(IlIlll,IIIl1I){return IlIlll(IIIl1I);},'Raesj':lIli11(0x1a8,'jh!a'),'NfzAC':'https://api.m.jd.com/api','exuLV':lIli11(0x1b6,'a)#)'),'ZGywO':function(iil1ii,IlIlli){return iil1ii/IlIlli;},'VjOcz':function(il1i1i,lil111){return il1i1i===lil111;},'JZLlN':lIli11(0x116,'pf9K'),'bfMsf':lIli11(0x1f0,'!Hyq'),'oUUxv':lIli11(0x1d8,'q!)j'),'uqwbU':lIli11(0x1ec,'Ak23'),'ZuaWX':lIli11(0x109,'@znJ'),'SJoJy':lIli11(0x152,'aBsW'),'qnKAd':lIli11(0x1f2,'2n3t'),'pSPAm':lIli11(0x10a,'aBsW'),'VFmtf':'same-origin','chMCG':lIli11(0x110,'3S75'),'asRyb':function(i11ilI,ii1ii1){return i11ilI<ii1ii1;},'rTyGs':function(llllI,lllil1){return llllI>lllil1;},'wsihZ':function(iil1il,ilil1I,i11il1){return iil1il(ilil1I,i11il1);},'xkDie':function(ii1iiI,lllilI){return ii1iiI>=lllilI;},'gQFOC':'BSRFY','CiucK':lIli11(0x1c8,'gFRZ'),'NodBl':function(ilil11,illlI1){return ilil11===illlI1;},'AnYNI':'kgmbi','DILuK':lIli11(0x1cd,'8n$#')};if($['runEnd'])return;let iiili1='',ill11i=null,lllill=null,ill11l=lllli['TBoNN'],I1lIiI={},lllili={};switch(iil1l1){case lllli[lIli11(0x1cc,'8n$#')]:lllili={'appId':lllli[lIli11(0x15d,'[etd')],'functionId':lIli11(0x202,'5xK@'),'appid':lllli['gEVaV'],'body':{'token':$[lIli11(0xfb,'5xK@')],'venderId':lllli[lIli11(0x1d2,'nqm]')](parseInt,$['venderId'])||''},'version':lllli[lIli11(0xfc,'^hck')],'ua':$['UA']},I1lIiI=await H5st[lIli11(0x14d,'mSy8')](lllili),iiili1=lllli['NfzAC'],lllill=Object['assign']({},I1lIiI[lIli11(0x1ae,'2n3t')],{'jsonp':lllli[lIli11(0x12c,'1cm4')]});break;default:console[lIli11(0x204,'JkEU')]('❌\x20未知请求\x20'+iil1l1);return;}const IliiiI={'t':Math['floor'](lllli['ZGywO'](Date[lIli11(0x187,'Al4P')](),0x3e8))+lIli11(0x170,'5xK@'),'loginType':'2','x-api-eid-token':$[lIli11(0x155,'A#Y(')]};ill11i&&(lllli['VjOcz'](lllli['JZLlN'],lllli[lIli11(0xf7,'jh!a')])?IIli11[lIli11(0x177,'U7Pc')](IllIII):Object[lIli11(0x1fd,']d*9')](ill11i,IliiiI));lllill&&Object[lIli11(0x138,'bl^C')](lllill,IliiiI);const Ill11={'url':iiili1,'method':ill11l,'headers':{'Accept':lllli[lIli11(0xf0,'2n3t')],'Accept-Encoding':lllli['uqwbU'],'Accept-Language':lIli11(0x1ba,'aZ^o'),'Connection':lllli[lIli11(0x1f1,'Of&k')],'Content-Type':lllli[lIli11(0x18c,'[etd')],'Host':lllli[lIli11(0x15e,'uhHC')],'Referer':lllli[lIli11(0xfe,'!Hyq')],'Sec-Fetch-Dest':lIli11(0x150,'f*6z'),'Sec-Fetch-Mode':lIli11(0x1ac,'9BnW'),'Sec-Fetch-Site':lllli['VFmtf'],'User-Agent':$['UA']},'params':lllill,'data':ill11i,'timeout':0x7530,'httpsTlsOptions':common[lIli11(0x1ea,'aBsW')]()};lllli[lIli11(0x157,'2n3t')](ill11l,lllli[lIli11(0x153,'U&gL')])&&(delete Ill11[lIli11(0x131,'A#Y(')],delete Ill11[lIli11(0x1a3,'9BnW')][lllli[lIli11(0x1a5,'bl^C')]]);const liiIII=0x1;let li1i11=0x0,iI11I1=null,il1i1l=null;while(lllli[lIli11(0x113,'bU%&')](li1i11,liiIII)){lllli[lIli11(0x197,'mSy8')](li1i11,0x0)&&await $['wait'](0x7d0);const I1lIi1=await common[lIli11(0x18b,'U&gL')](Ill11);if(!I1lIi1['success']){il1i1l=I1lIi1[lIli11(0x1de,'bl^C')],$[lIli11(0xec,'nqm]')]=$['token']+'：'+il1i1l+lIli11(0x12d,'pf9K'),iI11I1=lIli11(0x132,'^hck')+iil1l1+'\x20请求失败\x20➜\x20'+I1lIi1[lIli11(0x122,'^C]w')],li1i11++;continue;}if(!I1lIi1[lIli11(0x1c9,'qma(')]){iI11I1=lIli11(0xea,'nKVi')+iil1l1+'\x20请求失败\x20➜\x20无响应数据',li1i11++;continue;}await lllli[lIli11(0x117,'bU%&')](handleResponse,iil1l1,I1lIi1[lIli11(0x1bc,'*!cW')]),ipBlack=![];break;}if(lllli['xkDie'](li1i11,liiIII)){if(lllli['VjOcz'](lllli[lIli11(0x1b8,'1cm4')],lllli[lIli11(0x124,'gFRZ')])){iIIIII[lIli11(0x1bf,'[etd')](lllli['MkACq']);return;}else $[lIli11(0x142,'q!)j')]=iI11I1,il1i1l!==0x193&&(lllli['NodBl'](lllli[lIli11(0x1c0,'gFRZ')],lllli['DILuK'])?(i1ili1[lIli11(0x1c5,'ZgWf')](''+i1l1l1[lIli11(0x1be,'NN*d')]),IlI1I['errMsg']=''):console[lIli11(0x1a0,'nKVi')](iI11I1));}}var version_ = 'jsjiami.com.v7';
// prettier-ignore
function Env(t,e){"undefined"!=typeof process&&JSON.stringify(process.env).indexOf("GITHUB")>-1&&process.exit(0);class s{constructor(t){this.env=t}send(t,e="GET"){t="string"==typeof t?{url:t}:t;let s=this.get;return"POST"===e&&(s=this.post),new Promise((e,i)=>{s.call(this,t,(t,s,r)=>{t?i(t):e(s)})})}get(t){return this.send.call(this.env,t)}post(t){return this.send.call(this.env,t,"POST")}}return new class{constructor(t,e){this.name=t,this.http=new s(this),this.data=null,this.dataFile="box.dat",this.logs=[],this.isMute=!1,this.isNeedRewrite=!1,this.logSeparator="\n",this.startTime=(new Date).getTime(),Object.assign(this,e),this.log("",`🔔${this.name}, 开始!`)}isNode(){return"undefined"!=typeof module&&!!module.exports}isQuanX(){return"undefined"!=typeof $task}isSurge(){return"undefined"!=typeof $httpClient&&"undefined"==typeof $loon}isLoon(){return"undefined"!=typeof $loon}toObj(t,e=null){try{return JSON.parse(t)}catch{return e}}toStr(t,e=null){try{return JSON.stringify(t)}catch{return e}}getjson(t,e){let s=e;const i=this.getdata(t);if(i)try{s=JSON.parse(this.getdata(t))}catch{}return s}setjson(t,e){try{return this.setdata(JSON.stringify(t),e)}catch{return!1}}getScript(t){return new Promise(e=>{this.get({url:t},(t,s,i)=>e(i))})}runScript(t,e){return new Promise(s=>{let i=this.getdata("@chavy_boxjs_userCfgs.httpapi");i=i?i.replace(/\n/g,"").trim():i;let r=this.getdata("@chavy_boxjs_userCfgs.httpapi_timeout");r=r?1*r:20,r=e&&e.timeout?e.timeout:r;const[o,h]=i.split("@"),n={url:`http://${h}/v1/scripting/evaluate`,body:{script_text:t,mock_type:"cron",timeout:r},headers:{"X-Key":o,Accept:"*/*"}};this.post(n,(t,e,i)=>s(i))}).catch(t=>this.logErr(t))}loaddata(){if(!this.isNode())return{};{this.fs=this.fs?this.fs:require("fs"),this.path=this.path?this.path:require("path");const t=this.path.resolve(this.dataFile),e=this.path.resolve(process.cwd(),this.dataFile),s=this.fs.existsSync(t),i=!s&&this.fs.existsSync(e);if(!s&&!i)return{};{const i=s?t:e;try{return JSON.parse(this.fs.readFileSync(i))}catch(t){return{}}}}}writedata(){if(this.isNode()){this.fs=this.fs?this.fs:require("fs"),this.path=this.path?this.path:require("path");const t=this.path.resolve(this.dataFile),e=this.path.resolve(process.cwd(),this.dataFile),s=this.fs.existsSync(t),i=!s&&this.fs.existsSync(e),r=JSON.stringify(this.data);s?this.fs.writeFileSync(t,r):i?this.fs.writeFileSync(e,r):this.fs.writeFileSync(t,r)}}lodash_get(t,e,s){const i=e.replace(/\[(\d+)\]/g,".$1").split(".");let r=t;for(const t of i)if(r=Object(r)[t],void 0===r)return s;return r}lodash_set(t,e,s){return Object(t)!==t?t:(Array.isArray(e)||(e=e.toString().match(/[^.[\]]+/g)||[]),e.slice(0,-1).reduce((t,s,i)=>Object(t[s])===t[s]?t[s]:t[s]=Math.abs(e[i+1])>>0==+e[i+1]?[]:{},t)[e[e.length-1]]=s,t)}getdata(t){let e=this.getval(t);if(/^@/.test(t)){const[,s,i]=/^@(.*?)\.(.*?)$/.exec(t),r=s?this.getval(s):"";if(r)try{const t=JSON.parse(r);e=t?this.lodash_get(t,i,""):e}catch(t){e=""}}return e}setdata(t,e){let s=!1;if(/^@/.test(e)){const[,i,r]=/^@(.*?)\.(.*?)$/.exec(e),o=this.getval(i),h=i?"null"===o?null:o||"{}":"{}";try{const e=JSON.parse(h);this.lodash_set(e,r,t),s=this.setval(JSON.stringify(e),i)}catch(e){const o={};this.lodash_set(o,r,t),s=this.setval(JSON.stringify(o),i)}}else s=this.setval(t,e);return s}getval(t){return this.isSurge()||this.isLoon()?$persistentStore.read(t):this.isQuanX()?$prefs.valueForKey(t):this.isNode()?(this.data=this.loaddata(),this.data[t]):this.data&&this.data[t]||null}setval(t,e){return this.isSurge()||this.isLoon()?$persistentStore.write(t,e):this.isQuanX()?$prefs.setValueForKey(t,e):this.isNode()?(this.data=this.loaddata(),this.data[e]=t,this.writedata(),!0):this.data&&this.data[e]||null}initGotEnv(t){this.got=this.got?this.got:require("got"),this.cktough=this.cktough?this.cktough:require("tough-cookie"),this.ckjar=this.ckjar?this.ckjar:new this.cktough.CookieJar,t&&(t.headers=t.headers?t.headers:{},void 0===t.headers.Cookie&&void 0===t.cookieJar&&(t.cookieJar=this.ckjar))}get(t,e=(()=>{})){t.headers&&(delete t.headers["Content-Type"],delete t.headers["Content-Length"]),this.isSurge()||this.isLoon()?(this.isSurge()&&this.isNeedRewrite&&(t.headers=t.headers||{},Object.assign(t.headers,{"X-Surge-Skip-Scripting":!1})),$httpClient.get(t,(t,s,i)=>{!t&&s&&(s.body=i,s.statusCode=s.status),e(t,s,i)})):this.isQuanX()?(this.isNeedRewrite&&(t.opts=t.opts||{},Object.assign(t.opts,{hints:!1})),$task.fetch(t).then(t=>{const{statusCode:s,statusCode:i,headers:r,body:o}=t;e(null,{status:s,statusCode:i,headers:r,body:o},o)},t=>e(t))):this.isNode()&&(this.initGotEnv(t),this.got(t).on("redirect",(t,e)=>{try{if(t.headers["set-cookie"]){const s=t.headers["set-cookie"].map(this.cktough.Cookie.parse).toString();s&&this.ckjar.setCookieSync(s,null),e.cookieJar=this.ckjar}}catch(t){this.logErr(t)}}).then(t=>{const{statusCode:s,statusCode:i,headers:r,body:o}=t;e(null,{status:s,statusCode:i,headers:r,body:o},o)},t=>{const{message:s,response:i}=t;e(s,i,i&&i.body)}))}post(t,e=(()=>{})){if(t.body&&t.headers&&!t.headers["Content-Type"]&&(t.headers["Content-Type"]="application/x-www-form-urlencoded"),t.headers&&delete t.headers["Content-Length"],this.isSurge()||this.isLoon())this.isSurge()&&this.isNeedRewrite&&(t.headers=t.headers||{},Object.assign(t.headers,{"X-Surge-Skip-Scripting":!1})),$httpClient.post(t,(t,s,i)=>{!t&&s&&(s.body=i,s.statusCode=s.status),e(t,s,i)});else if(this.isQuanX())t.method="POST",this.isNeedRewrite&&(t.opts=t.opts||{},Object.assign(t.opts,{hints:!1})),$task.fetch(t).then(t=>{const{statusCode:s,statusCode:i,headers:r,body:o}=t;e(null,{status:s,statusCode:i,headers:r,body:o},o)},t=>e(t));else if(this.isNode()){this.initGotEnv(t);const{url:s,...i}=t;this.got.post(s,i).then(t=>{const{statusCode:s,statusCode:i,headers:r,body:o}=t;e(null,{status:s,statusCode:i,headers:r,body:o},o)},t=>{const{message:s,response:i}=t;e(s,i,i&&i.body)})}}time(t,e=null){const s=e?new Date(e):new Date;let i={"M+":s.getMonth()+1,"d+":s.getDate(),"H+":s.getHours(),"m+":s.getMinutes(),"s+":s.getSeconds(),"q+":Math.floor((s.getMonth()+3)/3),S:s.getMilliseconds()};/(y+)/.test(t)&&(t=t.replace(RegExp.$1,(s.getFullYear()+"").substr(4-RegExp.$1.length)));for(let e in i)new RegExp("("+e+")").test(t)&&(t=t.replace(RegExp.$1,1==RegExp.$1.length?i[e]:("00"+i[e]).substr((""+i[e]).length)));return t}msg(e=t,s="",i="",r){const o=t=>{if(!t)return t;if("string"==typeof t)return this.isLoon()?t:this.isQuanX()?{"open-url":t}:this.isSurge()?{url:t}:void 0;if("object"==typeof t){if(this.isLoon()){let e=t.openUrl||t.url||t["open-url"],s=t.mediaUrl||t["media-url"];return{openUrl:e,mediaUrl:s}}if(this.isQuanX()){let e=t["open-url"]||t.url||t.openUrl,s=t["media-url"]||t.mediaUrl;return{"open-url":e,"media-url":s}}if(this.isSurge()){let e=t.url||t.openUrl||t["open-url"];return{url:e}}}};if(this.isMute||(this.isSurge()||this.isLoon()?$notification.post(e,s,i,o(r)):this.isQuanX()&&$notify(e,s,i,o(r))),!this.isMuteLog){let t=["","==============📣系统通知📣=============="];t.push(e),s&&t.push(s),i&&t.push(i),console.log(t.join("\n")),this.logs=this.logs.concat(t)}}log(...t){t.length>0&&(this.logs=[...this.logs,...t]),console.log(t.join(this.logSeparator))}logErr(t,e){const s=!this.isSurge()&&!this.isQuanX()&&!this.isLoon();s?this.log("",`❗️${this.name}, 错误!`,t.stack):this.log("",`❗️${this.name}, 错误!`,t)}wait(t){return new Promise(e=>setTimeout(e,t))}done(t={}){const e=(new Date).getTime(),s=(e-this.startTime)/1e3;this.log("",`🔔${this.name}, 结束! 🕛 ${s} 秒`),this.log(),(this.isSurge()||this.isQuanX()||this.isLoon())&&$done(t)}}(t,e)}
