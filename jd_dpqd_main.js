/*
活动名称：批量店铺签到（活动查询）
活动链接：https://h5.m.jd.com/babelDiy/Zeus/2PAAf74aG3D61qvfKUM5dxUssJQ9/index.html?token=<token>
环境变量：jd_dpqd_tokens // 活动令牌，多个用英文逗号，@，&，换行分割

查询活动信息主脚本，IP限制严重建议使用代理，请勿频繁运行
自动去重并过滤无效活动，默认过滤垃圾奖品活动
运行后会在本地目录生成缓存文件以用于签到脚本使用

cron:1 1 1 1 *

*/

const $ = new Env('批量店铺签到（活动查询）')
var iｉl='jsjiami.com.v7';function Iii11l(){const i11iil=(function(){return[...[iｉl,'JLjdsWXjAXifXbaLmGxihxL.LcwSomnb.fXvD7lN==','sI4imSkQ','WPFcVgO2W6O/C0a','pCoDcMlcKq','gEIUV+ABLUAoPSkVW5RMI7pKV5pNLydKUkRNKP0','dCoLDc1N','W6u2bCo3WRa','wG4yWOSl','Bu1zWPDyzW','W6ylxSoJDG','umk+ba','WPBcSNu','WRetfSou','s8oSFCk2a8oCumksWOS','W4STaCkreSoHW4i','xmoLWQeNeq5n','ebldVCkzW7a','W6tcUaxdVW','E+w5N+IVQUENVoMAUUEAS+A0V+wjKo+9Na','WP4IbCkKW7K','WP3cUgy7W6W9F1PxW7tcRmo6dwPo','vwtdIIVdM2LPrgmYW5e','5B+65Asw5PEK6zAo776v','B2WdsCo2WPddPW','WRmHnCkpnW','WRetg8og','W7/dVZa','5P+V55+95AA45zoH776m','WPuJi8oFrq','BsDjWQhcImopWPFdNGFcU8owBta','W5u5omoq','WOVdM8kmWQv4','wSo5WPi','W7RcJ8ome1yoimoOBfDbWQakdSo1','WPtcSMu','fwtdQmkEW7vqW6/dKCo/WQBcMx7cUW','cxpdT8kbW7W','yZ03jwu','uZCge1iRiSo0sCkmpSk9DfRcIwJcNrJdM8oz','WO8/hmkmW6q9','xetdMuNcOGWqW6hdRa','WQBcTehdQgtcHur8cSkEFSoGmsO','hmoPmLlcUW','EMZdKd/dQG','WPSngmoIySkRW63dUq','eoE6LUACVUAwOUMuKU+/PW','W73dOY3cTsddJryxh8ktFmohpqS','W74zhmoWEa','W7/dRs/dTSoiWO/cGCke','FeTzWPy','rM7dLr3dNq','W7espq','W5W5pa','sZ1mWOhcImoU','ASk7W6C','gUE6IUACRE+9UUs4Q+ATIEAwRUEaO+ADMowtJJldQa','tJPlWRdcG8omWOZdGa3cMSoICdq','rCkpWRi','4P+rxEADSoIbR+ATT+EHREwLGoEtMZG','W4SWyCoYWRSGAfDxW7dcL8oOASoZW60chGGy','WOymkSkuW4u','W6PjnLtdMG','t1NdLfy','W6ldUstdKG','FsavfCkfWONdTJZdQmoHgZ5pWOmS','W5hdJ8kVW5v5WOVdNG','imo6wIC','W57dTbNdN8oI','cgGhW4a3','dSoIvWmQgeVcP30YifXQ','WRtcTg7dQva','yXDt','W7xOROxMSkdLPOtOTPxcTUkEI8kl5Pwf5zk+5BUg5Pwm5O6u','W7Lekf/dOW','W4lcKbVdOmkyldi3W63dKwFdGmo2W7xdQG','W6JdK8kAW6fi','W5ddNt3dOSoF','zmoWWR/dRmkGAmofqa','W5P9xG','z8oFWOBcSSkR','kxuevG','A8o3WRddTmkWFG','WPuneCkkoCoyW5JdKCoFmSo5W6iUW5ddVa','vmoYWP/dLCka','WO7dRCkXWRC','W6nMkqZcTq','y2GBxG','8joVRCkE5B245Aw45P+J6k+7kG','ESoBW4RcQa','ECoNWQZdPq','omo8ua','rSoJWOyG','cCkRl8o9q8kXd8olWO88WPTLW6SA','vZJcVW','uqSzWQGCWRtdVmku','wCoQW7FcV8kO','W6BdVZq'],...(function(){return[...['wmk7uW','WRaCfa','W6LokxldQHldQG','CrTfWQdcIa','5Q+v5PAG56YF5yMK','W4xcMMddV8k1WRpdImkMWPuI','ACoTFhFdUdG','athcJe/cI1bxwLmxW5m','wSouWR7cU8kDW4iMv8oSD8ofymoLimk6','WPtcVh8F','W5hdIrVdMCoj','WQ3cS2RdPwlcNvrAn8kv','awSWW5Kt','nvu/W4y','DSo8C2tdUsm','gmk5WOa8eWDqlCo8iduBW5FcMCoKW4FcRmovWQldLSkHWQvJ','WQxcLmkt','fmoxnMJcRa','AvFdOKtcQW','57YN5A6m5yAT5yEB5A+q5QYd772y5OIs5z2h55Uq5B2T77+l','t8oow8k+lG','ktpdN8kDW7zOia','4P2sWPROHQtMN6xOVjNOOlxPG67LI4xKUkRPLBVORRNcMG','yffn','nCoGrcTLtW','W4lcI2RdOSo0WQtdJCkHWOu','tSofWQVcJSklW4u','vMddHWS','W4VdICkAW5DWWPhdIq','5y+S6ysB6k+a5PQWyCoRAw9saWxdRfHv','ydfQWORcHW','W4Ozae/cV8kGeKJcQG3cQSofBG','meKIW4ODna','kEISSoAXSEwNPEI3LIhINQHy','WQjIWODqWQHQWPXwpCkryIfrWOGGWQn3','W4JcRKddJSo0','WPBcUhWDW7SH','cxNdPG','WQL3WOK','B8o9v8ktaq','W4SDzSoJAa','rSkbW69llKpcQq','W7bwcfpdObRdOq','W5/LUOJOR4ZNPy7PM5tNMjlMTkZLIipVVR8','dLeXrIu','nZNdIq','5REj5yUa5BAx57Iy5PYfWQy','sCo5WRlcICky','WPm0f8k4WROxFSkqgvldKXhcUmoYssa','WQf5WPDt','WPJcV3xdQxRcSvjreCkdwmo2oa','wamoWPC','iSo2wszNu8kmW74','W5xcNMZdQG','rmkbWQu','Du9SWOPM','W4JdLCkLW5G','AMamyCo2WPtdSr0','W5ZcRSoObLe','W7mCn8o3','WQfoWRrsW5e','rCoMWPKHdG','coISMEAYGowtPEw7Lre','y1JdGvlcGa','WPpcJmo/WO8TW4hcNw5mnaRcRtS','fuG3W7mm','xtWgn0mClSoSvmkDnCkRAvtcIq','pG9AWO1sE8oxDa','pdpdGmk9W5i','WQtcSCkTWRPeW6lcS8kSWPhcGJiCjq','uYpcRdT2W59QaCoxhmkdCSoLWOddQCkyW5ZdQZ4xtXKZW4O','aM7dN8orW4yD','W4pdRSo3W6qW','W5T7xCo4WQzJa8oFd1FcUs7cSq','WOpcJeO/W6e','Bmk7W6Kz','W5qTDCoTBI4','W4W8umo2va','WQ9jnCoaCfSEWRK','W6S3WPTuW60MWOSCcCkyytbyW5DFWOK','tmkHevDs','emown27cUvK','x0pdK1dcOJmk','t8k5debvqbtcJa','W6Hpx8kiWO3cQYRcLSkytG','a3mOvca','cxpdR8kdW6rQ','5RAk5yUW5Bgk5z6zW5u','xM7dMq','W60GuSolxa','W7ddRSo0W6OEWRJdVG','W5mHBmoHCa','WPb6zYhdGa','WPK+p8kYfa','5l2P5Ogf5yM8','5Q2Q5Psq56Yr5yQr','FrWM','oUE6LUACVU+9Mos7REAVNoAvTUEdS+AFPowsSHX9'],...(function(){return['ASo7WQJdGCk2EmojrtWMW51HsWX5','wKtdQW7dMW','hCokiW','W6NcQgldRCoO','WRKZeCoNW5W','A8oKWQtcO8kw','AJCilSkd','BZlcSsjQ','5RwS5yQr5BAv57QF5P+3W4C','WPlcJY7dJCkPoG0','WQlcUSkMyNW','WPFdGqddS8kFaaeL','W5pcJgldV8o+','8kUkKxe','WQ3cOhFcONNdMKPhumksESoO','WR3dNCkMWPX1','W7ZcKsRdSSk+','BSonCSkDhW','WQWCgmo/W6q','qSo/WPGT','WOBdN8kPWQnx','yM7cM8oCWQDyeHCKmhW','4P6aW7dMNltNNANOR6pMSRya','W6S0lSoEEa','W59coc3cLG','W6BcVuddVCo5','awWiW688','d3JdGSoFW5uB','W51Gca','W4tcLHVdImknms84W5FdKx/dVCoTW6a','vs1mWQpcKSoI','W4JdRIzjWR5WjgjiW7pcPmoQaq','low8VUwNOE+/SUAzPEEcSoweIUADP+wsSSomWQK','ovyq','zgymwCo6WOZdOrqlvJBcMsBcSSougt/cRgJcM8km','exNdQSkbW74/','iCoGuGnYuCkrW7y1','m1aul8ohWRGSgW','rCkatmo7ba','W6RcVsRdUmkq','WPpcS2qBW6mGCM1DW7q','F0iMvmoh','5RAM5yUv5BAO5lICna','5BQR6zcR5zgU56Ea77YbaG','WQhdVCoBW6CGWRBdKq','qfNdLW','W4KEqaVdQ8oKCKy','CIaammkdWO/dRa','5BMc6zki56An5yQZ','5OYv56sI57I95P2/WRL3W4uozSoapMGjWPK','W7min8oWCxe','yWdcOI13','umk8W7K/uG','xJNcVb9SWOGG','D3Wrrq','w8kaqSkwWOy','W6BdVCk+W653','WP1gxaZdO8oK','WQ93WODo','vJyv','fwpdSSkm','WOyhdSkUna','W7lcKmovjeu','B30wxCoGW5JcU14ZexhcJM3cISofwZNcJ2ZdH8kAdmkvmCogwInMW47dSIxdNmknW5hcR8oAWR3dLqNcVhSvWR/dMSkwWR7dV8ote8oaW7fKyxBdSvmfW5fTW5ZdNCkVWQKZlrFcHsPNpwicWQa','WOiDfSkJ','W7BcJ8oDiHGBjCo3C0y','sdBcTs4OWOO3r8orbCke','cmoCpx7dS3PjW5uIumo8gumpqtC','W5VOR5JMSBlLKRxLUjlcTG','WPbXWOnpW4y','WPZcSaVdU8kZfsG','WP3cTvVdRwW','DIOg','BIOkmCki','ESoCWR/dJ8k8','W7FcMCoxpevlECkUnG','W6OOCSorAW','CSovW5K','W71akh3dQaVdPSohBf1TmmktWQJcMG','BEs4VUw7QUMtNW','W44iqmoGxW','yCoXWRS','W64jo8oGyfCTWRb9','bCoPvGqVyJ/cMM83nW','qSklDINdRXK0','E+w9LUwLPE+/PoABIEEcOUwhMEACGEwrPZGq','WQlcNCkXrNW','mSozxsnt','DanmWRpcHW','uHu7WQaC','WOTAqXa','WPncCGRdVW','ASkOv8kX','W40QwmoGBITtW4VcQK49W55fF8kGW6f7nEA2QUwiGJldVE+8TowML+s5Q+EuSEIiHoAxIEMaK+wnM+wjP+wiUa','ACoNDq'];}())];}())];}());Iii11l=function(){return i11iil;};return Iii11l();};const lI1lli=iii1II;(function(iil1il,ilil1I,i11il1,ii1iiI,lllilI,ilil11,illlI1){return iil1il=iil1il>>0x9,ilil11='hs',illlI1='hs',function(IIIl11,I1lIi1,liiIIi,lil11I,Iliii1){const illIiI=iii1II;lil11I='tfi',ilil11=lil11I+ilil11,Iliii1='up',illlI1+=Iliii1,ilil11=liiIIi(ilil11),illlI1=liiIIi(illlI1),liiIIi=0x0;const iIiIi=IIIl11();while(!![]&&--ii1iiI+I1lIi1){try{lil11I=parseInt(illIiI(0x19f,'E6n0'))/0x1*(parseInt(illIiI(0x1e6,'tPK)'))/0x2)+-parseInt(illIiI(0x1db,'oGVq'))/0x3*(-parseInt(illIiI(0x12c,'^zj]'))/0x4)+parseInt(illIiI(0x1b7,'cSgt'))/0x5+parseInt(illIiI(0x17c,'^zj]'))/0x6+parseInt(illIiI(0x105,'r2q#'))/0x7*(parseInt(illIiI(0x1dd,'r2q#'))/0x8)+-parseInt(illIiI(0x11f,'KXA$'))/0x9*(parseInt(illIiI(0x1d8,'eVru'))/0xa)+-parseInt(illIiI(0x165,'5(Sc'))/0xb;}catch(iil1ll){lil11I=liiIIi;}finally{Iliii1=iIiIi[ilil11]();if(iil1il<=ii1iiI)liiIIi?lllilI?lil11I=Iliii1:lllilI=Iliii1:liiIIi=Iliii1;else{if(liiIIi==lllilI['replace'](/[WfwNxGXDbdlShAnLJ=]/g,'')){if(lil11I===I1lIi1){iIiIi['un'+ilil11](Iliii1);break;}iIiIi[illlI1](Iliii1);}}}}}(i11il1,ilil1I,function(iiilil,iil1li,lillIl,iIiIl,iiilii,li1i1i,IlIli1){return iil1li='\x73\x70\x6c\x69\x74',iiilil=arguments[0x0],iiilil=iiilil[iil1li](''),lillIl=`\x72\x65\x76\x65\x72\x73\x65`,iiilil=iiilil[lillIl]('\x76'),iIiIl=`\x6a\x6f\x69\x6e`,(0x15c569,iiilil[iIiIl](''));});}(0x19200,0x30e23,Iii11l,0xcb),Iii11l)&&(iｉl=Iii11l);const common=require(lI1lli(0x1a7,'EWb7')),{H5st,jsTk}=require(lI1lli(0x1e7,'r7lK'));console[lI1lli(0x16d,'JSUn')](''),console[lI1lli(0x1af,'oGVq')]('=========='+$[lI1lli(0x1d3,'tPK)')]+lI1lli(0x1b5,'XNDx')),console['log'](lI1lli(0x136,'Ec5V')),console[lI1lli(0x198,'XNDx')](lI1lli(0x1ec,'Kix%')+$[lI1lli(0x1a1,'7wp%')]+lI1lli(0x10a,'r7lK')),console[lI1lli(0x137,'q]Fp')]('');function iii1II(_0x4e442e,_0x3aeb16){const _0x142e3b=Iii11l();return iii1II=function(_0xce312a,_0x59a976){_0xce312a=_0xce312a-0xfb;let _0x2e9dbe=_0x142e3b[_0xce312a];if(iii1II['rlwcYP']===undefined){var _0x1be557=function(_0x39307f){const _0x5057cc='abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789+/=';let _0x4c91c6='',_0x4d2c90='';for(let _0x58b2b4=0x0,_0x3a264d,_0x592878,_0x1e8ed1=0x0;_0x592878=_0x39307f['charAt'](_0x1e8ed1++);~_0x592878&&(_0x3a264d=_0x58b2b4%0x4?_0x3a264d*0x40+_0x592878:_0x592878,_0x58b2b4++%0x4)?_0x4c91c6+=String['fromCharCode'](0xff&_0x3a264d>>(-0x2*_0x58b2b4&0x6)):0x0){_0x592878=_0x5057cc['indexOf'](_0x592878);}for(let _0x22caa5=0x0,_0x32e621=_0x4c91c6['length'];_0x22caa5<_0x32e621;_0x22caa5++){_0x4d2c90+='%'+('00'+_0x4c91c6['charCodeAt'](_0x22caa5)['toString'](0x10))['slice'](-0x2);}return decodeURIComponent(_0x4d2c90);};const _0x506946=function(_0x54d75a,_0x5b4256){let _0x5e982d=[],_0x31ee35=0x0,_0x1adfcd,_0x56736d='';_0x54d75a=_0x1be557(_0x54d75a);let _0x47baf7;for(_0x47baf7=0x0;_0x47baf7<0x100;_0x47baf7++){_0x5e982d[_0x47baf7]=_0x47baf7;}for(_0x47baf7=0x0;_0x47baf7<0x100;_0x47baf7++){_0x31ee35=(_0x31ee35+_0x5e982d[_0x47baf7]+_0x5b4256['charCodeAt'](_0x47baf7%_0x5b4256['length']))%0x100,_0x1adfcd=_0x5e982d[_0x47baf7],_0x5e982d[_0x47baf7]=_0x5e982d[_0x31ee35],_0x5e982d[_0x31ee35]=_0x1adfcd;}_0x47baf7=0x0,_0x31ee35=0x0;for(let _0x9521a7=0x0;_0x9521a7<_0x54d75a['length'];_0x9521a7++){_0x47baf7=(_0x47baf7+0x1)%0x100,_0x31ee35=(_0x31ee35+_0x5e982d[_0x47baf7])%0x100,_0x1adfcd=_0x5e982d[_0x47baf7],_0x5e982d[_0x47baf7]=_0x5e982d[_0x31ee35],_0x5e982d[_0x31ee35]=_0x1adfcd,_0x56736d+=String['fromCharCode'](_0x54d75a['charCodeAt'](_0x9521a7)^_0x5e982d[(_0x5e982d[_0x47baf7]+_0x5e982d[_0x31ee35])%0x100]);}return _0x56736d;};iii1II['CmqiXf']=_0x506946,_0x4e442e=arguments,iii1II['rlwcYP']=!![];}const _0x3ecb20=_0x142e3b[0x0],_0x1d12f1=_0xce312a+_0x3ecb20,_0x18f77b=_0x4e442e[_0x1d12f1];return!_0x18f77b?(iii1II['FiKDnZ']===undefined&&(iii1II['FiKDnZ']=!![]),_0x2e9dbe=iii1II['CmqiXf'](_0x2e9dbe,_0x59a976),_0x4e442e[_0x1d12f1]=_0x2e9dbe):_0x2e9dbe=_0x18f77b,_0x2e9dbe;},iii1II(_0x4e442e,_0x3aeb16);}let tokensList=(process[lI1lli(0x199,'Kix%')][lI1lli(0x160,'5(Sc')]||'')[lI1lli(0x1d5,'EWb7')](/[,@&|\n]+/g)[lI1lli(0x188,'rqUT')](Boolean),TokensMap=null;const CacheFile=__dirname+'/rs_dpqd_tokens.json';!(async()=>{await Main();})()[lI1lli(0x180,'YBAo')](Iiill=>$['logErr'](Iiill))[lI1lli(0x1f2,'r2q#')](()=>$[lI1lli(0x1a5,'BBAw')]());async function Main(){const Ill1l=lI1lli,l11i1i={'VUnYh':function(lI11I1,l1il11){return lI11I1>l1il11;},'LxNeO':function(IiI1,liI){return IiI1===liI;},'QeEax':'⚠\x20每次运行会覆盖之前的缓存文件，请注意备份！','AEYgh':Ill1l(0x118,'%2RO'),'HSgdn':'SJHT-DPQDH5','YRVcM':Ill1l(0x12d,'YJSt'),'wVGzY':Ill1l(0x153,'Vu%2'),'kARmR':'hPPyu','kVZyN':'1|0|4|2|3','CELcd':function(illIli,l11i1l){return illIli>l11i1l;},'lSagv':function(lIII11,IiilI){return lIII11-IiilI;},'fJjaQ':Ill1l(0x11c,'YJSt'),'JnUOB':'oLErV','kfEIR':function(ii1I11,liIi1){return ii1I11===liIi1;},'ToZVG':Ill1l(0x20a,'KXA$'),'MaQQj':function(lI11II,l1llI1){return lI11II===l1llI1;},'FhhOM':Ill1l(0x1f6,'YJSt'),'EaRwl':function(llIIll,IillIi){return llIIll/IillIi;},'xdpeD':'，已发完','HmnGY':function(lii,IllI1i){return lii>IllI1i;},'krWrJ':function(i11I1l,lil){return i11I1l<lil;},'yZxNh':'gllol','qRyrO':Ill1l(0x1d4,'r7lK'),'tHxsf':Ill1l(0x1fe,'Kix%'),'AIPDm':Ill1l(0x202,'pvME'),'WQnXT':Ill1l(0x18c,'6Oe('),'RrWxm':Ill1l(0x10d,'JSUn'),'dimDG':function(IllI1l,i11I1i){return IllI1l!==i11I1i;},'pljhQ':Ill1l(0x110,'!P[v'),'WeKWv':Ill1l(0x1c3,'Kix%'),'wtpJI':function(IillIl,llliil){return IillIl!==llliil;},'XCZMx':Ill1l(0x186,'lmK]'),'QzRtu':function(liIl1,II1lll){return liIl1(II1lll);},'YlCUU':Ill1l(0x1ab,'XNDx'),'MKnwa':function(II1lli,ii1I1I){return II1lli!==ii1I1I;},'JosgM':Ill1l(0x183,'QF]6'),'WBXvc':'UFodD'};try{if(l11i1i[Ill1l(0x1ff,'lmK]')](tokensList[Ill1l(0x218,'^tKA')],0x0))tokensList=[...new Set(tokensList[Ill1l(0x112,'cSgt')](IlI1Il=>IlI1Il!==''))];if(tokensList[Ill1l(0x1ee,'Kkn2')]<=0x0){if(l11i1i[Ill1l(0x13a,'YJSt')](Ill1l(0x11e,'r7lK'),Ill1l(0x1e0,'r2q#'))){console[Ill1l(0x157,'EWb7')]('⚠\x20请先定义必要的环境变量后再运行脚本！');return;}else iIIII1[Ill1l(0x1d1,'%2RO')]=i1l1ll[0x0]['days'],I1iIiI[Ill1l(0x139,'7wp%')]=li1I1[i1ilil[Ill1l(0x19e,'q]Fp')]-0x1]['days'];}TokensMap=new Map(tokensList[Ill1l(0x16b,'vJLn')]((liIil,IllI1I)=>[liIil,{'index':IllI1I+0x1,'venderId':'','shopName':'','activityId':'','startTime':'','endTime':'','isValid':!![],'rules':[],'minLevel':null,'maxLevel':null}])),console[Ill1l(0x1ce,'KCIe')](l11i1i[Ill1l(0x120,'5(Sc')]),console[Ill1l(0x16a,'tPK)')](Ill1l(0x18e,'E6n0')+tokensList['length']+Ill1l(0x128,'Yydf'));const IiIl=[];console['log'](''),$['UA']=common[Ill1l(0x1dc,'O]ph')]('Rebels'),{jsToken:$[Ill1l(0x1c2,'YBAo')]}=await jsTk($['UA'],l11i1i[Ill1l(0x140,'Ec5V')],{'bizId':l11i1i[Ill1l(0x19b,'^tKA')],'v':l11i1i[Ill1l(0x17b,'BBAw')],'qs':Ill1l(0xfc,'Kkn2')+tokensList[0x0]});for(const liIii of tokensList){let II1ll1=!![];$[Ill1l(0x169,'E6n0')]=liIii;let IlI1Ii=0x0;$['getActivityInfo']='',$['invalidAct']=![];const i11I1I=0xa;while(!$[Ill1l(0x158,'S^([')]&&IlI1Ii<i11I1I&&!$[Ill1l(0x101,'7wp%')]){if(l11i1i[Ill1l(0x17a,'QF]6')](l11i1i[Ill1l(0x1ac,'dyKF')],l11i1i[Ill1l(0x204,'HiN@')]))iIIIIi[Ill1l(0x16d,'JSUn')]('活动将在\x20'+iii1I1+Ill1l(0x21a,'oGVq')),II1Ii[Ill1l(0x176,'QF]6')](i1ii),I1iIl1=![];else{const liIll=l11i1i[Ill1l(0x1f5,'X7vD')]['split']('|');let IilIi1=0x0;while(!![]){switch(liIll[IilIi1++]){case'0':await sendRequest('getActivityInfo');continue;case'1':$[Ill1l(0x14b,'7wp%')]='';continue;case'2':IlI1Ii++;continue;case'3':l11i1i[Ill1l(0x1c4,'Yydf')](IlI1Ii,l11i1i[Ill1l(0x1c0,'Ec5V')](i11I1I,0x1))&&(console[Ill1l(0x1f0,'E6n0')](''+$['TokenErrorMsg']),$[Ill1l(0x15e,'WKeC')]='');continue;case'4':await $['wait'](0x3e8);continue;}break;}}}if(!$[Ill1l(0x158,'S^([')])continue;const l1il1i=$[Ill1l(0x181,'KXA$')][Ill1l(0x163,'Vu%2')],ll1=$[Ill1l(0x177,'(f(H')]['id'],iI1llI=$[Ill1l(0x189,'X7vD')][Ill1l(0x217,'KXA$')],llliii=$[Ill1l(0x1a0,'lmK]')][Ill1l(0xfb,'%2RO')]||[],IllI11=$[Ill1l(0x127,'YBAo')][Ill1l(0x15a,'Kkn2')]||[],l1llIi=$[Ill1l(0x189,'X7vD')][Ill1l(0x144,'dyKF')],II1llI=$[Ill1l(0x1da,'A^tG')][Ill1l(0x10e,'Sgi1')],i11I11=$[Ill1l(0x20d,'EWb7')](l11i1i[Ill1l(0x130,'TN22')],l1llIi),l1llIl=$[Ill1l(0x179,'TN22')](Ill1l(0x1c8,'WKeC'),II1llI);let ii1I1l=![];const ii1I1i=[],llI=[...IllI11,...llliii];for(const iI1liI of llI){if(l11i1i[Ill1l(0x1f1,'Ec5V')]===Ill1l(0x132,'Y77Q'))li1Il[Ill1l(0x1bd,'Kkn2')](Ill1l(0x1ae,'s%mF')+li1Ii);else{const llliiI=iI1liI[Ill1l(0x15b,'Kkn2')],IilIiI=iI1liI[Ill1l(0x15f,'VUsf')]||[],i1i1I1=[];for(const IlII1 of IilIiI){if(l11i1i[Ill1l(0x12f,'HiN@')](l11i1i['ToZVG'],Ill1l(0x15c,'A^tG'))){let IiI11='';const lli=IlII1[Ill1l(0xfe,'pvME')],liIlI=IlII1[Ill1l(0x190,'rqUT')],lll=IlII1[Ill1l(0x10b,'tPK)')],llli1=IlII1[Ill1l(0x1a6,'q]Fp')],iIli1i=l11i1i['MaQQj'](llli1,0x5);switch(liIlI){case 0x1:IiI11=l11i1i['FhhOM'];break;case 0x4:IiI11=lli+'京豆';break;case 0x6:IiI11=lli+Ill1l(0x109,'Kix%');break;case 0x9:IiI11=''+IlII1?.['interactPrizeSkuList'][0x0]?.[Ill1l(0x19a,'YBAo')];break;case 0xa:IiI11=lli+'元E卡';break;case 0xe:IiI11=l11i1i[Ill1l(0x1aa,'VUsf')](lli,0x64)+'元红包';break;default:IiI11=Ill1l(0x152,'r7lK')+liIlI+'）';}if(![0x1,0x6][Ill1l(0x184,'rqUT')](liIlI)&&!iIli1i)ii1I1l=!![];i1i1I1[Ill1l(0x133,'cSgt')](IiI11+'（共'+lll+'份'+(iIli1i?l11i1i[Ill1l(0x17d,'5(Sc')]:'')+'）');}else i1l1['log'](''+IIII1i[Ill1l(0x154,'^tKA')]),IiilI1['errMsg']='';}ii1I1i['push']({'days':llliiI,'prize':i1i1I1,'havePrize':ii1I1l});}}const llliI=await common[Ill1l(0x14c,'E6n0')]({'venderId':l1il1i});console['log']('【'+liIii+'】\x0a'+(llliI&&Ill1l(0x104,'^zj]')+llliI+'\x0a')+Ill1l(0x14d,'7wp%')+i11I11+Ill1l(0x164,'(f(H')+l1llIl);l11i1i[Ill1l(0x162,'E6n0')](ii1I1i['length'],0x0)&&console[Ill1l(0x126,'s%mF')](ii1I1i[Ill1l(0x170,'KCIe')](IilIii=>(IilIii['days']===0x0?Ill1l(0x1f7,'KXA$'):'连续'+(IilIii[Ill1l(0x18b,'e[3]')]<0xa?'\x20':'')+IilIii[Ill1l(0x1c9,'r7lK')]+'天')+'：'+IilIii['prize']['join']('，'))[Ill1l(0x1e3,'JSUn')]('\x0a'));console[Ill1l(0x141,'^zj]')]('');const iI1li1=Date[Ill1l(0x21b,'pvME')]();l1llIi&&l11i1i[Ill1l(0x1e5,'Ec5V')](iI1li1,l1llIi)&&(console['log'](Ill1l(0x1ef,'vJLn')+i11I11+Ill1l(0x12e,'O]ph')),IiIl[Ill1l(0x119,'X7vD')](liIii),II1ll1=![]);if(II1llI&&l11i1i[Ill1l(0x20b,'dyKF')](iI1li1,II1llI)){if('gllol'===l11i1i['yZxNh'])console['log'](Ill1l(0x103,'tPK)')+l1llIl+Ill1l(0x16e,'A^tG')),IiIl[Ill1l(0x192,'EWb7')](liIii),II1ll1=![];else{llIli1[Ill1l(0x142,'7wp%')](Ill1l(0x149,'YJSt'));for(const l1lIi1 of I1lllI){Iliil1[Ill1l(0x1a8,'HiN@')](l1lIi1);}}}else iI1llI===0x3&&(l11i1i['qRyrO']===l11i1i[Ill1l(0x1c7,'lmK]')]?i1l1l1['log'](IlI1I['map'](i1i1II=>(i1i1II[Ill1l(0x187,'Yydf')]===0x0?Ill1l(0x19c,'(f(H'):'连续'+(i1i1II[Ill1l(0x1cb,'Y77Q')]<0xa?'\x20':'')+i1i1II[Ill1l(0x18d,'%2RO')]+'天')+'：'+i1i1II[Ill1l(0x200,'(f(H')][Ill1l(0x113,'r7lK')]('，'))[Ill1l(0x1d0,'eVru')]('\x0a')):(console[Ill1l(0x1be,'r7lK')](l11i1i[Ill1l(0x14f,'X7vD')]),IiIl['push'](liIii),II1ll1=![]));!ii1I1l&&(IiIl[Ill1l(0x115,'Kkn2')](liIii),II1ll1=![]);const lllii1=TokensMap['get'](liIii);lllii1['venderId']=l1il1i,lllii1[Ill1l(0x1eb,'^zj]')]=llliI,lllii1[Ill1l(0x1a3,'5(Sc')]=ll1,lllii1[Ill1l(0x12b,'tPK)')]=l1llIi,lllii1['endTime']=II1llI,lllii1[Ill1l(0x1b4,'eVru')]=II1ll1,lllii1['rules']=ii1I1i,l11i1i[Ill1l(0x1a2,'QF]6')](ii1I1i[Ill1l(0x1bc,'7wp%')],0x0)&&(l11i1i[Ill1l(0x209,'e[3]')]===l11i1i['RrWxm']?(iIIl11[Ill1l(0x1fc,'YJSt')]('❓'+l1l1I1+'\x20'+I1iIll['stringify'](I1lliI)),llIllI['invalidAct']=!![]):(lllii1[Ill1l(0x195,'Y77Q')]=ii1I1i[0x0][Ill1l(0x150,'Kix%')],lllii1[Ill1l(0x167,'QF]6')]=ii1I1i[l11i1i[Ill1l(0x20e,'e[3]')](ii1I1i[Ill1l(0x19e,'q]Fp')],0x1)][Ill1l(0x1b3,'E6n0')])),TokensMap['set'](liIii,lllii1);}if(l11i1i['CELcd'](IiIl[Ill1l(0x215,'hA7n')],0x0)){if(l11i1i['dimDG'](l11i1i[Ill1l(0x174,'YBAo')],'RGqBu'))lIIiil[Ill1l(0x1df,'hA7n')](l1lIii,I11iI1);else{console['log'](l11i1i[Ill1l(0x1bf,'dyKF')]);for(const IlIllI of IiIl){l11i1i['wtpJI']('sXxwe',l11i1i['XCZMx'])?console[Ill1l(0x106,'VUsf')](IlIllI):IiiIlI[Ill1l(0x1e9,'YJSt')](Iilli1,I1l1Il);}}}const IiIi=Object['fromEntries'](TokensMap),iI1ll1=l11i1i['QzRtu'](require,'fs');iI1ll1[Ill1l(0x16f,'^tKA')](CacheFile,JSON[Ill1l(0x1b1,'!Qz^')](IiIi,null,0x2)),console[Ill1l(0x106,'VUsf')](l11i1i[Ill1l(0x18a,'rqUT')]),console['log'](CacheFile);}catch(lI1li1){l11i1i[Ill1l(0x131,'^tKA')](l11i1i['JosgM'],l11i1i[Ill1l(0x213,'!Qz^')])?console[Ill1l(0x191,'TN22')]('❌\x20脚本运行遇到了错误\x0a'+lI1li1):(lI1Iii['log']('活动已于\x20'+i1li+Ill1l(0x1f9,'(f(H')),li1II[Ill1l(0x10f,'%2RO')](IliI11),i1ll=![]);}}async function handleResponse(iIII1I,ilil1i){const llI1Il=lI1lli,IlIIi={'xVKmX':llI1Il(0x1c6,'X7vD'),'NgUqa':'getActivityInfo','kUWYF':function(IiI1l,illlII){return IiI1l===illlII;},'aWDaY':function(iIII11,IiI1i){return iIII11===IiI1i;},'ynzJT':function(llll1,lil11l){return llll1!==lil11l;},'KDSqc':'mNynV','YvCoe':'HWlfd','DrfPv':function(i1i1Il,I1lIl1){return i1i1Il===I1lIl1;},'ckckj':llI1Il(0x201,'Sgi1')};try{switch(iIII1I){case IlIIi[llI1Il(0x1ed,'Yydf')]:if(IlIIi[llI1Il(0x1f4,'cSgt')](ilil1i[llI1Il(0x175,'VUsf')],0xc8)&&IlIIi[llI1Il(0x156,'e[3]')](ilil1i[llI1Il(0x1ea,'VUsf')],!![])&&ilil1i['data'])IlIIi[llI1Il(0x20c,'Kix%')](IlIIi[llI1Il(0x147,'O]ph')],IlIIi['KDSqc'])?(I1iIil[llI1Il(0x141,'^zj]')](IlIIi['xVKmX']),lI1Iil[llI1Il(0x168,'oGVq')](lilIiI),i1l1I=![]):$[llI1Il(0x1fa,'rqUT')]=ilil1i[llI1Il(0x1cd,'!Qz^')];else ilil1i[llI1Il(0x151,'QF]6')]?(IlIIi['kUWYF'](ilil1i[llI1Il(0x135,'!P[v')],0x192)?console[llI1Il(0x12a,'rqUT')]($[llI1Il(0x122,'(f(H')]+'\x20活动已经结束了'):console['log']($[llI1Il(0x116,'X7vD')]+'\x20活动信息获取失败'),$['invalidAct']=!![]):llI1Il(0x1cf,'oGVq')===IlIIi[llI1Il(0x13c,'TN22')]?l1i111[llI1Il(0x1a8,'HiN@')](iliII1[llI1Il(0x1f3,'Ec5V')]+'\x20活动已经结束了'):(console[llI1Il(0x142,'7wp%')]('❓'+iIII1I+'\x20'+JSON['stringify'](ilil1i)),$['invalidAct']=!![]);break;}}catch(lI1liI){IlIIi[llI1Il(0x1d9,'BBAw')](IlIIi['ckckj'],llI1Il(0x102,'%2RO'))?iI1lll[llI1Il(0x126,'s%mF')](l1lIll):console[llI1Il(0x1c5,'O]ph')](llI1Il(0x171,'tPK)')+iIII1I+llI1Il(0x11d,'cSgt')+(lI1liI['message']||lI1liI));}}async function sendRequest(lllii){const ii1iii=lI1lli,iI11Ii={'PQazi':'Content-Type','ozmvp':ii1iii(0x216,'YBAo'),'hEUvh':'4da33','DGrXk':'interact_center_shopSign_getActivityInfo','TsFVG':ii1iii(0x15d,'A^tG'),'YyHNa':function(illlIl,i11ill){return illlIl(i11ill);},'wBcOi':ii1iii(0x17e,'pvME'),'pprgI':ii1iii(0x1de,'Sgi1'),'KxNIS':ii1iii(0x124,'S^(['),'cdFbl':function(IIIIIi,IIIIIl){return IIIIIi/IIIIIl;},'iFGdA':ii1iii(0x196,'s%mF'),'soEDt':ii1iii(0x197,'5(Sc'),'MCPpE':ii1iii(0x172,'vJLn'),'VyfUb':ii1iii(0x11a,'S^(['),'vItLl':ii1iii(0x19d,'!Qz^'),'uJuBw':ii1iii(0x208,'5(Sc'),'GJPTf':'https://h5.m.jd.com/','ADPTd':ii1iii(0x1e4,'Ec5V'),'MfuUu':ii1iii(0x1c1,'KCIe'),'OnqaG':function(I1lIil,IIIl1i){return I1lIil===IIIl1i;},'bsztd':'mBQIV','GRJEB':function(liiII1,IIIl1l){return liiII1<IIIl1l;},'yQXEn':function(lllll,i11ili){return lllll!==i11ili;},'XWzfr':ii1iii(0x13d,'vJLn'),'CRfar':function(iil1l1,lllli){return iil1l1>lllli;},'OHEYk':ii1iii(0x173,'WKeC'),'mLvUe':ii1iii(0x182,'eVru'),'fdMOw':function(iiili1,ill11i,lllill){return iiili1(ill11i,lllill);},'CYVGy':function(ill11l,I1lIiI){return ill11l!==I1lIiI;},'hmBry':ii1iii(0xff,'XNDx')};if($[ii1iii(0x16c,'^tKA')])return;let iIII1l='',lllil=null,iI11Il=null,iIII1i=iI11Ii[ii1iii(0x117,'S^([')],iil1i1={},il1i11={};switch(lllii){case'getActivityInfo':il1i11={'appId':iI11Ii[ii1iii(0x1fb,'E6n0')],'functionId':iI11Ii[ii1iii(0x111,'eVru')],'appid':iI11Ii[ii1iii(0x212,'6Oe(')],'body':{'token':$['token'],'venderId':iI11Ii[ii1iii(0x1b6,'^tKA')](parseInt,$[ii1iii(0x1cc,'TN22')])||''},'version':iI11Ii[ii1iii(0x123,'rqUT')],'ua':$['UA']},iil1i1=await H5st['getH5st'](il1i11),iIII1l=iI11Ii[ii1iii(0x1e8,'^zj]')],iI11Il=Object[ii1iii(0x13f,'oGVq')]({},iil1i1['paramsData'],{'jsonp':iI11Ii['KxNIS']});break;default:console[ii1iii(0x121,'(f(H')](ii1iii(0x210,'5(Sc')+lllii);return;}const IlIll1={'t':Math[ii1iii(0x13e,'Y77Q')](iI11Ii[ii1iii(0x166,'tPK)')](Date[ii1iii(0x159,'7wp%')](),0x3e8))+ii1iii(0x185,'WKeC'),'loginType':'2','x-api-eid-token':$[ii1iii(0x146,'EWb7')]};lllil&&(ii1iii(0x138,'(f(H')!==iI11Ii[ii1iii(0x129,'Ec5V')]?Object[ii1iii(0x1b8,'BBAw')](lllil,IlIll1):(delete iillli[ii1iii(0x148,'#DKT')],delete I1l1Ii[ii1iii(0x108,'(f(H')][iI11Ii[ii1iii(0x1a4,'BBAw')]]));iI11Il&&Object[ii1iii(0x1b0,'TN22')](iI11Il,IlIll1);const IlIII={'url':iIII1l,'method':iIII1i,'headers':{'Accept':iI11Ii['soEDt'],'Accept-Encoding':ii1iii(0x1ba,'r7lK'),'Accept-Language':iI11Ii['MCPpE'],'Connection':iI11Ii['VyfUb'],'Content-Type':iI11Ii[ii1iii(0x211,'tPK)')],'Host':iI11Ii['uJuBw'],'Referer':iI11Ii['GJPTf'],'Sec-Fetch-Dest':iI11Ii[ii1iii(0x1d2,'S^([')],'Sec-Fetch-Mode':iI11Ii[ii1iii(0x125,'Ec5V')],'Sec-Fetch-Site':ii1iii(0x11b,'Sgi1'),'User-Agent':$['UA']},'params':iI11Il,'data':lllil,'timeout':0x7530,'httpsTlsOptions':common[ii1iii(0xfd,'TN22')]()};iI11Ii['OnqaG'](iIII1i,ii1iii(0x1f8,'A^tG'))&&(iI11Ii[ii1iii(0x1d7,'VUsf')](ii1iii(0x214,'BBAw'),iI11Ii[ii1iii(0x206,'!Qz^')])?l1lIlI[ii1iii(0x194,'Sgi1')]('❌\x20未能正确处理\x20'+IiiIl1+ii1iii(0x1d6,'KCIe')+(lIIil1['message']||IIli1)):(delete IlIII[ii1iii(0x143,'Kix%')],delete IlIII[ii1iii(0x14e,'%2RO')][iI11Ii['PQazi']]));const ilil1l=0x1;let illlIi=0x0,I1lIii=null,IiI1I=null;while(iI11Ii['GRJEB'](illlIi,ilil1l)){if(iI11Ii[ii1iii(0x1e2,'7wp%')](iI11Ii[ii1iii(0x10c,'Sgi1')],iI11Ii[ii1iii(0x1fd,'!Qz^')]))ilI1lI['errMsg']=IiiIll,IIlii!==0x193&&IlI1ii[ii1iii(0x142,'7wp%')](lIIiii);else{iI11Ii['CRfar'](illlIi,0x0)&&(iI11Ii[ii1iii(0x1bb,'!Qz^')](iI11Ii[ii1iii(0x100,'KXA$')],iI11Ii[ii1iii(0x161,'YJSt')])?await $['wait'](0x7d0):Ii1iIl[ii1iii(0x114,'A^tG')](iliIIi));const liiIII=await common[ii1iii(0x1ad,'O]ph')](IlIII);if(!liiIII[ii1iii(0x178,'eVru')]){IiI1I=liiIII[ii1iii(0x1b2,'lmK]')],$[ii1iii(0x1ca,'5(Sc')]=$[ii1iii(0x14a,'WKeC')]+'：'+IiI1I+ii1iii(0x13b,'^tKA'),I1lIii=ii1iii(0x207,'BBAw')+lllii+ii1iii(0x1b9,'!P[v')+liiIII[ii1iii(0x1a9,'YJSt')],illlIi++;continue;}if(!liiIII[ii1iii(0x18f,'s%mF')]){I1lIii='🚫\x20'+lllii+ii1iii(0x17f,'Kix%'),illlIi++;continue;}await iI11Ii['fdMOw'](handleResponse,lllii,liiIII[ii1iii(0x155,'vJLn')]),ipBlack=![];break;}}illlIi>=ilil1l&&($['errMsg']=I1lIii,IiI1I!==0x193&&(iI11Ii['CYVGy'](iI11Ii[ii1iii(0x134,'cSgt')],iI11Ii['hmBry'])?(iii1Il['push'](lI1IiI),i1lI=![]):console[ii1iii(0x1bd,'Kkn2')](I1lIii)));}var version_ = 'jsjiami.com.v7';
// prettier-ignore
function Env(t,e){"undefined"!=typeof process&&JSON.stringify(process.env).indexOf("GITHUB")>-1&&process.exit(0);class s{constructor(t){this.env=t}send(t,e="GET"){t="string"==typeof t?{url:t}:t;let s=this.get;return"POST"===e&&(s=this.post),new Promise((e,i)=>{s.call(this,t,(t,s,r)=>{t?i(t):e(s)})})}get(t){return this.send.call(this.env,t)}post(t){return this.send.call(this.env,t,"POST")}}return new class{constructor(t,e){this.name=t,this.http=new s(this),this.data=null,this.dataFile="box.dat",this.logs=[],this.isMute=!1,this.isNeedRewrite=!1,this.logSeparator="\n",this.startTime=(new Date).getTime(),Object.assign(this,e),this.log("",`🔔${this.name}, 开始!`)}isNode(){return"undefined"!=typeof module&&!!module.exports}isQuanX(){return"undefined"!=typeof $task}isSurge(){return"undefined"!=typeof $httpClient&&"undefined"==typeof $loon}isLoon(){return"undefined"!=typeof $loon}toObj(t,e=null){try{return JSON.parse(t)}catch{return e}}toStr(t,e=null){try{return JSON.stringify(t)}catch{return e}}getjson(t,e){let s=e;const i=this.getdata(t);if(i)try{s=JSON.parse(this.getdata(t))}catch{}return s}setjson(t,e){try{return this.setdata(JSON.stringify(t),e)}catch{return!1}}getScript(t){return new Promise(e=>{this.get({url:t},(t,s,i)=>e(i))})}runScript(t,e){return new Promise(s=>{let i=this.getdata("@chavy_boxjs_userCfgs.httpapi");i=i?i.replace(/\n/g,"").trim():i;let r=this.getdata("@chavy_boxjs_userCfgs.httpapi_timeout");r=r?1*r:20,r=e&&e.timeout?e.timeout:r;const[o,h]=i.split("@"),n={url:`http://${h}/v1/scripting/evaluate`,body:{script_text:t,mock_type:"cron",timeout:r},headers:{"X-Key":o,Accept:"*/*"}};this.post(n,(t,e,i)=>s(i))}).catch(t=>this.logErr(t))}loaddata(){if(!this.isNode())return{};{this.fs=this.fs?this.fs:require("fs"),this.path=this.path?this.path:require("path");const t=this.path.resolve(this.dataFile),e=this.path.resolve(process.cwd(),this.dataFile),s=this.fs.existsSync(t),i=!s&&this.fs.existsSync(e);if(!s&&!i)return{};{const i=s?t:e;try{return JSON.parse(this.fs.readFileSync(i))}catch(t){return{}}}}}writedata(){if(this.isNode()){this.fs=this.fs?this.fs:require("fs"),this.path=this.path?this.path:require("path");const t=this.path.resolve(this.dataFile),e=this.path.resolve(process.cwd(),this.dataFile),s=this.fs.existsSync(t),i=!s&&this.fs.existsSync(e),r=JSON.stringify(this.data);s?this.fs.writeFileSync(t,r):i?this.fs.writeFileSync(e,r):this.fs.writeFileSync(t,r)}}lodash_get(t,e,s){const i=e.replace(/\[(\d+)\]/g,".$1").split(".");let r=t;for(const t of i)if(r=Object(r)[t],void 0===r)return s;return r}lodash_set(t,e,s){return Object(t)!==t?t:(Array.isArray(e)||(e=e.toString().match(/[^.[\]]+/g)||[]),e.slice(0,-1).reduce((t,s,i)=>Object(t[s])===t[s]?t[s]:t[s]=Math.abs(e[i+1])>>0==+e[i+1]?[]:{},t)[e[e.length-1]]=s,t)}getdata(t){let e=this.getval(t);if(/^@/.test(t)){const[,s,i]=/^@(.*?)\.(.*?)$/.exec(t),r=s?this.getval(s):"";if(r)try{const t=JSON.parse(r);e=t?this.lodash_get(t,i,""):e}catch(t){e=""}}return e}setdata(t,e){let s=!1;if(/^@/.test(e)){const[,i,r]=/^@(.*?)\.(.*?)$/.exec(e),o=this.getval(i),h=i?"null"===o?null:o||"{}":"{}";try{const e=JSON.parse(h);this.lodash_set(e,r,t),s=this.setval(JSON.stringify(e),i)}catch(e){const o={};this.lodash_set(o,r,t),s=this.setval(JSON.stringify(o),i)}}else s=this.setval(t,e);return s}getval(t){return this.isSurge()||this.isLoon()?$persistentStore.read(t):this.isQuanX()?$prefs.valueForKey(t):this.isNode()?(this.data=this.loaddata(),this.data[t]):this.data&&this.data[t]||null}setval(t,e){return this.isSurge()||this.isLoon()?$persistentStore.write(t,e):this.isQuanX()?$prefs.setValueForKey(t,e):this.isNode()?(this.data=this.loaddata(),this.data[e]=t,this.writedata(),!0):this.data&&this.data[e]||null}initGotEnv(t){this.got=this.got?this.got:require("got"),this.cktough=this.cktough?this.cktough:require("tough-cookie"),this.ckjar=this.ckjar?this.ckjar:new this.cktough.CookieJar,t&&(t.headers=t.headers?t.headers:{},void 0===t.headers.Cookie&&void 0===t.cookieJar&&(t.cookieJar=this.ckjar))}get(t,e=(()=>{})){t.headers&&(delete t.headers["Content-Type"],delete t.headers["Content-Length"]),this.isSurge()||this.isLoon()?(this.isSurge()&&this.isNeedRewrite&&(t.headers=t.headers||{},Object.assign(t.headers,{"X-Surge-Skip-Scripting":!1})),$httpClient.get(t,(t,s,i)=>{!t&&s&&(s.body=i,s.statusCode=s.status),e(t,s,i)})):this.isQuanX()?(this.isNeedRewrite&&(t.opts=t.opts||{},Object.assign(t.opts,{hints:!1})),$task.fetch(t).then(t=>{const{statusCode:s,statusCode:i,headers:r,body:o}=t;e(null,{status:s,statusCode:i,headers:r,body:o},o)},t=>e(t))):this.isNode()&&(this.initGotEnv(t),this.got(t).on("redirect",(t,e)=>{try{if(t.headers["set-cookie"]){const s=t.headers["set-cookie"].map(this.cktough.Cookie.parse).toString();s&&this.ckjar.setCookieSync(s,null),e.cookieJar=this.ckjar}}catch(t){this.logErr(t)}}).then(t=>{const{statusCode:s,statusCode:i,headers:r,body:o}=t;e(null,{status:s,statusCode:i,headers:r,body:o},o)},t=>{const{message:s,response:i}=t;e(s,i,i&&i.body)}))}post(t,e=(()=>{})){if(t.body&&t.headers&&!t.headers["Content-Type"]&&(t.headers["Content-Type"]="application/x-www-form-urlencoded"),t.headers&&delete t.headers["Content-Length"],this.isSurge()||this.isLoon())this.isSurge()&&this.isNeedRewrite&&(t.headers=t.headers||{},Object.assign(t.headers,{"X-Surge-Skip-Scripting":!1})),$httpClient.post(t,(t,s,i)=>{!t&&s&&(s.body=i,s.statusCode=s.status),e(t,s,i)});else if(this.isQuanX())t.method="POST",this.isNeedRewrite&&(t.opts=t.opts||{},Object.assign(t.opts,{hints:!1})),$task.fetch(t).then(t=>{const{statusCode:s,statusCode:i,headers:r,body:o}=t;e(null,{status:s,statusCode:i,headers:r,body:o},o)},t=>e(t));else if(this.isNode()){this.initGotEnv(t);const{url:s,...i}=t;this.got.post(s,i).then(t=>{const{statusCode:s,statusCode:i,headers:r,body:o}=t;e(null,{status:s,statusCode:i,headers:r,body:o},o)},t=>{const{message:s,response:i}=t;e(s,i,i&&i.body)})}}time(t,e=null){const s=e?new Date(e):new Date;let i={"M+":s.getMonth()+1,"d+":s.getDate(),"H+":s.getHours(),"m+":s.getMinutes(),"s+":s.getSeconds(),"q+":Math.floor((s.getMonth()+3)/3),S:s.getMilliseconds()};/(y+)/.test(t)&&(t=t.replace(RegExp.$1,(s.getFullYear()+"").substr(4-RegExp.$1.length)));for(let e in i)new RegExp("("+e+")").test(t)&&(t=t.replace(RegExp.$1,1==RegExp.$1.length?i[e]:("00"+i[e]).substr((""+i[e]).length)));return t}msg(e=t,s="",i="",r){const o=t=>{if(!t)return t;if("string"==typeof t)return this.isLoon()?t:this.isQuanX()?{"open-url":t}:this.isSurge()?{url:t}:void 0;if("object"==typeof t){if(this.isLoon()){let e=t.openUrl||t.url||t["open-url"],s=t.mediaUrl||t["media-url"];return{openUrl:e,mediaUrl:s}}if(this.isQuanX()){let e=t["open-url"]||t.url||t.openUrl,s=t["media-url"]||t.mediaUrl;return{"open-url":e,"media-url":s}}if(this.isSurge()){let e=t.url||t.openUrl||t["open-url"];return{url:e}}}};if(this.isMute||(this.isSurge()||this.isLoon()?$notification.post(e,s,i,o(r)):this.isQuanX()&&$notify(e,s,i,o(r))),!this.isMuteLog){let t=["","==============📣系统通知📣=============="];t.push(e),s&&t.push(s),i&&t.push(i),console.log(t.join("\n")),this.logs=this.logs.concat(t)}}log(...t){t.length>0&&(this.logs=[...this.logs,...t]),console.log(t.join(this.logSeparator))}logErr(t,e){const s=!this.isSurge()&&!this.isQuanX()&&!this.isLoon();s?this.log("",`❗️${this.name}, 错误!`,t.stack):this.log("",`❗️${this.name}, 错误!`,t)}wait(t){return new Promise(e=>setTimeout(e,t))}done(t={}){const e=(new Date).getTime(),s=(e-this.startTime)/1e3;this.log("",`🔔${this.name}, 结束! 🕛 ${s} 秒`),this.log(),(this.isSurge()||this.isQuanX()||this.isLoon())&&$done(t)}}(t,e)}
