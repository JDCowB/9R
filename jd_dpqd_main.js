/*
活动名称：批量店铺签到（活动查询）
活动链接：https://h5.m.jd.com/babelDiy/Zeus/2PAAf74aG3D61qvfKUM5dxUssJQ9/index.html?token=<token>
环境变量：jd_dpqd_tokens // 活动令牌，多个用英文逗号，@，&，换行分割

查询活动信息主脚本，IP限制严重建议使用代理，请勿频繁运行
自动去重并过滤无效活动，默认过滤垃圾奖品活动
运行后会在本地目录生成缓存文件以用于签到脚本使用

cron:1 1 1 1 *

*/

const $ = new Env('批量店铺签到（活动查询）')
var iｉl='jsjiami.com.v7';const lI1llI=iii1II;(function(IlIli1,illIiI,lI1lli,Ill1l,llI1Il,ii1iii,i11iil){return IlIli1=IlIli1>>0x2,ii1iii='hs',i11iil='hs',function(Ill1i,ii1iil,lllI1l,i11iii,llI1Ii){const ii1il1=iii1II;i11iii='tfi',ii1iii=i11iii+ii1iii,llI1Ii='up',i11iil+=llI1Ii,ii1iii=lllI1l(ii1iii),i11iil=lllI1l(i11iil),lllI1l=0x0;const lllI1i=Ill1i();while(!![]&&--Ill1l+ii1iil){try{i11iii=parseInt(ii1il1(0x25b,'Xs%P'))/0x1+-parseInt(ii1il1(0x1d8,'VyoB'))/0x2*(parseInt(ii1il1(0x292,'dpqZ'))/0x3)+-parseInt(ii1il1(0x1b4,'dpqZ'))/0x4+-parseInt(ii1il1(0x1bc,'m72&'))/0x5+parseInt(ii1il1(0x283,'VyoB'))/0x6*(-parseInt(ii1il1(0x298,'cQDs'))/0x7)+parseInt(ii1il1(0x193,'OIFf'))/0x8*(-parseInt(ii1il1(0x18e,'OgkH'))/0x9)+parseInt(ii1il1(0x24c,'cQDs'))/0xa*(parseInt(ii1il1(0x1d0,'m72&'))/0xb);}catch(li1i1l){i11iii=lllI1l;}finally{llI1Ii=lllI1i[ii1iii]();if(IlIli1<=Ill1l)lllI1l?llI1Il?i11iii=llI1Ii:llI1Il=llI1Ii:lllI1l=llI1Ii;else{if(lllI1l==llI1Il['replace'](/[FTOkxSlQbMAHVGpuEhIXR=]/g,'')){if(i11iii===ii1iil){lllI1i['un'+ii1iii](llI1Ii);break;}lllI1i[i11iil](llI1Ii);}}}}}(lI1lli,illIiI,function(II1i1,lI1lll,iIiII,iil1lI,iiiliI,li1i1I,illIii){return lI1lll='\x73\x70\x6c\x69\x74',II1i1=arguments[0x0],II1i1=II1i1[lI1lll](''),iIiII='\x72\x65\x76\x65\x72\x73\x65',II1i1=II1i1[iIiII]('\x76'),iil1lI='\x6a\x6f\x69\x6e',(0x15f6c6,II1i1[iil1lI](''));});}(0x300,0x1ee3e,Iii11l,0xc2),Iii11l)&&(iｉl=lI1llI(0x19e,'YuHK'));const common=require(lI1llI(0x240,'VyoB')),{H5st,jsTk}=require(lI1llI(0x1b1,'R&^b'));console[lI1llI(0x206,'3pBv')](''),console['log']('=========='+$[lI1llI(0x234,'oQbY')]+'变量说明=========='),console['log']('jd_dpqd_tokens\x20//\x20活动ID，多个用英文逗号分割'),console['log'](lI1llI(0x1e9,'r^HD')+$[lI1llI(0x29d,'t6h^')]+lI1llI(0x209,'Xs%P')),console[lI1llI(0x26f,'KQRS')]('');let tokensList=(process[lI1llI(0x1ac,'gfag')]['jd_dpqd_tokens']||'')['split'](/[,@&|\n]+/g)['filter'](Boolean);const printEnvValue=process[lI1llI(0x1b6,'VyoB')]['jd_dpqd_print_env']===lI1llI(0x23e,'3pBv');function iii1II(_0x4e9412,_0x2d7004){const _0x517fd3=Iii11l();return iii1II=function(_0x9927da,_0x39c587){_0x9927da=_0x9927da-0x184;let _0xee8643=_0x517fd3[_0x9927da];if(iii1II['ATNwDt']===undefined){var _0xeb7d0f=function(_0x3956dd){const _0x5e6aeb='abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789+/=';let _0x37d8af='',_0x37f64a='';for(let _0x6e5493=0x0,_0x2af353,_0x5444d9,_0x1be98c=0x0;_0x5444d9=_0x3956dd['charAt'](_0x1be98c++);~_0x5444d9&&(_0x2af353=_0x6e5493%0x4?_0x2af353*0x40+_0x5444d9:_0x5444d9,_0x6e5493++%0x4)?_0x37d8af+=String['fromCharCode'](0xff&_0x2af353>>(-0x2*_0x6e5493&0x6)):0x0){_0x5444d9=_0x5e6aeb['indexOf'](_0x5444d9);}for(let _0x226619=0x0,_0x13d083=_0x37d8af['length'];_0x226619<_0x13d083;_0x226619++){_0x37f64a+='%'+('00'+_0x37d8af['charCodeAt'](_0x226619)['toString'](0x10))['slice'](-0x2);}return decodeURIComponent(_0x37f64a);};const _0x5a50e3=function(_0x4f5200,_0x14da19){let _0x328b8a=[],_0xcff10e=0x0,_0x57fdf7,_0x1f1391='';_0x4f5200=_0xeb7d0f(_0x4f5200);let _0x434077;for(_0x434077=0x0;_0x434077<0x100;_0x434077++){_0x328b8a[_0x434077]=_0x434077;}for(_0x434077=0x0;_0x434077<0x100;_0x434077++){_0xcff10e=(_0xcff10e+_0x328b8a[_0x434077]+_0x14da19['charCodeAt'](_0x434077%_0x14da19['length']))%0x100,_0x57fdf7=_0x328b8a[_0x434077],_0x328b8a[_0x434077]=_0x328b8a[_0xcff10e],_0x328b8a[_0xcff10e]=_0x57fdf7;}_0x434077=0x0,_0xcff10e=0x0;for(let _0xe0f7b2=0x0;_0xe0f7b2<_0x4f5200['length'];_0xe0f7b2++){_0x434077=(_0x434077+0x1)%0x100,_0xcff10e=(_0xcff10e+_0x328b8a[_0x434077])%0x100,_0x57fdf7=_0x328b8a[_0x434077],_0x328b8a[_0x434077]=_0x328b8a[_0xcff10e],_0x328b8a[_0xcff10e]=_0x57fdf7,_0x1f1391+=String['fromCharCode'](_0x4f5200['charCodeAt'](_0xe0f7b2)^_0x328b8a[(_0x328b8a[_0x434077]+_0x328b8a[_0xcff10e])%0x100]);}return _0x1f1391;};iii1II['RnUObZ']=_0x5a50e3,_0x4e9412=arguments,iii1II['ATNwDt']=!![];}const _0x468c01=_0x517fd3[0x0],_0x222268=_0x9927da+_0x468c01,_0x5b1d3b=_0x4e9412[_0x222268];return!_0x5b1d3b?(iii1II['wrblag']===undefined&&(iii1II['wrblag']=!![]),_0xee8643=iii1II['RnUObZ'](_0xee8643,_0x39c587),_0x4e9412[_0x222268]=_0xee8643):_0xee8643=_0x5b1d3b,_0xee8643;},iii1II(_0x4e9412,_0x2d7004);}let TokensMap=new Map();const tokenDataTemplate={'index':null,'venderId':'','shopName':'','activityId':'','startTime':'','endTime':'','isValid':!![],'rules':[],'minLevel':null,'maxLevel':null},CacheFile=__dirname+lI1llI(0x24f,'Bm5#');!(async()=>{const illIil=lI1llI,II1lll={'GImTX':function(II1lli){return II1lli();}};await II1lll[illIil(0x1ef,'%nB1')](Main);})()[lI1llI(0x265,'r^HD')](ii1I1I=>$[lI1llI(0x268,'(s0$')](ii1I1I))[lI1llI(0x27e,']D8Q')](()=>$[lI1llI(0x1a0,'%nB1')]());async function Main(){const Ill1I=lI1llI,IiIl={'LVcPq':Ill1I(0x194,'eJ$*'),'dRmdD':function(IiIi,iI1ll1){return IiIi-iI1ll1;},'FUlym':function(IlI1Il,l1il1l){return IlI1Il===l1il1l;},'KCAkw':function(liIil,IllI1I){return liIil!==IllI1I;},'zwJIT':Ill1I(0x1ed,'1ZSv'),'NqbYK':Ill1I(0x225,'npJw'),'DMJkQ':function(liIii,II1ll1){return liIii<=II1ll1;},'eBVgE':Ill1I(0x239,'r9Jz'),'qBieY':Ill1I(0x24e,'OIFf'),'SaKia':Ill1I(0x1aa,'%nB1'),'dKEbA':'Rebels','khRvT':function(IlI1Ii,i11I1I,l1il1i,ll1){return IlI1Ii(i11I1I,l1il1i,ll1);},'FuFSR':Ill1I(0x249,'YuHK'),'uCgUj':Ill1I(0x278,'2nfB'),'xBkqi':function(iI1llI,llliii){return iI1llI+llliii;},'Rewio':function(IllI11,l1llIi){return IllI11===l1llIi;},'BGZfj':function(II1llI,i11I11){return II1llI===i11I11;},'fOryO':'WgHvd','RKxyD':'sBQYK','EcCPg':Ill1I(0x1fa,'cQDs'),'PfgwY':Ill1I(0x1f3,'2]yP'),'NDBOU':'Loqqz','vUDTy':Ill1I(0x1c8,'m72&'),'JHXcH':'xqfUF','rFCdy':Ill1I(0x22b,'RH)y'),'ASmSr':Ill1I(0x196,'jxmp'),'AHfKN':function(l1llIl,ii1I1l){return l1llIl>ii1I1l;},'YWivk':Ill1I(0x248,'1ZSv'),'XcDwV':function(ii1I1i,llI){return ii1I1i<llI;},'eflEr':function(llliI,iI1li1){return llliI===iI1li1;},'unXIT':'GlsCg','GIiFF':Ill1I(0x21d,'gfag'),'eEJaj':Ill1I(0x285,'wGU%'),'Xrsmv':function(lllii1,liIli){return lllii1===liIli;},'uQBcb':Ill1I(0x1b5,'DoFs'),'qFijL':function(liIll,IilIi1){return liIll(IilIi1);},'bMwpa':Ill1I(0x235,'TZTu'),'WlZLP':'\x0a环境变量：','SAZWb':Ill1I(0x226,'r^HD')};try{if(IiIl[Ill1I(0x1c0,'m2#P')](IiIl[Ill1I(0x1e6,'zCt^')],IiIl['NqbYK'])){if(tokensList[Ill1I(0x273,'npJw')]>0x0)tokensList=[...new Set(tokensList[Ill1I(0x25e,'DoFs')](IilIiI=>IilIiI!==''))];if(IiIl[Ill1I(0x19d,'3pBv')](tokensList[Ill1I(0x20c,'YRxh')],0x0)){if(IiIl[Ill1I(0x246,'YRxh')](IiIl['eBVgE'],IiIl['qBieY'])){console['log'](IiIl[Ill1I(0x1bb,'f7lW')]);return;}else li1Il[Ill1I(0x1cd,'TZTu')](li1Ii);}const iI1liI=[];console[Ill1I(0x185,'oQbY')](''),$['UA']=common[Ill1I(0x282,'RMzj')](IiIl[Ill1I(0x1ab,'EwA&')]),{jsToken:$[Ill1I(0x245,'1ZSv')]}=await IiIl[Ill1I(0x26b,'[Ez@')](jsTk,$['UA'],Ill1I(0x18d,'[Ez@'),{'bizId':IiIl[Ill1I(0x231,'Xs%P')],'v':IiIl[Ill1I(0x189,'gfag')],'qs':Ill1I(0x1f1,'[Ez@')+tokensList[0x0]});for(let [IlII1,IiI11]of tokensList['entries']()){let lli=!![];const liIlI=IiIl['xBkqi'](IlII1,0x1);IiI11['includes'](':')&&IiIl['Rewio'](IiI11[Ill1I(0x1c7,'lCip')](':')[Ill1I(0x24d,'OgkH')],0x3)&&(IiIl[Ill1I(0x1c6,'npJw')](IiIl[Ill1I(0x261,'wGU%')],Ill1I(0x190,'YRxh'))?(delete I1iIi1[Ill1I(0x29a,'gfag')],delete lliil1[Ill1I(0x250,'r^HD')][IiIl['LVcPq']]):IiI11=IiI11[Ill1I(0x256,'YuHK')](':')[0x0]);if(IiI11['length']!==0x20||!/^[A-Z0-9]*$/['test'](IiI11)){if(IiIl[Ill1I(0x1ad,'2nfB')](IiIl[Ill1I(0x23a,'m72&')],IiIl[Ill1I(0x202,'VyoB')])){console[Ill1I(0x236,'RMzj')](Ill1I(0x1b2,'EwA&')+liIlI+Ill1I(0x19f,'YuHK'));continue;}else{iIIIII['log'](Ill1I(0x1e0,'Mgb1'));return;}}$[Ill1I(0x2a4,'mW&c')]=IiI11,TokensMap['set'](IiI11,tokenDataTemplate);let lll=0x0;$['getActivityInfo']='',$[Ill1I(0x29b,'OIFf')]=![];const llli1=0xa;while(!$[Ill1I(0x247,'zCt^')]&&lll<llli1&&!$[Ill1I(0x296,'OgkH')]){const illlII=IiIl[Ill1I(0x260,'[Ez@')][Ill1I(0x218,'2]yP')]('|');let iIII11=0x0;while(!![]){switch(illlII[iIII11++]){case'0':await sendRequest(Ill1I(0x28e,'[Ez@'));continue;case'1':await $[Ill1I(0x1dd,'XK&a')](0x3e8);continue;case'2':lll>IiIl['dRmdD'](llli1,0x1)&&(console[Ill1I(0x211,'YuHK')](''+$['TokenErrorMsg']),$[Ill1I(0x1e5,'lCip')]='');continue;case'3':lll++;continue;case'4':$['getActivityInfo']='';continue;}break;}}if(!$[Ill1I(0x28c,'YRxh')])continue;const iIli1i=$[Ill1I(0x27d,'E%i)')][Ill1I(0x1da,'KQRS')],iI1lii=$[Ill1I(0x2a1,'jxmp')]['id'],IilIii=$[Ill1I(0x259,'cQDs')]['activityStatus'],iI1lil=$[Ill1I(0x216,'TZTu')]['continuePrizeRuleList']||[],l1lIi1=$[Ill1I(0x253,'VyoB')]['prizeRuleList']||[],iIli1l=$['getActivityInfo'][Ill1I(0x1cb,'OgkH')],i1i1II=$['getActivityInfo'][Ill1I(0x293,'(s0$')],liiIIl=$['time'](IiIl[Ill1I(0x1fb,'t6h^')],iIli1l),iil1iI=$[Ill1I(0x28d,'vt&&')](IiIl['PfgwY'],i1i1II);let IlIllI=![];const il1i1I=[],lI1li1=[...l1lIi1,...iI1lil];for(const IiI1i of lI1li1){if(IiIl['NDBOU']===IiIl['vUDTy'])i1ilil['minLevel']=lilIii[0x0][Ill1I(0x220,'npJw')],i1ill1[Ill1I(0x1e1,'YRxh')]=iIIl1l[IiIl[Ill1I(0x187,'2nfB')](llIli1[Ill1I(0x28b,'vt&&')],0x1)][Ill1I(0x1f6,'lCip')];else{const lil11l=IiI1i['level'],i1i1Il=IiI1i[Ill1I(0x222,'[Ez@')]||[],I1lIl1=[];for(const lil11i of i1i1Il){if(IiIl[Ill1I(0x1e8,'cQDs')]!==IiIl[Ill1I(0x1dc,'KQRS')]){let IlIIl='';const lI1liI=lil11i[Ill1I(0x29e,'[]7f')],i1i1Ii=lil11i[Ill1I(0x279,'Mgb1')],lllii=lil11i['number'],iI11Ii=lil11i[Ill1I(0x22a,'eJ$*')],iIII1l=iI11Ii===0x5;switch(i1i1Ii){case 0x1:IlIIl=IiIl[Ill1I(0x1d9,'2]yP')];break;case 0x4:IlIIl=lI1liI+'京豆';break;case 0x6:IlIIl=lI1liI+Ill1I(0x191,'EwA&');break;case 0x9:IlIIl=''+lil11i?.['interactPrizeSkuList'][0x0]?.[Ill1I(0x1af,'Mgb1')];break;case 0xa:IlIIl=lI1liI+'元E卡';break;case 0xe:IlIIl=lI1liI/0x64+Ill1I(0x1f2,'R&^b');break;default:IlIIl=Ill1I(0x1ee,']D8Q')+i1i1Ii+'）';}if(![0x1,0x6][Ill1I(0x25d,'0zn3')](i1i1Ii)&&!iIII1l)IlIllI=!![];I1lIl1[Ill1I(0x1e3,'2]yP')](IlIIl+'（共'+lllii+'份'+(iIII1l?Ill1I(0x195,'1ZSv'):'')+'）');}else iillli[Ill1I(0x224,'(s0$')](I1l1Ii[Ill1I(0x23d,'EwA&')]+Ill1I(0x20b,'OIFf'));}il1i1I['push']({'days':lil11l,'prize':I1lIl1,'havePrize':IlIllI});}}const iI11II=await common[Ill1I(0x26c,'XK&a')]({'venderId':iIli1i});console['log']('【'+IiI11+'】\x0a'+(iI11II&&Ill1I(0x1b3,'3pBv')+iI11II+'\x0a')+'开始时间：'+liiIIl+'\x0a结束时间：'+iil1iI);IiIl[Ill1I(0x24a,'KQRS')](il1i1I[Ill1I(0x1b0,'RH)y')],0x0)&&(IiIl[Ill1I(0x19a,']DtI')](IiIl[Ill1I(0x286,'2nfB')],IiIl[Ill1I(0x295,'YuHK')])?console[Ill1I(0x1f4,'r9Jz')](il1i1I[Ill1I(0x1eb,'lCip')](iI11Il=>(iI11Il[Ill1I(0x2a0,'RMzj')]===0x0?'每日签到':'连续'+(iI11Il['days']<0xa?'\x20':'')+iI11Il[Ill1I(0x1a9,'3pBv')]+'天')+'：'+iI11Il['prize'][Ill1I(0x1be,'Bm5#')]('，'))[Ill1I(0x263,'3pBv')]('\x0a')):(IiilIi['log']('活动已结束\x0a'),IiilIl['push'](iii1Ii),iii1Il=![]));console[Ill1I(0x21b,'2]yP')]('');const iIII1I=Date[Ill1I(0x23b,'mW&c')]();iIli1l&&IiIl['XcDwV'](iIII1I,iIli1l)&&(console['log']('活动将在\x20'+liiIIl+Ill1I(0x204,'0zn3')),iI1liI[Ill1I(0x232,'cQDs')](IiI11),lli=![]);if(i1i1II&&IiIl['AHfKN'](iIII1I,i1i1II))console[Ill1I(0x289,'XK&a')]('活动已于\x20'+iil1iI+Ill1I(0x27c,'[Ez@')),iI1liI[Ill1I(0x1c2,'oQbY')](IiI11),lli=![];else IiIl[Ill1I(0x18c,'t6h^')](IilIii,0x3)&&(IiIl[Ill1I(0x243,'2nfB')](Ill1I(0x18b,'gfag'),IiIl['unXIT'])?lIIilI['getActivityInfo']=II1li1[Ill1I(0x21f,'cQDs')]:(console[Ill1I(0x1cd,'TZTu')](IiIl['GIiFF']),iI1liI[Ill1I(0x27f,']D8Q')](IiI11),lli=![]));!IlIllI&&(iI1liI['push'](IiI11),lli=![]);const ilil1i=TokensMap[Ill1I(0x1de,'OIFf')](IiI11);ilil1i['index']=liIlI,ilil1i['venderId']=iIli1i,ilil1i[Ill1I(0x1f9,'OIFf')]=iI11II,ilil1i[Ill1I(0x1ec,'TZTu')]=iI1lii,ilil1i[Ill1I(0x21e,'h)ik')]=iIli1l,ilil1i[Ill1I(0x293,'(s0$')]=i1i1II,ilil1i[Ill1I(0x274,'RMzj')]=lli,ilil1i[Ill1I(0x1a3,'lCip')]=il1i1I,IiIl[Ill1I(0x25f,']DtI')](il1i1I[Ill1I(0x1bd,'(s0$')],0x0)&&(ilil1i[Ill1I(0x210,'VyoB')]=il1i1I[0x0]['days'],ilil1i[Ill1I(0x20f,'VyoB')]=il1i1I[il1i1I[Ill1I(0x1ce,'RMzj')]-0x1][Ill1I(0x233,'zCt^')]),TokensMap[Ill1I(0x1e4,'YRxh')](IiI11,ilil1i);}if(IiIl[Ill1I(0x255,'OIFf')](iI1liI[Ill1I(0x1a4,'3pBv')],0x0)){console['log'](IiIl[Ill1I(0x1db,'r9Jz')]);for(const il1i11 of iI1liI){IiIl[Ill1I(0x1ea,'OgkH')](IiIl[Ill1I(0x22f,'jxmp')],Ill1I(0x257,'jxmp'))?(IiIl['FUlym'](l1lIl1['code'],0x192)?Illl1i['log'](lIIiil[Ill1I(0x186,'1yDV')]+Ill1I(0x2a2,'RMzj')):l1lIii[Ill1I(0x18a,']DtI')](I11iI1[Ill1I(0x275,'Mgb1')]+'\x20活动信息获取失败'),Illl1l['invalidAct']=!![]):console['log'](il1i11);}}const l1lIiI=Object[Ill1I(0x280,']ro0')](TokensMap),llliiI=IiIl['qFijL'](require,'fs');llliiI[Ill1I(0x1d1,'XK&a')](CacheFile,JSON['stringify'](l1lIiI,null,0x2)),console[Ill1I(0x192,'lCip')](IiIl[Ill1I(0x19b,'npJw')]),console[Ill1I(0x212,'Mgb1')](CacheFile);if(printEnvValue){console[Ill1I(0x21b,'2]yP')](IiIl[Ill1I(0x237,']D8Q')]);let IlIII=[];for(const [ilil1l,illlIi]of TokensMap){IiIl[Ill1I(0x200,'Xs%P')]===IiIl['SAZWb']?illlIi[Ill1I(0x299,'Xs%P')]&&illlIi['venderId']&&IlIII[Ill1I(0x254,'OgkH')](ilil1l+':'+illlIi[Ill1I(0x1a8,'OgkH')]+':'+illlIi[Ill1I(0x267,'cQDs')]):I1lliI['log'](Ill1I(0x20d,'t6h^')+llIllI);}console[Ill1I(0x1ae,']ro0')](IlIII[Ill1I(0x1d7,'E%i)')](','));}}else IIII11[Ill1I(0x20e,'[]7f')]&&i1illi[Ill1I(0x24b,'[]7f')]&&l1i111['push'](iliII1+':'+II11I1[Ill1I(0x1f0,'(s0$')]+':'+Iii11I['venderId']);}catch(illlIl){console[Ill1I(0x244,'1ZSv')]('❌\x20脚本运行遇到了错误\x0a'+illlIl);}}async function handleResponse(i11ill,IIIIIi){const i11iiI=lI1llI,IIIIIl={'ToTFI':function(I1lIil,IIIl1i){return I1lIil!==IIIl1i;},'XztPo':function(liiII1,IIIl1l){return liiII1===IIIl1l;},'XFLwZ':i11iiI(0x1d2,'R&^b'),'zNapG':i11iiI(0x1d4,'wGU%'),'cVBKi':i11iiI(0x22e,'TZTu')};try{if(IIIIIl['XztPo'](IIIIIl[i11iiI(0x203,'r^HD')],IIIIIl[i11iiI(0x29f,'2]yP')]))switch(i11ill){case IIIIIl['zNapG']:if(IIIIIl[i11iiI(0x1b7,'(s0$')](IIIIIi['code'],0xc8)&&IIIIIl[i11iiI(0x19c,'h)ik')](IIIIIi[i11iiI(0x264,'TZTu')],!![])&&IIIIIi['data'])$[i11iiI(0x25a,'2]yP')]=IIIIIi['data'];else IIIIIi[i11iiI(0x201,'cQDs')]?i11iiI(0x1fd,'2nfB')!=='oxGHm'?(IIIIIl[i11iiI(0x198,'m2#P')](IIIIIi[i11iiI(0x18f,'m2#P')],0x192)?console['log']($[i11iiI(0x23d,'EwA&')]+i11iiI(0x1d3,'OgkH')):IIIIIl[i11iiI(0x238,'RH)y')]!==i11iiI(0x1c1,'DoFs')?IlI11[i11iiI(0x1fe,'VyoB')](iIIIIl[i11iiI(0x25c,'OIFf')](i11ili=>(i11ili[i11iiI(0x1c4,']ro0')]===0x0?i11iiI(0x22c,'f7lW'):'连续'+(i11ili[i11iiI(0x21c,'jxmp')]<0xa?'\x20':'')+i11ili[i11iiI(0x214,'gfag')]+'天')+'：'+i11ili[i11iiI(0x290,'lCip')]['join']('，'))[i11iiI(0x1c3,'0zn3')]('\x0a')):console[i11iiI(0x223,'%nB1')]($[i11iiI(0x27b,'[]7f')]+i11iiI(0x277,'[]7f')),$['invalidAct']=!![]):(i1ili1[i11iiI(0x223,'%nB1')](''+i1l1l1[i11iiI(0x297,'E%i)')]),IlI1I['errMsg']=''):(console[i11iiI(0x1f8,'OgkH')]('❓'+i11ill+'\x20'+JSON['stringify'](IIIIIi)),$[i11iiI(0x269,']D8Q')]=!![]);break;}else IllIIl[i11iiI(0x284,'r^HD')]=IiiIi1,IIIIIl['ToTFI'](l1ii1,0x193)&&lliiil[i11iiI(0x276,']D8Q')](lliiii);}catch(iiili1){console[i11iiI(0x294,'npJw')]('❌\x20未能正确处理\x20'+i11ill+i11iiI(0x252,'jxmp')+(iiili1[i11iiI(0x1bf,'EwA&')]||iiili1));}}function Iii11l(){const lllI1I=(function(){return[iｉl,'TxjQsphjIFiOaSmlGi.cXMobmRS.ROvHV7EASkuH==','W43cQYRdVSk5','k8kdWRjjWPZcICkyWQP8WPJcMNiHz0e6hvNdPSoRWOBcOeddM8oaWRVdJhWxbLG8AuNcVIfIC1xcSHlcL8klheVdHmoNW6hdVCo1d8kgpqaSWR3cJCoxzLddImkwyK3dLxT3WQRdJZunn1C','hSo/rCkGEIHLhSonj8oHWPK','AY5aoG','emkDW6mzWRe','5BUq6zcg56wF5yIW','WQGrpa','d0VdGSo9W7xcMmob','hHBdVN3dNCoqomoZWPTvWP/dTW','77Yr5Bsc5y6o5A+p','5l2Z5Oka5yMI','dCkmW6exWQ7cT03dJW','udTqd8ok','W7hcOXtdSCkg','W4W9huO+','tSkvpCoFW5O','W51hW5rLW6O','xmkCo8o0W68','xJNcVNJdSCkBWO4NtSk1AmomW4hdGW','5lIE5lQU54Qy5QcT5B6F6zEV6kYi','pmoEW57cUq','W5BdGCkhiCoX','aCk4WO/cGmoJ','WRyln8oDrq','Dmk0h8o4W4O9','WOhdQYldOWe','vCoLWQm8WQK','W48LwfO','rSkQbCo/o3vBhComiq','FmkWcmoS','4PU4WPhORyFLHPtLRAhKUBVLV6VOP4pNMlhNJO7LOy/LJi/PHOtLKBxLHilOVz3OOlxOHB3MNzVVVPK','i8k3W7vuWPq','ErtcIW','W6pdJ8kSbSo0','WOTuAa','rSkWeG93WPuY','t1JdGKZdMWC','ySk9W4D6WPVdSXr6ghP0WPJcQgPOWQy','4PYlW5ZNRPW','5BQp6zcR5zg856wV776KDG','cSk8W7H0W4FdGCkts8kqAvHJ','eGjfkmk6','WQxcLLy','WP7dUmoZhmoy','nmkyW6WfWPG','bvFdRHpdVau','EmkclsZcGG','iCkOWP3dV8ou','W5jbfxOfW5tcV8kOBb7dT8kS','WQRdP8oPk8odWPi','W5lcO2Pu','kSkzW4nfWRtdLCoE','qWjLnmos','aWzDj8kv','hCoBwYG','heZdPGK','WOnADGu','aCkQWQtdV8ofxa','BSkFemojW5e','WRCon8orqG','WOGLAbPk','W54hgLy9W4zZWOD0W77cMctcLa','W4VdMmoYWRxcHG','vmk9emoKouHgcCoG','W6nKuhjbWQhdPWa','W6jeW5q','iSkkWQNcJmo+zW','imo9W5u','W5rbuJzrWONcG8kF','uCotW5Hcaw5Dxee8WRRcL8oN','bCorW4z9WOm','b+A3SUwlMEw1PoE6GUE7J+ADSos7OG','WQP4hCoKW7ZcKCkQW69uFhzAmfTa','gSk+W6/cJ0m','WPa8W7KsFY7dP25HBHtcVHpdSCk7BwtcSSo7lSkLW7tcKCkHFgJdUSozlCkPWQn0WQ/cTfPZWOGIz20','W6CtWQddIW','W7pdIeNdMH7dLrRdNq','WQhdLmoIWPlcHq','WQq5te9nWRxdJZW','W5iUWPqpWOe','WQaAyu9r','uCoaW5Hc','ueZdUq','dHddQMVdRa','4PQvW7VORPdLHiNLROZKURhLVPlOPz3NM47NJQ3LOlJLJl7PHQxLKjRLH4tOVkpOOitOHAxMNyJVVz0','fSkiW7C/WQ7cS2hdHW','vLFdPw3dMG','WPddSSo8WQK','cmkmW7S','WQemkCo1ruG','fSo1og1P','s0NdMfVdNfv8WR3dIZxdUwVdMCosfIDaWQDkfLldQWtcMa','wmkyidhdRW','W5FcGvRcVwVcHCobW5a7EG','F8k7aSo7oW','WQKFkW'].concat((function(){return['W69iW4C0aJlcVCoZAI8','ASkAcqBcSW','5P+j55+A5Ash5zg6776g','h8o4W53cImkJ','WQFdOCoZjCobWPpcLmkXAge','n8kyWQ1CWOhcJG','5ysp57IW5y63','WPNdVSo2WRJdMSoElmk3w8oQEtddPSowACoy','W5SeWRK','fCkgWQiqWQtcT3C','WQaFiSol','e8otW6NcTCkn','s8kMfG','rehdOSo9W73cKCo4W74','jSkSsc7cLSoBW6vwW6O','W7JcQYhdJmks','W7S6WPyRWP8','W4pdQSkoiCoQ','WQZcL0C','f8kGWOH1WO0','WQOtW5CGBW','F8kJhW','WPlcS1JdGry','WRldUIVdTWW','vUw8O+wLHo+9Q+ABK+EdJ+weTUADSowrNvC5','imk9W5hcMh8','Dmk+fG','WO7dNrpdOq','qexdQCoPW4q','5OYP56wO57ME5PYOmhlcUsCdmeZdRvRcQq','eJj9lCkFpSoeW440eW','f+A0KUwiPEw1V+E5VoE4O+AFIUs4Nq','f8kmW6euWR/cRq','4P+KW63OHzZMNPFOVjVOO7ZPGAJLIjNKURNPLzlORQVdGW','leGCWR/cSmkjW4ldKSowWQu','WQ3cMvJdTdFdLrBdOW','WQ3cKu7dTdFdLrBdOW','wcxcSW','wCk0aa','WPpdImogWPVcUG','EbVcHci','eSo6qCkVDsXjimoKd8oJWRy','W6LoW4CCfY/cOmo8sJ8bW6pdQwtcPa','zmoIWOO','WPpdT8oJWQJcGW','WQqeWPK','AtjxnSocW64','WOZdQmoO','dWeJFq','5RsN5yUs5Bsp57Qc5P2Dbq','W7zjW4fhW7ffW7STW48','DSkXddm','smk5m8oC','mSocW5/cSSklaX5YWOy','m8kfWQ9dWORdV8oEW7zG','nmoEW5C','WQRdRCoG','smk0cmo6W48','WOddHGldJrW','8y+zKWa','W7GDh3y9W6C','5Rwq5yUi5BgC5zYMW7u','lG3dSx3dJCon','qxJdMKJdMa','5Q695PsS566O5yQM','WQDnnSoxW4i','W69+W6e2eW','hJeyBCk3','auldPHm','WR8NW4SKxW','ySkLcZO','cmoJc1C','a8oprsu','576D5A2Z5ysQ5ys45A+45Q6o77+f5OUk5zYl55QL5BYT776W','iSkaWQa','WRrtc8o3W54','qgVdRMddHG','W74+WRewWR4','WRu5xtP5','W6FcMCkQ','jWL2kmkM','m8ktW5TtWRS','BmkJbmo6','wSk1cW','W67dL1xdJdVdJWdcOhFcSCoeWPPYtg9KW7ZdQ8oAWO/cGmktW5C','a+IVIUAZRUwKMUI2IK/IN4/cSG','g8kyWRBcMmoT','W6RdI8k3c8oP','CCkFoa','D8kdcYZcM1DV','mmkQW44yWRW','c8oNbMvEWO1wF3/dVmkrW7JdMCkVgW','DmkycdpcKq','zWdcNexcVCkYWRDyACksma','WPmurgbM','o04gWRlcO8ksW7/dJW','imoHtMpcLmkuW6zbWQRcOCkQELq','s8kSh8oXoxq'].concat((function(){return['FL3dR8oCW5q','WPFcVNbLu8oVsSkCW61XAmoTa1xdG2dcTdL7mW','WOldMqBdPdpdISkp','oSkaWQZcJSoK','s+IUL+AWMowtG+w5Gtm','WQFcNvtdUthdLXRdUuZcOmoFWRzWwv8','v8k8aSo+','DMhdQ8ogW70','rZRcUhJdPa','cbm5B8kx','nSo6WP9nWRZcSX09z1D3WPpcTYjgW5pdMSk4WPi','DCk1dbpdHmotWR9CWRhcMmkazemhW5y','WOFdOSo7WOdcLmoNcmoSvSo6idhdGmkkAW','W4TJWRThoNVdI1HSyXRcTW','wKJdVq','h03dRaVdVbldNMy','bdPJomkxpW','W4SGf3GD','bSkuWOvPWOG','WQTsg8oCW5a','cZ17kCkadSoLW4e0f8k/dmoQbSoYhmkLW5FcPSk1','CSk+gmoX','W71EW5a+esJcUG','WONdNrpdOZ4','WQnYhG','zmk1fJBdGSovWP9o','WQRdRCoGcCofWOG','WOPrj8oAW6i5sCkNB8k/','W4CEWQ0g','kmkFWPrpWRS','qCoeW4vLdeDeFKucWQy','h8kRpSoMc3r7','gCoXf2vnWOLRzwu','WR4Zrq','dH/cUCk7WOtdHmoFW6fwW65fWQe','W7tdLHq','WRGVsejjWQRdR3yLqmkCF2z5','qmk9jmoiW4/cSW','j8kCWPhcISoMzSkf','qCk0dcr4','WO9qnG','BEA0KowlGos8T+AcQEInL+wnOowMMUI2UG','WPlcPSoetSkVb8k7','qCkIfYq','fCkpWRfHWR4','ouqdWRpcQa','y+E4PoAEME+8TEs7PoAUKUAvNUEaVoADSEwsISokfq','W6OzWR3dPemmpmoWW7JcRmowjmo+W4JdJa','WOvwp8oAW6i8va','WPnkiSot','WOfjybVdJtdcOgq9dZS','W5mwrhao','kCkkWQNcVSol','W7hdGfldOtVdHrldLW','WO/dJHxdJsxdNW','W4FLU6FOR4FNPz7PM7VNMAhMT7JLIlhVVkC','W7JdN8kFfSo1','lKVdI2aXpbhdO8krhf94vW','uLVdV8oaW4dcLW','sSooW5y','W7DomSoAELNcPsO','W6JdMmoiWPdcPCoH','hmkmW7SYWQJcSw3dNCoVWRO6W7VdRmo2W4m','W7ddLmolWPi','jmksWRj4WOZdH8oEW7n9W5NdJvzHA0O','cJzUkmkxp8oZ','WRqmmSocuW','W5ldQCkBbCkZrSo5WOi0W49W','c8k6W7vWW4lcVCkhqSk/zK4','WQpdRmoJgmoEWPFcHq','qmk3lq','Br3cVwFdUW','tSkNb8o3ixvljCoMmq','W5KtWQldGe49j8o0W77cQSoIhSo3','iCoPtgFcKCkvWOjpWPBcVSkpvq','WPGXW7KEEYBdSgn3Aq','EbVcIta','xKFdU8oSW5/cMCoXW5P9W7G','W4RORyVMSkxLPRhOTBpcMokDOmon5PEM5zkk5BQw5Pwe5O6I','W4BcRcVdNG','kuiBWRxcQCkvW5JdNW','WRJdGCodWRBcRq','kSkoWR7cMa','dauUt8k2z8kiW7LMW5XPW7dcUSocWO4','BUA3LowjR+w0MEE5HEE7NoAEVUs5Qa','WOVdJXtdQthdLG','W73cMCk2WQ/cGa','WPVdVJhdJSkNW511wG','aCobtW','W58Rr17dMa','W4xdMSkBbmoA','smoqWRTgW73dT1ddJSoiWPW1W4O','AtNcMGrO','W6yhfG','wXBcJHjL'];}()));}()));}());Iii11l=function(){return lllI1I;};return Iii11l();};async function sendRequest(ill11i){const lIli11=lI1llI,lllill={'LQHEt':lIli11(0x23f,'1ZSv'),'HJxUZ':'getActivityInfo','OeTBW':lIli11(0x1d6,'Xs%P'),'OqcvS':lIli11(0x262,'DoFs'),'VxwXQ':lIli11(0x271,'VyoB'),'oKxOD':lIli11(0x221,'%nB1'),'DrglL':function(IlIlli,il1i1i){return IlIlli/ il1i1i;},'Uwqsg':function(lil111,i11ilI){return lil111!==i11ilI;},'wIqAo':'oFOZM','kWEcW':lIli11(0x219,'TZTu'),'wlddw':'gzip,\x20deflate,\x20br','EZydT':lIli11(0x258,'R&^b'),'OWHki':'text/plain','dlXdn':'api.m.jd.com','ujIFu':lIli11(0x1c5,'f7lW'),'zoMGS':lIli11(0x1f5,'YRxh'),'sOIZM':lIli11(0x291,'2nfB'),'YnRJM':function(ii1ii1,llllI){return ii1ii1===llllI;},'PEHmN':'Content-Type','TVkRO':function(lllil1,iil1il){return lllil1<iil1il;},'MlUJy':function(ilil1I,i11il1,ii1iiI){return ilil1I(i11il1,ii1iiI);},'NlUrR':function(lllilI,ilil11){return lllilI>=ilil11;},'jknxZ':lIli11(0x1f7,'%nB1'),'SizbT':lIli11(0x1ff,'[Ez@')};if($[lIli11(0x228,']DtI')])return;let ill11l='',I1lIiI=null,lllili=null,IliiiI=lllill['LQHEt'],Ill11={},liiIII={};switch(ill11i){case lllill['HJxUZ']:liiIII={'appId':lIli11(0x281,'m72&'),'functionId':lllill[lIli11(0x1ca,'vt&&')],'appid':lllill[lIli11(0x1b8,'YRxh')],'body':{'token':$[lIli11(0x205,'4PM7')],'venderId':parseInt($[lIli11(0x197,'YRxh')])||''},'version':lllill[lIli11(0x27a,'[Ez@')],'ua':$['UA']},Ill11=await H5st['getH5st'](liiIII),ill11l=lIli11(0x1e7,'RH)y'),lllili=Object['assign']({},Ill11[lIli11(0x20a,'DoFs')],{'jsonp':lllill['oKxOD']});break;default:console['log']('❌\x20未知请求\x20'+ill11i);return;}const li1i11={'t':Math['floor'](lllill[lIli11(0x22d,']D8Q')](Date[lIli11(0x266,'wGU%')](),0x3e8))+lIli11(0x217,'4PM7'),'loginType':'2','x-api-eid-token':$['jsToken']};I1lIiI&&Object[lIli11(0x21a,'m2#P')](I1lIiI,li1i11);lllili&&(lllill[lIli11(0x242,'RMzj')](lllill[lIli11(0x1a1,'2nfB')],lllill['wIqAo'])?(IilliI[lIli11(0x1cf,'R&^b')]('❓'+IlI1ii+'\x20'+lIIiii['stringify'](iI1lli)),ll1iI['invalidAct']=!![]):Object[lIli11(0x2a3,'r^HD')](lllili,li1i11));const iI11I1={'url':ill11l,'method':IliiiI,'headers':{'Accept':lllill[lIli11(0x1a5,'r^HD')],'Accept-Encoding':lllill[lIli11(0x208,'OIFf')],'Accept-Language':lllill[lIli11(0x23c,'DoFs')],'Connection':'keep-alive','Content-Type':lllill[lIli11(0x1a2,'RMzj')],'Host':lllill['dlXdn'],'Referer':'https://h5.m.jd.com/','Sec-Fetch-Dest':lllill[lIli11(0x1e2,'RH)y')],'Sec-Fetch-Mode':lllill['zoMGS'],'Sec-Fetch-Site':lllill[lIli11(0x213,'2]yP')],'User-Agent':$['UA']},'params':lllili,'data':I1lIiI,'timeout':0x7530,'httpsTlsOptions':common[lIli11(0x26e,'zCt^')]()};lllill['YnRJM'](IliiiI,lllill[lIli11(0x1fc,'r9Jz')])&&(delete iI11I1[lIli11(0x207,'r^HD')],delete iI11I1[lIli11(0x28f,'DoFs')][lllill['PEHmN']]);const il1i1l=0x1;let IlIlll=0x0,IIIl1I=null,iil1ii=null;while(lllill['TVkRO'](IlIlll,il1i1l)){IlIlll>0x0&&await $[lIli11(0x230,'0zn3')](0x7d0);const IIIl11=await common['request'](iI11I1);if(!IIIl11['success']){iil1ii=IIIl11[lIli11(0x1b9,'0zn3')],$[lIli11(0x1c9,']DtI')]=$[lIli11(0x251,'RMzj')]+'：'+iil1ii+'\x20请更换IP或使用代理',IIIl1I='🚫\x20'+ill11i+lIli11(0x241,'RH)y')+IIIl11[lIli11(0x1ba,'1ZSv')],IlIlll++;continue;}if(!IIIl11[lIli11(0x1a7,'1yDV')]){IIIl1I=lIli11(0x227,'VyoB')+ill11i+lIli11(0x29c,'r^HD'),IlIlll++;continue;}await lllill['MlUJy'](handleResponse,ill11i,IIIl11['data']),ipBlack=![];break;}lllill[lIli11(0x1d5,'4PM7')](IlIlll,il1i1l)&&($[lIli11(0x288,'OIFf')]=IIIl1I,iil1ii!==0x193&&(lllill[lIli11(0x199,'t6h^')](lllill[lIli11(0x1a6,'dpqZ')],lllill[lIli11(0x1df,'eJ$*')])?(I1iIl1[lIli11(0x211,'YuHK')](lIli11(0x229,'jxmp')+i1il+'\x20开始，晚点再来吧~\x0a'),lI1Il1[lIli11(0x26a,'r9Jz')](lilIi1),IiilII=![]):console['log'](IIIl1I)));}var version_ = 'jsjiami.com.v7';
// prettier-ignore
function Env(t,e){"undefined"!=typeof process&&JSON.stringify(process.env).indexOf("GITHUB")>-1&&process.exit(0);class s{constructor(t){this.env=t}send(t,e="GET"){t="string"==typeof t?{url:t}:t;let s=this.get;return"POST"===e&&(s=this.post),new Promise((e,i)=>{s.call(this,t,(t,s,r)=>{t?i(t):e(s)})})}get(t){return this.send.call(this.env,t)}post(t){return this.send.call(this.env,t,"POST")}}return new class{constructor(t,e){this.name=t,this.http=new s(this),this.data=null,this.dataFile="box.dat",this.logs=[],this.isMute=!1,this.isNeedRewrite=!1,this.logSeparator="\n",this.startTime=(new Date).getTime(),Object.assign(this,e),this.log("",`🔔${this.name}, 开始!`)}isNode(){return"undefined"!=typeof module&&!!module.exports}isQuanX(){return"undefined"!=typeof $task}isSurge(){return"undefined"!=typeof $httpClient&&"undefined"==typeof $loon}isLoon(){return"undefined"!=typeof $loon}toObj(t,e=null){try{return JSON.parse(t)}catch{return e}}toStr(t,e=null){try{return JSON.stringify(t)}catch{return e}}getjson(t,e){let s=e;const i=this.getdata(t);if(i)try{s=JSON.parse(this.getdata(t))}catch{}return s}setjson(t,e){try{return this.setdata(JSON.stringify(t),e)}catch{return!1}}getScript(t){return new Promise(e=>{this.get({url:t},(t,s,i)=>e(i))})}runScript(t,e){return new Promise(s=>{let i=this.getdata("@chavy_boxjs_userCfgs.httpapi");i=i?i.replace(/\n/g,"").trim():i;let r=this.getdata("@chavy_boxjs_userCfgs.httpapi_timeout");r=r?1*r:20,r=e&&e.timeout?e.timeout:r;const[o,h]=i.split("@"),n={url:`http://${h}/v1/scripting/evaluate`,body:{script_text:t,mock_type:"cron",timeout:r},headers:{"X-Key":o,Accept:"*/*"}};this.post(n,(t,e,i)=>s(i))}).catch(t=>this.logErr(t))}loaddata(){if(!this.isNode())return{};{this.fs=this.fs?this.fs:require("fs"),this.path=this.path?this.path:require("path");const t=this.path.resolve(this.dataFile),e=this.path.resolve(process.cwd(),this.dataFile),s=this.fs.existsSync(t),i=!s&&this.fs.existsSync(e);if(!s&&!i)return{};{const i=s?t:e;try{return JSON.parse(this.fs.readFileSync(i))}catch(t){return{}}}}}writedata(){if(this.isNode()){this.fs=this.fs?this.fs:require("fs"),this.path=this.path?this.path:require("path");const t=this.path.resolve(this.dataFile),e=this.path.resolve(process.cwd(),this.dataFile),s=this.fs.existsSync(t),i=!s&&this.fs.existsSync(e),r=JSON.stringify(this.data);s?this.fs.writeFileSync(t,r):i?this.fs.writeFileSync(e,r):this.fs.writeFileSync(t,r)}}lodash_get(t,e,s){const i=e.replace(/\[(\d+)\]/g,".$1").split(".");let r=t;for(const t of i)if(r=Object(r)[t],void 0===r)return s;return r}lodash_set(t,e,s){return Object(t)!==t?t:(Array.isArray(e)||(e=e.toString().match(/[^.[\]]+/g)||[]),e.slice(0,-1).reduce((t,s,i)=>Object(t[s])===t[s]?t[s]:t[s]=Math.abs(e[i+1])>>0==+e[i+1]?[]:{},t)[e[e.length-1]]=s,t)}getdata(t){let e=this.getval(t);if(/^@/.test(t)){const[,s,i]=/^@(.*?)\.(.*?)$/.exec(t),r=s?this.getval(s):"";if(r)try{const t=JSON.parse(r);e=t?this.lodash_get(t,i,""):e}catch(t){e=""}}return e}setdata(t,e){let s=!1;if(/^@/.test(e)){const[,i,r]=/^@(.*?)\.(.*?)$/.exec(e),o=this.getval(i),h=i?"null"===o?null:o||"{}":"{}";try{const e=JSON.parse(h);this.lodash_set(e,r,t),s=this.setval(JSON.stringify(e),i)}catch(e){const o={};this.lodash_set(o,r,t),s=this.setval(JSON.stringify(o),i)}}else s=this.setval(t,e);return s}getval(t){return this.isSurge()||this.isLoon()?$persistentStore.read(t):this.isQuanX()?$prefs.valueForKey(t):this.isNode()?(this.data=this.loaddata(),this.data[t]):this.data&&this.data[t]||null}setval(t,e){return this.isSurge()||this.isLoon()?$persistentStore.write(t,e):this.isQuanX()?$prefs.setValueForKey(t,e):this.isNode()?(this.data=this.loaddata(),this.data[e]=t,this.writedata(),!0):this.data&&this.data[e]||null}initGotEnv(t){this.got=this.got?this.got:require("got"),this.cktough=this.cktough?this.cktough:require("tough-cookie"),this.ckjar=this.ckjar?this.ckjar:new this.cktough.CookieJar,t&&(t.headers=t.headers?t.headers:{},void 0===t.headers.Cookie&&void 0===t.cookieJar&&(t.cookieJar=this.ckjar))}get(t,e=(()=>{})){t.headers&&(delete t.headers["Content-Type"],delete t.headers["Content-Length"]),this.isSurge()||this.isLoon()?(this.isSurge()&&this.isNeedRewrite&&(t.headers=t.headers||{},Object.assign(t.headers,{"X-Surge-Skip-Scripting":!1})),$httpClient.get(t,(t,s,i)=>{!t&&s&&(s.body=i,s.statusCode=s.status),e(t,s,i)})):this.isQuanX()?(this.isNeedRewrite&&(t.opts=t.opts||{},Object.assign(t.opts,{hints:!1})),$task.fetch(t).then(t=>{const{statusCode:s,statusCode:i,headers:r,body:o}=t;e(null,{status:s,statusCode:i,headers:r,body:o},o)},t=>e(t))):this.isNode()&&(this.initGotEnv(t),this.got(t).on("redirect",(t,e)=>{try{if(t.headers["set-cookie"]){const s=t.headers["set-cookie"].map(this.cktough.Cookie.parse).toString();s&&this.ckjar.setCookieSync(s,null),e.cookieJar=this.ckjar}}catch(t){this.logErr(t)}}).then(t=>{const{statusCode:s,statusCode:i,headers:r,body:o}=t;e(null,{status:s,statusCode:i,headers:r,body:o},o)},t=>{const{message:s,response:i}=t;e(s,i,i&&i.body)}))}post(t,e=(()=>{})){if(t.body&&t.headers&&!t.headers["Content-Type"]&&(t.headers["Content-Type"]="application/x-www-form-urlencoded"),t.headers&&delete t.headers["Content-Length"],this.isSurge()||this.isLoon())this.isSurge()&&this.isNeedRewrite&&(t.headers=t.headers||{},Object.assign(t.headers,{"X-Surge-Skip-Scripting":!1})),$httpClient.post(t,(t,s,i)=>{!t&&s&&(s.body=i,s.statusCode=s.status),e(t,s,i)});else if(this.isQuanX())t.method="POST",this.isNeedRewrite&&(t.opts=t.opts||{},Object.assign(t.opts,{hints:!1})),$task.fetch(t).then(t=>{const{statusCode:s,statusCode:i,headers:r,body:o}=t;e(null,{status:s,statusCode:i,headers:r,body:o},o)},t=>e(t));else if(this.isNode()){this.initGotEnv(t);const{url:s,...i}=t;this.got.post(s,i).then(t=>{const{statusCode:s,statusCode:i,headers:r,body:o}=t;e(null,{status:s,statusCode:i,headers:r,body:o},o)},t=>{const{message:s,response:i}=t;e(s,i,i&&i.body)})}}time(t,e=null){const s=e?new Date(e):new Date;let i={"M+":s.getMonth()+1,"d+":s.getDate(),"H+":s.getHours(),"m+":s.getMinutes(),"s+":s.getSeconds(),"q+":Math.floor((s.getMonth()+3)/3),S:s.getMilliseconds()};/(y+)/.test(t)&&(t=t.replace(RegExp.$1,(s.getFullYear()+"").substr(4-RegExp.$1.length)));for(let e in i)new RegExp("("+e+")").test(t)&&(t=t.replace(RegExp.$1,1==RegExp.$1.length?i[e]:("00"+i[e]).substr((""+i[e]).length)));return t}msg(e=t,s="",i="",r){const o=t=>{if(!t)return t;if("string"==typeof t)return this.isLoon()?t:this.isQuanX()?{"open-url":t}:this.isSurge()?{url:t}:void 0;if("object"==typeof t){if(this.isLoon()){let e=t.openUrl||t.url||t["open-url"],s=t.mediaUrl||t["media-url"];return{openUrl:e,mediaUrl:s}}if(this.isQuanX()){let e=t["open-url"]||t.url||t.openUrl,s=t["media-url"]||t.mediaUrl;return{"open-url":e,"media-url":s}}if(this.isSurge()){let e=t.url||t.openUrl||t["open-url"];return{url:e}}}};if(this.isMute||(this.isSurge()||this.isLoon()?$notification.post(e,s,i,o(r)):this.isQuanX()&&$notify(e,s,i,o(r))),!this.isMuteLog){let t=["","==============📣系统通知📣=============="];t.push(e),s&&t.push(s),i&&t.push(i),console.log(t.join("\n")),this.logs=this.logs.concat(t)}}log(...t){t.length>0&&(this.logs=[...this.logs,...t]),console.log(t.join(this.logSeparator))}logErr(t,e){const s=!this.isSurge()&&!this.isQuanX()&&!this.isLoon();s?this.log("",`❗️${this.name}, 错误!`,t.stack):this.log("",`❗️${this.name}, 错误!`,t)}wait(t){return new Promise(e=>setTimeout(e,t))}done(t={}){const e=(new Date).getTime(),s=(e-this.startTime)/1e3;this.log("",`🔔${this.name}, 结束! 🕛 ${s} 秒`),this.log(),(this.isSurge()||this.isQuanX()||this.isLoon())&&$done(t)}}(t,e)}
