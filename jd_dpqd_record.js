/*
活动名称：批量店铺签到（历史查询）
活动链接：https://h5.m.jd.com/babelDiy/Zeus/2PAAf74aG3D61qvfKUM5dxUssJQ9/index.html?token=<token>
环境变量：jd_dpqd_tokens // 活动令牌，多个用英文逗号分割
        jd_dpqd_task_threads // 控制签到并发线程数（正整数），默认1
        jd_dpqd_account_threads // 控制账号并发线程数（正整数），默认1
        jd_dpqd_account_interval // 自定义运行间隔时长（整数，单位毫秒），默认0

此脚本为高并发历史查询本，需要读取主脚本生成的活动信息缓存
脚本主要用于查询连签天数，不会进行签到操作，为了提高签到本的效率故将此功能分离

cron:1 1 1 1 *

*/

const $ = new Env('批量店铺签到（历史查询）')
var iｉl='jsjiami.com.v7';const I1llII=iii1II;(function(l1l1il,I11i1I,iliIi1,l1l1ii,Il1i1I,Ii1iii,iIIilI){return l1l1il=l1l1il>>0x1,Ii1iii='hs',iIIilI='hs',function(il1l1,Ii1iil,Ilil1i,iili1,II11ii){const I11i11=iii1II;iili1='tfi',Ii1iii=iili1+Ii1iii,II11ii='up',iIIilI+=II11ii,Ii1iii=Ilil1i(Ii1iii),iIIilI=Ilil1i(iIIilI),Ilil1i=0x0;const Iil1iI=il1l1();while(!![]&&--l1l1ii+Ii1iil){try{iili1=parseInt(I11i11(0x1de,'sDcf'))/0x1+-parseInt(I11i11(0x1ce,'n6tM'))/0x2+parseInt(I11i11(0x21b,'WbSx'))/0x3*(parseInt(I11i11(0x1f8,'oKFm'))/0x4)+parseInt(I11i11(0x1ff,'[r38'))/0x5*(-parseInt(I11i11(0x193,'SK)i'))/0x6)+parseInt(I11i11(0x23b,'$^7e'))/0x7+parseInt(I11i11(0x1a3,'A1!C'))/0x8+parseInt(I11i11(0x181,'92sH'))/0x9*(-parseInt(I11i11(0x23a,'g8)x'))/0xa);}catch(II11il){iili1=Ilil1i;}finally{II11ii=Iil1iI[Ii1iii]();if(l1l1il<=l1l1ii)Ilil1i?Il1i1I?iili1=II11ii:Il1i1I=II11ii:Ilil1i=II11ii;else{if(Ilil1i==Il1i1I['replace'](/[BWGJUYKqSnxFwrfNtPC=]/g,'')){if(iili1===Ii1iil){Iil1iI['un'+Ii1iii](II11ii);break;}Iil1iI[iIIilI](II11ii);}}}}}(iliIi1,I11i1I,function(iIIil1,IlllII,I1il1I,II111,lI1l1I,lill11,liI1i1){return IlllII='\x73\x70\x6c\x69\x74',iIIil1=arguments[0x0],iIIil1=iIIil1[IlllII](''),I1il1I='\x72\x65\x76\x65\x72\x73\x65',iIIil1=iIIil1[I1il1I]('\x76'),II111='\x6a\x6f\x69\x6e',(0x15f6c5,iIIil1[II111](''));});}(0x180,0x58293,Iii11l,0xc2),Iii11l)&&(iｉl=0xfee);const jdCookie=require(I1llII(0x1c4,'2[Gt')),notify=require(I1llII(0x199,'@k59')),common=require('./utils/Rebels_jdCommon'),{jsTk}=require(I1llII(0x1d8,'A1!C'));function iii1II(_0x5f03f6,_0x5c3624){const _0x567d1d=Iii11l();return iii1II=function(_0x5370de,_0x504516){_0x5370de=_0x5370de-0x17c;let _0x11e54b=_0x567d1d[_0x5370de];if(iii1II['TrvDtw']===undefined){var _0x108ead=function(_0x4bbc08){const _0x546099='abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789+/=';let _0x1756aa='',_0x1777b2='';for(let _0x5cc72d=0x0,_0x5d735e,_0x329b09,_0x188b06=0x0;_0x329b09=_0x4bbc08['charAt'](_0x188b06++);~_0x329b09&&(_0x5d735e=_0x5cc72d%0x4?_0x5d735e*0x40+_0x329b09:_0x329b09,_0x5cc72d++%0x4)?_0x1756aa+=String['fromCharCode'](0xff&_0x5d735e>>(-0x2*_0x5cc72d&0x6)):0x0){_0x329b09=_0x546099['indexOf'](_0x329b09);}for(let _0x552c0e=0x0,_0x324d00=_0x1756aa['length'];_0x552c0e<_0x324d00;_0x552c0e++){_0x1777b2+='%'+('00'+_0x1756aa['charCodeAt'](_0x552c0e)['toString'](0x10))['slice'](-0x2);}return decodeURIComponent(_0x1777b2);};const _0x100f13=function(_0xbd88a1,_0x5ea518){let _0x163026=[],_0x4438f3=0x0,_0x1d6090,_0x1683dd='';_0xbd88a1=_0x108ead(_0xbd88a1);let _0x2aaca3;for(_0x2aaca3=0x0;_0x2aaca3<0x100;_0x2aaca3++){_0x163026[_0x2aaca3]=_0x2aaca3;}for(_0x2aaca3=0x0;_0x2aaca3<0x100;_0x2aaca3++){_0x4438f3=(_0x4438f3+_0x163026[_0x2aaca3]+_0x5ea518['charCodeAt'](_0x2aaca3%_0x5ea518['length']))%0x100,_0x1d6090=_0x163026[_0x2aaca3],_0x163026[_0x2aaca3]=_0x163026[_0x4438f3],_0x163026[_0x4438f3]=_0x1d6090;}_0x2aaca3=0x0,_0x4438f3=0x0;for(let _0x5863f1=0x0;_0x5863f1<_0xbd88a1['length'];_0x5863f1++){_0x2aaca3=(_0x2aaca3+0x1)%0x100,_0x4438f3=(_0x4438f3+_0x163026[_0x2aaca3])%0x100,_0x1d6090=_0x163026[_0x2aaca3],_0x163026[_0x2aaca3]=_0x163026[_0x4438f3],_0x163026[_0x4438f3]=_0x1d6090,_0x1683dd+=String['fromCharCode'](_0xbd88a1['charCodeAt'](_0x5863f1)^_0x163026[(_0x163026[_0x2aaca3]+_0x163026[_0x4438f3])%0x100]);}return _0x1683dd;};iii1II['Uoovvj']=_0x100f13,_0x5f03f6=arguments,iii1II['TrvDtw']=!![];}const _0x495ec7=_0x567d1d[0x0],_0x4794b2=_0x5370de+_0x495ec7,_0x38cab9=_0x5f03f6[_0x4794b2];return!_0x38cab9?(iii1II['YXcAqn']===undefined&&(iii1II['YXcAqn']=!![]),_0x11e54b=iii1II['Uoovvj'](_0x11e54b,_0x504516),_0x5f03f6[_0x4794b2]=_0x11e54b):_0x11e54b=_0x38cab9,_0x11e54b;},iii1II(_0x5f03f6,_0x5c3624);}function Iii11l(){const Il1i1l=(function(){return[iｉl,'UWjrnFsGNjJiafmSxif.SxCcoBqm.vKn7PUtUYwn==','wsJdR8ksfxtcTq','hc/dUCksffZcRSoDsG','W61EW4XZrW','W7abz3KR','WOrzCqL1','W4VcNCoH','WOZdOfuxtmo5WRu','W7XzoCoXBa','W7vhbmo2r1pcIW','WOFOR7FMS6lLK5xLU6/dSa','4PYaWPBOH43MNAlOVAtOORxPGBpLI73KUjJPLjtOR5fd','W7/cK8oFW7b0','kH3cPsLdmmkul3e6qmoLD1azW6fnW7JMTPNLIyBcQ33VVOBLPjlKUy7NLyZOIzpMLQ3PGlVLJ5VLI6xLIly','W5JdSCo3qCo8WQlcLmkQhKLAcb3dSxlcKSkwWOz2WOGOFCkAea','DL7cPxKa','77+25BsB6l2q5lMu6zM4772P','fvZdGW','qCocFGHdWOa','WRjuCwqeWQa','WPdcImkdoW','W6OVgmkXCCkl','ymk6EmoquG','a8kAfmk5DW','Emkknui4emk4W7XOWQldLXNcHG','s8kTAq','sqldOCk6W55MEG','W6NcO1JdNGq','EmkameO1e8odW5D+WQ7dLWW','WPtdNZpcO8o+Dc7dGmkuawbiW4hcV8kICGZdNCkDvmo4W5Ok','W5tdQSoTva','WQldGea3sG','FCkhW6CnW4FcGutcM8oR','hCkhi8klfg4YW7JcLSoUfCoqW7i','WQpdKJJdMem','W4TLW45/d8k4','W5JdIg/cVaiIlmkqWOmIWPhdTmotW7bImGBcUqlcI8kbWPRdNMvzbWFcU17cTmo6pXyuhaZcV8obD0Tygtb2ta/cLmoJWO4JxafzWO8rWRqsEvqfp0ZdKCodW4FcImkduSoRW4tdM1fq','cCo+W7zyna','W7nrWQfLzatdN8k0Ed9acq','W5NcR3SDga','ocJdOCkzlq','b8k7C8opWRdcQ8os','WQ8KW5NcQSkc','scz6WPtdGCoYvq','uokERSkv','WPfvemkGdq','fZBdUmk+mW','WP7dKINdKW','ACkjD2hdSW','DSo4ACoPBW','W6lcQLW','lSo1W7rBcW','idBdICkCeG','aSkuWRvEoq','W6dcTeuJ','W7LDfmov','WRldN380Fa','77+88lkRUW','W7hdTmkD','W6JcPMy4iG','W513ja','W77cRHSOfCk+W7a','w2xcG0aT','WPBdPe8qECo3WR16','jINdUaNdVdfqbSka','mCkmWO13ea','WRNcS8oSWQ5D','cqNdK8kSfq','jSoxwHz8vmoQW49+WQBdKXhcLCkoDsTAWRbrW7mhWRBcUthMJzFLIyVNRiJLIiJLUlVLJPxVVz7PU6JOR6m6','FSoEACoRBG','WQypW7u','E8oTqYLd','AfhcN2y0','k8owCq','W6VcGhldUJO','W4RcM8ocW6bC','4PQnWOFOR6FLHkFLRQ3KUQhLVydOPyNNMlBNJkBLOPJLJ5ZPHBZLK5hLH6ROVRVOOkhOHixMN5tVViy','qrxdSc5vaW','A8ooW6i','WQLGcM4','q8ooEbHN','amkpb8k4zLBdS8oOwvC','dSoMtcDI'].concat((function(){return['x2xcVSkldG','WOBdTsdcQSoV','qcLNWQlcGCkZvJLRW6mzuejjW5xcHZu','FSkKF8ohDq','W4dcMSotW6nA','W5tcGSoQW59Q','WPWeka','W4bLW5rvhSkJAsKkW60','WP9fpmk8j0xdSmk4','W4mxsNSdWPVcRIhdOeXDD8kuWOi','oGdcIrTj','mJldUW/dQW','W5JcTbvrhCkNWPXWy2GUW4e','WR5Qf27cH8klvW','h8kuaq','WOdcVCokWRjc','WRBdQWFdR8kG','ACoeW7T/CJi','rCoWEJvu','WPNdMdC','W6CBfa','W73cRvldTby','BSoeW7bOkZTZjwVcMW','jCoFwa','y8kgoW','pSk0WOPIoq','W63dRSkjAG','44c96lww5y2P','W4FdNxlcUcvXBSoA','sCkNzSo5yG','ebBcP20wfSkzWPe','kJBdGCkUmG','W680WRtdJCkE','p8odArT4','WR1EtaXf','WQ4KW4e2dG','WR7dRKm/e8kGW7ddTmkpWPdcL8k6aSkFW7rtW4vMWPC5W4RdK8kdzSkHAuW','mmotb8kCjmkHwmooe8oNWRq','W6JcRfFdPGCF','uW3dISkPW5q','W7WRWQWJhW','wuVcKwuq','WOldQKGhECo/WQn0','WR4jW6FcU8kiACkYCujbo1K9sNa3AtuvW7/cRCoUBSkLst5JW4uMimkIW7rBW7maswtcIa','WQizW5u2dq','W5BdRmoVrCoQW6O','W4hcJMdcKbBcKmkAW45ZWPGEn8kU','WPJdQZRdHmkWtfigpCke','ACo2rcnd','WRZdSd/dOuW','WRRcL8otWQ1F','WQbsbCk2ea','WOisoW','W4D7W79yyW','W6RdUSktDJvQWObX','W69GW6a','W6xdMmkWDHK','ANtcMG','vN/cGmk5eq','hdRdPSkEv1tcTCosvcit','hSoaDYb9','umkHCCocrG','CSk2vgZdKq','WQBcTmoI','ymkpn3FcGq','WOnxe8krWObDjCkKW4HBWPTJlW','W6BcJwldPte','wrxdPJ0ogXpdHmksW6O','WPDhbmkHWOXjoa','W7ixWRJcUSof','eHFdUxCMjCk6WQpcMa','fSohrcrn','cSo/W6bEoa','W4NdKmkOqqW','W4ubtv4lWPi','WRj5f8kwWR4','W7qHWR/cHq','WOmooW','5OYP56AY57QD5P+YW7Syg0jjW53dK8kVaXi','E3ldOatdKtLwc8kqWQG','dUkCRtpIN7mf5P6+6k+J5AAO6lE3WOb2WPK','AmoaW6u','WPBdGmk1','WRdINz0w6k685Rc45AE96lAM77+t'].concat((function(){return['W65xa8oe','W4nHW5LR','r8o7W4b1uq','BCoCqCowvq','jCk2WQTAhmkt','E8kfm0m+fCoQW7HJWPtdQaK','W5ZdMxxcQWvW','WQDTvfNcRmojwCkbW5raECkeWQ5pW5aJjZHZ','zNlcH2qD','W5K3WOlcJCoU','W6JcGNW/aG','CSoaW7XSuJnYkq','W6bpW6rRca','44oA5OYl56A/44oz6k+E5yEm6i6D5y+mWO55isZcRCoM','WO5pmu7dJ8kHC8k4WR1alq','W5VcMcxdLeVdICoFWO1dWPGlmCkoW6mVkG','WOfktX5v','WR/cK17dQ8oG','WP7dRtO','WPVdGWxcSW','WRLhm8kqcq','r8oiu8oYkXpdQCogwvz9hW','ASkfva','d8kFrSozWPW','r8kXcN7cVgm','lXpdRrNdMW','BSkpuSooCCksAa','WOztAfqB','WO86W54+ga','WRjiuYO','hSkrifSgW53cTSkPW7BdH1vTW7C','lmofgq','bJxdV8kEchJcOSovrY4pqY9aW5LoWRRdRCoDBW','W7aKWO3cHmowc8kOxGtcNGzCW4zFWPNcNZ81bSksWQ7dHmoVWOOAuslMJjhLIB/OTkdLJ4lLUOlLJQlVVzdPUlNORQGT','mSoux8obWPnOva','WRxdUr/cLSom','pSotWRyQW7lcKfJcQmonDfaQ','W48FxweQ','4PIhW5lOHAZLRkZKUzFOV7JOOO3PLyxPMPlML5tPLitORkNNViVPLyJORAS','4PUGWPhOR5NLH7ZLRAZKUzlLV6xOP7VNMkVNJOlLOyZLJ6dPH6pLK6/LH6pOVzZOOjtOHjVMN5tVVji','W7jAW45MxW','WPPqpSkXnG','W7BcRvKKca','rLtcU1SN','W7GKWPNcLSoK','BokCQSo34PYcWPtMNjZOR5BLP7ZOTRVVViu','WO3dJX7cRSoGyIpdUCkm','gSkui1KgW5RdR8ksW6pdRNj2','sSo9F8oprG','uqnKWRNdGG','f2m+','lSoqq8or','W5RdOCoCvCo/W6NdN8oAc1zyqX7cRa','4PQAv+IfQowTG+s7SUI/HEIHHEMwIUMzPoAuOoMuH+ITGoE8HEMwSEIVLq','W7ZdOSkXW74zW4vPBSkDtXC','WQayfdmW','rCkMrxpdNq','n8oWW6Hxeq','WPpdNJ7dGu7dICov','etBdMHJdNW','omomWPqjW7u','WRPgqa5wW50','W6LRW5HZqmoRWRhdRKvsfSolWQn7nmkdtmo/WOa3B3ldI8kh','mZtdPHtdTYq','WPhcJwW','W5vIpCobqW','WQZcMSkCdfK','pSk8WQTLaq','WOfujSkOmq3cLSoZqsFcUSoQaCkcWPnDW7ZdVL19','W6xdTSkjrYG','sCkssSolDW','WPpdLI/cISod','W6ihWRpcMmoE','Bf7cSfu2','WOvpnq','eSkld8oKFWVdJSoLa1XLba','wHhdTZ0','pG3dVmkumG','kmosCrm','ACooW7i','W5NdKNJcOar8zSom','W7hdRSorzCow'];}()));}()));}());Iii11l=function(){return Il1i1l;};return Iii11l();};console[I1llII(0x24c,'J&)I')](''),console[I1llII(0x213,'I0iS')]('=========='+$['name']+'变量说明=========='),console[I1llII(0x260,'vGuh')](I1llII(0x227,'5ha4')),console['log'](I1llII(0x25e,'n6tM')),console[I1llII(0x260,'vGuh')](I1llII(0x1ea,'UKWv')),console[I1llII(0x233,'pbcB')]('jd_dpqd_account_interval\x20//\x20自定义运行间隔时长'),console[I1llII(0x1c2,'p0FO')]('=========='+$[I1llII(0x22e,'l!hV')]+I1llII(0x1c3,'P1nY')),console[I1llII(0x1df,'VR^!')]('');let tokensList=(process['env'][I1llII(0x1fd,'Gujf')]||'')[I1llII(0x1f2,'I0iS')](/[,@&|\n]+/g)[I1llII(0x19b,'J&)I')](Boolean),taskThreads=process[I1llII(0x209,'v#V&')]['jd_dpqd_task_threads']||'1',accountThreads=process[I1llII(0x18c,'IsTK')][I1llII(0x237,'b^Ap')]||'1';const runInterval=process[I1llII(0x22b,'x$NY')][I1llII(0x207,'%z70')]||'',isNotify=![];let TokensMap=new Map();const invalidTokensMap=new Map(),CacheFile=__dirname+'/rs_dpqd_tokens.json',cookiesArr=Object[I1llII(0x249,'A1!C')](jdCookie)['map'](Iliii1=>jdCookie[Iliii1])[I1llII(0x208,'2[Gt')](iIiIi=>iIiIi);!cookiesArr[0x0]&&($['msg']($[I1llII(0x1c1,'UKWv')],I1llII(0x1d6,'[r38')),process[I1llII(0x1dc,'b^Ap')](0x1));!(async()=>{const Iil1il=I1llII,iil1ll={'IpSbw':function(iiilil,iil1li){return iiilil(iil1li);},'OPMqh':function(lillIl){return lillIl();},'dguJj':function(iIiIl,iiilii){return iIiIl<=iiilii;},'uIUDk':function(li1i1i,IlIli1){return li1i1i(IlIli1);},'NKydl':Iil1il(0x195,'UKWv'),'OMUSv':function(illIiI,lI1lli){return illIiI===lI1lli;},'DQTLt':'trsbg','IGoAn':Iil1il(0x21e,'^SL5'),'QVwoH':Iil1il(0x271,'20B*'),'goqoy':function(Ill1l,llI1Il){return Ill1l(llI1Il);},'UxlMU':function(ii1iii,i11iil){return ii1iii!==i11iil;},'DLXhI':'yEdIZ','VKpTW':function(Ill1i,ii1iil){return Ill1i!==ii1iil;},'VcRbr':Iil1il(0x19d,'pwmm'),'uorZu':'⚠\x20自定义运行间隔时长设置错误','FQmmB':function(lllI1l,i11iii){return lllI1l===i11iii;},'zqRQB':function(llI1Ii,lllI1i){return llI1Ii>lllI1i;},'zysVz':function(li1i1l,II1i1){return li1i1l!==II1i1;},'bDWwE':function(lI1lll,iIiII){return lI1lll!==iIiII;},'bdKvB':'PDSSS','hyGfY':function(iil1lI,iiiliI){return iil1lI(iiiliI);},'qTkPC':Iil1il(0x247,'I0iS'),'vPjko':Iil1il(0x1a7,'[r38'),'OcIBf':Iil1il(0x1be,'y**o'),'dDSfZ':'dctAk'};try{notify[Iil1il(0x22d,'C*g!')]({'title':$[Iil1il(0x1fc,'IsTK')]});if(tokensList['length']>0x0)tokensList=[...new Set(tokensList[Iil1il(0x1a2,'Gujf')](illIii=>illIii!==''))];if(iil1ll[Iil1il(0x23f,'EXtM')](tokensList[Iil1il(0x1cf,'(6Pv')],0x0)){console['log'](Iil1il(0x1f0,'IsTK'));return;}const li1i1I=iil1ll[Iil1il(0x25b,'%wEj')](require,'fs');if(li1i1I['existsSync'](CacheFile)){const ii1il1=li1i1I[Iil1il(0x1ed,'g8)x')](CacheFile,iil1ll[Iil1il(0x24a,'pbcB')]),lI1llI=JSON[Iil1il(0x231,'sDcf')](ii1il1);for(const illIil in lI1llI){if(iil1ll['OMUSv'](iil1ll[Iil1il(0x1a5,'oKFm')],iil1ll['DQTLt']))TokensMap['set'](illIil,lI1llI[illIil]);else{const i11iiI=illIlI[Iil1il(0x25c,'[r38')]();liIiI++,l1il1I['push'](iil1ll['IpSbw'](Iiili,i11iiI));}}}$[Iil1il(0x191,'(6Pv')]=null;if(runInterval){if(iil1ll[Iil1il(0x192,'VR^!')](iil1ll[Iil1il(0x1a6,'A1!C')],iil1ll[Iil1il(0x216,'WbSx')]))lilIl[Iil1il(0x245,'xm^r')]=!![];else try{const lllI1I=iil1ll[Iil1il(0x180,'2[Gt')](parseInt,runInterval);lllI1I>0x0&&(iil1ll[Iil1il(0x229,'SK)i')](iil1ll[Iil1il(0x1b5,'T]KE')],iil1ll['DLXhI'])?(llliil(liIl1),iil1ll[Iil1il(0x20a,'i#CH')](II1lll)):$[Iil1il(0x259,'92sH')]=lllI1I);}catch{iil1ll[Iil1il(0x1c0,'n*AF')](iil1ll['VcRbr'],Iil1il(0x1aa,'%z70'))?console[Iil1il(0x218,'wgMC')](iil1ll['uorZu']):I1ilIi[Iil1il(0x188,'A1!C')](''+IiiiI+llIlli+'\x20➜\x20❌\x20查询失败\x20-\x20'+llIlll[Iil1il(0x25a,'2[Gt')](lliii1));}}try{if(iil1ll[Iil1il(0x24f,'%wEj')]('ZhDUk',Iil1il(0x24e,'WbSx')))ill11I=0x1;else{const liil11=parseInt(taskThreads);iil1ll[Iil1il(0x18e,'%wEj')](liil11,0x0)&&iil1ll[Iil1il(0x20c,'%wEj')](liil11,0x1)&&(taskThreads=liil11);}}catch{iil1ll['bDWwE'](iil1ll[Iil1il(0x1f5,'UKWv')],iil1ll[Iil1il(0x201,'pbcB')])?(lilIll=l1i111['venderId'],iliII1=II11I1[Iil1il(0x1a4,'P1nY')],Iii11I=Iil1II['maxLevel']):taskThreads=0x1;}try{const l1l111=iil1ll[Iil1il(0x1a1,'vGuh')](parseInt,accountThreads);iil1ll['zqRQB'](l1l111,0x0)&&iil1ll[Iil1il(0x17f,'5ha4')](l1l111,0x1)&&(accountThreads=l1l111);}catch{accountThreads=0x1;}await common[Iil1il(0x19f,'92sH')](accountThreads,cookiesArr,async(l1iIII,llI1I1)=>{const I11i1i=Iil1il;await concMain(taskThreads,tokensList,l1iIII,llI1I1,Main);if($[I11i1i(0x1d4,'wgMC')])$['wait']($[I11i1i(0x1ab,'y**o')]);});if(isNotify&&notify[Iil1il(0x17c,'zN[G')]()){if(iil1ll['qTkPC']===iil1ll[Iil1il(0x1fa,'xm^r')])return;else notify['updateContent'](notify[Iil1il(0x182,'CA!$')]),await notify[Iil1il(0x18f,'y**o')]();}}catch(lIli1I){iil1ll[Iil1il(0x185,'P1nY')]===iil1ll[Iil1il(0x198,'vGuh')]?l1iIi['assign'](l1l11i,l1iIl):console[Iil1il(0x183,'sDcf')](Iil1il(0x225,'g8)x')+lIli1I);}})()['catch'](lllI11=>$[I1llII(0x206,'eIIh')](lllI11))[I1llII(0x203,'A1!C')](()=>$[I1llII(0x238,'Gujf')]());async function Main(I1lIll,I1lIli){const l1l1iI=I1llII,II1ii={'xCJtx':function(I1lIlI,ii1ill){return I1lIlI!==ii1ill;},'gfcLf':'123','Oxyac':function(II1iI,llI1II){return II1iI===llI1II;},'XIzVJ':l1l1iI(0x1dd,'I0iS'),'EhcmG':l1l1iI(0x202,'EXtM'),'InMVb':function(lIli1l,lillIi){return lIli1l===lillIi;},'JcwPv':function(illIi1,ii1ili){return illIi1>ii1ili;},'hWjZc':function(liil1i,lI1lil){return liil1i>lI1lil;},'kmcVF':l1l1iI(0x22a,'l!hV'),'izHpo':function(i1l1iI,liil1l){return i1l1iI===liil1l;},'hHYwS':'KfXQu','syfWg':'JLqbj','WchUq':function(lI1lii,Iiili1){return lI1lii(Iiili1);},'BUIUn':l1l1iI(0x1ef,'20B*'),'OnnyZ':l1l1iI(0x266,'oKFm'),'bGdju':'getSignRecord','FtPKE':l1l1iI(0x1e9,'WbSx'),'xgPsX':l1l1iI(0x1a0,'p2l3'),'ZtAVA':'jsonp1001','AkRTY':'bSMfa','VonhN':'khjVp','IrWnR':l1l1iI(0x252,'92sH'),'miDVB':l1l1iI(0x1e8,'VR^!'),'EZLnL':l1l1iI(0x26f,'xm^r'),'VJSFt':l1l1iI(0x1d0,'CA!$'),'WJUap':l1l1iI(0x1b8,'iCKG'),'CwPmH':l1l1iI(0x20d,'I0iS'),'nQKdw':'script','xGaxx':l1l1iI(0x257,'@k59'),'EmJUH':l1l1iI(0x1b0,'WbSx'),'ffeHY':l1l1iI(0x18d,'T]KE'),'XaYFj':l1l1iI(0x1e4,'C*g!'),'DkPxM':'Content-Type','ETNPH':function(Iil1l1,i1i11I){return Iil1l1!==i1i11I;},'xNLma':l1l1iI(0x222,'i#CH'),'zNgyI':function(il1iIl,iii1ii,il1iIi){return il1iIl(iii1ii,il1iIi);},'jocXZ':function(iii1il,II11li){return iii1il>=II11li;},'JfOzk':l1l1iI(0x1cc,'$^7e'),'BZUmW':l1l1iI(0x200,'p0FO'),'WsjbW':function(I1l11i,iIIiiI){return I1l11i===iIIiiI;},'zKxKT':'KqEJq','ClwIU':function(liiI1i,ililIi){return liiI1i===ililIi;},'nsgoS':function(lilIIl,ililIl){return lilIIl!==ililIl;},'KpDoV':function(liiI1l,i1l1II){return liiI1l===i1l1II;},'wDFlq':function(i1ill,I1l11l){return i1ill||I1l11l;},'tzCGA':function(lilIIi,i1l1Il){return lilIIi/ i1l1Il;}},{title:IIIIII,UA:lillII,cookie:ii1ilI,message:lI1ll1,jsToken:iIiI1}=I1lIli;if(invalidTokensMap[l1l1iI(0x263,'n6tM')](I1lIll))return;let liil1I='',i11ii1='',IlIliI=null;const l1iII1=TokensMap['get'](I1lIll);if(l1iII1)liil1I=l1iII1[l1l1iI(0x17d,'I0iS')],i11ii1=l1iII1['activityId'],IlIliI=l1iII1['maxLevel'];else try{if(II1ii[l1l1iI(0x242,'WbSx')](II1ii['zKxKT'],II1ii['zKxKT'])){if(I1lIll[l1l1iI(0x219,'(6Pv')](':')&&II1ii[l1l1iI(0x24d,'EXtM')](I1lIll['split'](':')['length'],0x3)){const llIli=I1lIll[l1l1iI(0x196,'n6tM')](':');if(!llIli[0x0]||!llIli[0x1]||!llIli[0x2])return;I1lIll=llIli[0x0];if(II1ii['nsgoS'](I1lIll['length'],0x20)||!/^[A-Z0-9]*$/[l1l1iI(0x1c9,'i#CH')](I1lIll))return;i11ii1=llIli[0x1],liil1I=llIli[0x2],llIli[0x2]['startsWith'](l1l1iI(0x1c7,'20B*'))&&II1ii[l1l1iI(0x1da,'v#V&')](llIli[0x2][l1l1iI(0x186,'wgMC')],0x8)&&!llIli[0x1]['startsWith'](II1ii[l1l1iI(0x1bd,'EXtM')])&&(i11ii1=llIli[0x2],liil1I=llIli[0x1]),TokensMap[l1l1iI(0x273,'p0FO')](I1lIll,{'index':null,'venderId':liil1I,'shopName':'','activityId':i11ii1,'startTime':'','endTime':'','isValid':!![],'rules':[],'minLevel':null,'maxLevel':null});}}else lIIill['assign'](I11iIi,I1ilII);}catch(i1i11i){return;}if(II1ii['wDFlq'](!liil1I,!i11ii1))return;const iiill1=Math[l1l1iI(0x1f3,'@k59')](II1ii[l1l1iI(0x205,'g8)x')](Date[l1l1iI(0x268,'wgMC')](),0x3e8))+l1l1iI(0x1fb,'xm^r');if(invalidTokensMap[l1l1iI(0x1db,'P1nY')](I1lIll))return;await IIIII1(II1ii['bGdju']);if($[l1l1iI(0x191,'(6Pv')])$[l1l1iI(0x215,'iCKG')]($['waitTime']);function lIli1i(II11l1,Iil1lI){const I1llI1=l1l1iI,IiiliI={'mmCMM':function(iii1iI,llIll){return II1ii['xCJtx'](iii1iI,llIll);},'GODss':II1ii[I1llI1(0x235,'J&)I')],'eEIhX':function(il1iII,iilli){const I11i1l=I1llI1;return II1ii[I11i1l(0x20f,'VR^!')](il1iII,iilli);}};try{if(II1ii[I1llI1(0x1d3,'@k59')](II1ii[I1llI1(0x24b,'$^7e')],II1ii['EhcmG']))switch(II11l1){case I1llI1(0x1b6,'n*AF'):if(Iil1lI[I1llI1(0x251,'i#CH')]===0xc8&&II1ii[I1llI1(0x241,'@k59')](Iil1lI[I1llI1(0x234,'kB#R')],!![])&&Iil1lI['data']){const IlllIl=Iil1lI['data'][I1llI1(0x1ca,'zN[G')];console[I1llI1(0x1ac,'%z70')](''+IIIIII+I1lIll+I1llI1(0x246,'x$NY')+(II1ii['JcwPv'](IlllIl,0x9)?IlllIl:'\x20'+IlllIl)+'天'+(II1ii[I1llI1(0x1ba,'UKWv')](IlllIl,0x0)&&IlIliI&&IlllIl>=IlIliI?II1ii[I1llI1(0x1ee,'^SL5')]:''));}else Iil1lI['msg']?console[I1llI1(0x254,'y**o')](''+IIIIII+I1lIll+I1llI1(0x1f6,'g8)x')+Iil1lI[I1llI1(0x1a9,'p0FO')]+'）'):console[I1llI1(0x220,'20B*')](''+IIIIII+I1lIll+I1llI1(0x1c5,'$^7e')+JSON[I1llI1(0x21c,'WbSx')](Iil1lI));break;}else l1l1II=Iil1I1;}catch(lI1IIi){if(II1ii[I1llI1(0x19c,'kB#R')](II1ii[I1llI1(0x1b7,'J&)I')],II1ii['syfWg'])){const Ilil1l=I1l1I1[I1llI1(0x272,'20B*')](':');if(!Ilil1l[0x0]||!Ilil1l[0x1]||!Ilil1l[0x2])return;I1i111=Ilil1l[0x0];if(IiiliI[I1llI1(0x210,'b^Ap')](ilI1li[I1llI1(0x23d,'zN[G')],0x20)||!/^[A-Z0-9]*$/[I1llI1(0x269,'CA!$')](IIliI))return;ilI1ll=Ilil1l[0x1],Iillii=Ilil1l[0x2],Ilil1l[0x2]['startsWith'](IiiliI[I1llI1(0x1d5,'zN[G')])&&IiiliI[I1llI1(0x264,'J&)I')](Ilil1l[0x2]['length'],0x8)&&!Ilil1l[0x1][I1llI1(0x26b,'sDcf')](I1llI1(0x189,'eIIh'))&&(II1lii=Ilil1l[0x2],lIIii1=Ilil1l[0x1]),l1lIli[I1llI1(0x1ae,'t0u5')](lIIiiI,{'index':null,'venderId':II1lil,'shopName':'','activityId':IIli1l,'startTime':'','endTime':'','isValid':!![],'rules':[],'minLevel':null,'maxLevel':null});}else console['log']('❌\x20未能正确处理\x20'+II11l1+I1llI1(0x224,'zN[G')+(lI1IIi[I1llI1(0x221,'92sH')]||lI1IIi));}}async function IIIII1(iIIiii){const il1il=l1l1iI,iilll={'CEfSg':II1ii[il1il(0x1af,'t0u5')]};let il1iI1='',IlllIi=null,iIIiil=null,i1l1Ii=il1il(0x256,'i#CH'),I1iIIi={},I1iIIl={};switch(iIIiii){case II1ii['bGdju']:il1iI1=il1il(0x228,'Gujf'),iIIiil={'appid':II1ii[il1il(0x26d,'t0u5')],'functionId':II1ii[il1il(0x255,'@k59')],'body':JSON[il1il(0x1f7,'b^Ap')]({'token':I1lIll,'venderId':parseInt(liil1I)||'','activityId':II1ii[il1il(0x1d9,'eIIh')](parseInt,i11ii1)||'','type':0x38}),'jsonp':II1ii[il1il(0x1bc,'n6tM')]};break;}const lI1IIl={'t':iiill1,'loginType':'2','x-api-eid-token':iIiI1};IlllIi&&(II1ii[il1il(0x258,'SK)i')](II1ii[il1il(0x21a,'Gujf')],II1ii['AkRTY'])?iliIIl=Ii1iIl:Object[il1il(0x1bf,'^SL5')](IlllIi,lI1IIl));if(iIIiil){if(II1ii[il1il(0x212,'SK)i')](II1ii['VonhN'],II1ii[il1il(0x1a8,'I0iS')])){IiilI1['log'](iilll[il1il(0x239,'92sH')]);return;}else Object[il1il(0x1cd,'%wEj')](iIIiil,lI1IIl);}const i1ilI={'url':il1iI1,'method':i1l1Ii,'headers':{'Accept':II1ii[il1il(0x265,'20B*')],'Accept-Encoding':II1ii[il1il(0x1e5,'vGuh')],'Accept-Language':II1ii[il1il(0x261,'oKFm')],'Connection':il1il(0x18b,'wgMC'),'Content-Type':II1ii['WJUap'],'Host':il1il(0x214,'sDcf'),'Referer':II1ii[il1il(0x1d2,'UKWv')],'Sec-Fetch-Dest':II1ii[il1il(0x21d,'%z70')],'Sec-Fetch-Mode':II1ii[il1il(0x211,'UKWv')],'Sec-Fetch-Site':II1ii[il1il(0x194,'WbSx')],'User-Agent':lillII,'Cookie':ii1ilI},'params':iIIiil,'data':IlllIi,'timeout':0x7530};if(i1l1Ii===II1ii['ffeHY']){if(II1ii[il1il(0x226,'20B*')]===il1il(0x23c,'A1!C')){const lI1III=II1ii['WchUq'](iliIII,iIIl1i);II1ii[il1il(0x187,'oKFm')](lI1III,0x0)&&II1ii[il1il(0x244,'p2l3')](lI1III,0x1)&&(ill111=lI1III);}else delete i1ilI['data'],delete i1ilI[il1il(0x1e3,'VR^!')][II1ii[il1il(0x204,'2[Gt')]];}const iii1lI=0x3;let i1ilI1=0x0,Iiilii=null,Iil1li=![];while(i1ilI1<iii1lI){const IIliIi=await common[il1il(0x1eb,'IsTK')](i1ilI);if(!IIliIi[il1il(0x1b9,'n*AF')]){if(II1ii[il1il(0x1d1,'SK)i')](II1ii[il1il(0x270,'VR^!')],II1ii[il1il(0x26e,'b^Ap')]))lilIii['log'](II1ii[il1il(0x26c,'n6tM')]);else{Iiilii=''+IIIIII+I1lIll+il1il(0x1c8,'@k59')+IIliIi[il1il(0x1f4,'SK)i')]+il1il(0x253,'A1!C'),i1ilI1++;continue;}}if(!IIliIi[il1il(0x217,'n6tM')]){Iiilii=''+IIIIII+I1lIll+'\x20➜\x20请求失败（无响应数据）🚫',i1ilI1++;continue;}II1ii[il1il(0x1e2,'2[Gt')](lIli1i,iIIiii,IIliIi[il1il(0x1e6,'eIIh')]),Iil1li=![];break;}II1ii['jocXZ'](i1ilI1,iii1lI)&&(console[il1il(0x260,'vGuh')](Iiilii),Iil1li&&(II1ii[il1il(0x1ad,'y**o')](II1ii[il1il(0x184,'[r38')],II1ii[il1il(0x1cb,'wgMC')])?$[il1il(0x223,'i#CH')]=!![]:l1i11I=0x1));}}async function concMain(I1l111=0x1,IIii1l,I1iIII,liiI11,ililI1){const Il1i1i=I1llII,IIii1i={'KREVH':function(IllIi1,lilIII){return IllIi1===lilIII;},'jKZzI':Il1i1i(0x262,'SK)i'),'fPKzF':function(Ii1ilI){return Ii1ilI();},'fRXWo':function(II11i1,iliIil){return II11i1<iliIil;},'AXhSv':function(iliIii,lill1i){return iliIii(lill1i);},'UtZiN':function(il1li,iIIill){return il1li>iIIill;},'dizKo':Il1i1i(0x1fe,'kB#R'),'xmsEI':function(iilii,Ill11i){return iilii===Ill11i;},'qUIqo':function(iilil,Ill11l,il1ll){return iilil(Ill11l,il1ll);},'IrSNi':'pt_pin','RpVBQ':Il1i1i(0x243,'LR]t'),'nihwP':function(i1ilIi,lill1l,l1l1i1,i1iiI){return i1ilIi(lill1l,l1l1i1,i1iiI);},'zmXQE':Il1i1i(0x23e,'(6Pv'),'KBsQB':'3.2.1.0','dLlpc':function(i1ilIl,llI11I){return i1ilIl(llI11I);},'CnVAu':function(Il1i11){return Il1i11();}},i1ili=IIii1l[Il1i1i(0x1c6,'wgMC')](iii1li=>iii1li),Iiill1=decodeURIComponent(common['getCookieValue'](I1iIII,IIii1i['IrSNi'])),I1iII1=Il1i1i(0x190,'iCKG')+liiI11+'】'+Iiill1+'：',lilII1=await common[Il1i1i(0x17e,'^SL5')](I1iIII);if(!lilII1&&IIii1i[Il1i1i(0x20e,'y**o')](typeof lilII1,IIii1i[Il1i1i(0x21f,'eIIh')])){console['log'](I1iII1+'账号无效\x20🚫');return;}const iill1=notify[Il1i1i(0x1e1,'T]KE')](liiI11,Iiill1),iii1l1=common['genUA'](Iiill1),{jsToken:IIliIl}=await IIii1i[Il1i1i(0x26a,'oKFm')](jsTk,iii1l1,IIii1i[Il1i1i(0x19e,'SK)i')],{'bizId':Il1i1i(0x1d7,'CA!$'),'v':IIii1i[Il1i1i(0x1ec,'b^Ap')],'qs':Il1i1i(0x22f,'wu[r')+IIii1l[0x0]}),II11ll={'cookie':I1iIII,'index':liiI11,'title':I1iII1,'UA':iii1l1,'message':iill1,'jsToken':IIliIl};let liiI1I=0x0;async function ililII(Iil1i1){const iIIili=Il1i1i;IIii1i['KREVH'](iIIili(0x25f,'$^7e'),IIii1i[iIIili(0x1e0,'LR]t')])?(lliilI=lili1[0x2],ll1l1=IllIIi[0x1]):(await ililI1(Iil1i1,II11ll),liiI1I--,IIii1i[iIIili(0x230,'VR^!')](lI1II1));}async function lI1II1(){const Ii1iiI=Il1i1i;while(IIii1i[Ii1iiI(0x25d,'WbSx')](liiI1I,I1l111)&&i1ili[Ii1iiI(0x22c,'oKFm')]>0x0){const iliIl1=i1ili[Ii1iiI(0x18a,'J&)I')]();liiI1I++,await IIii1i['AXhSv'](ililII,iliIl1);}}const i1ilII=Math['min'](i1ili[Il1i1i(0x267,'iCKG')],I1l111),iIIii1=[];for(let Ii1il1=0x0;IIii1i['fRXWo'](Ii1il1,i1ilII);Ii1il1++){const iii1ll=i1ili[Il1i1i(0x25c,'[r38')]();liiI1I++,iIIii1[Il1i1i(0x250,'@k59')](IIii1i[Il1i1i(0x1f9,'$^7e')](ililII,iii1ll));}await Promise['all'](iIIii1),IIii1i['CnVAu'](lI1II1),await new Promise(IIliI1=>{const II11iI=Il1i1i,il1lI={'kwkGa':function(IliIIl,I1il1l){const Ilil1I=iii1II;return IIii1i[Ilil1I(0x1b3,'pbcB')](IliIIl,I1il1l);},'VKBhR':IIii1i['dizKo'],'rXUtm':function(lI1l1l,IIliII){const iliIiI=iii1II;return IIii1i[iliIiI(0x248,'WbSx')](lI1l1l,IIliII);}};if(II11iI(0x20b,'l!hV')!==II11iI(0x1b1,'n6tM'))try{const Ill11I=I1iIil(lI1Iil);il1lI[II11iI(0x197,'eIIh')](Ill11I,0x0)&&(i1l1I['waitTime']=Ill11I);}catch{IiilIl[II11iI(0x1b4,'[r38')](il1lI[II11iI(0x1b2,'VR^!')]);}else{const I1il1i=IIii1i[II11iI(0x1f1,'%z70')](setInterval,()=>{il1lI['rXUtm'](liiI1I,0x0)&&(clearInterval(I1il1i),IIliI1());},0x64);}});}var version_ = 'jsjiami.com.v7';
function Env(t,e){"undefined"!=typeof process&&JSON.stringify(process.env).indexOf("GITHUB")>-1&&process.exit(0);class s{constructor(t){this.env=t}send(t,e="GET"){t="string"==typeof t?{url:t}:t;let s=this.get;return"POST"===e&&(s=this.post),new Promise((e,i)=>{s.call(this,t,(t,s,r)=>{t?i(t):e(s)})})}get(t){return this.send.call(this.env,t)}post(t){return this.send.call(this.env,t,"POST")}}return new class{constructor(t,e){this.name=t,this.http=new s(this),this.data=null,this.dataFile="box.dat",this.logs=[],this.isMute=!1,this.isNeedRewrite=!1,this.logSeparator="\n",this.startTime=(new Date).getTime(),Object.assign(this,e),this.log("",`🔔${this.name}, 开始!`)}isNode(){return"undefined"!=typeof module&&!!module.exports}isQuanX(){return"undefined"!=typeof $task}isSurge(){return"undefined"!=typeof $httpClient&&"undefined"==typeof $loon}isLoon(){return"undefined"!=typeof $loon}toObj(t,e=null){try{return JSON.parse(t)}catch{return e}}toStr(t,e=null){try{return JSON.stringify(t)}catch{return e}}getjson(t,e){let s=e;const i=this.getdata(t);if(i)try{s=JSON.parse(this.getdata(t))}catch{}return s}setjson(t,e){try{return this.setdata(JSON.stringify(t),e)}catch{return!1}}getScript(t){return new Promise(e=>{this.get({url:t},(t,s,i)=>e(i))})}runScript(t,e){return new Promise(s=>{let i=this.getdata("@chavy_boxjs_userCfgs.httpapi");i=i?i.replace(/\n/g,"").trim():i;let r=this.getdata("@chavy_boxjs_userCfgs.httpapi_timeout");r=r?1*r:20,r=e&&e.timeout?e.timeout:r;const[o,h]=i.split("@"),n={url:`http://${h}/v1/scripting/evaluate`,body:{script_text:t,mock_type:"cron",timeout:r},headers:{"X-Key":o,Accept:"*/*"}};this.post(n,(t,e,i)=>s(i))}).catch(t=>this.logErr(t))}loaddata(){if(!this.isNode())return{};{this.fs=this.fs?this.fs:require("fs"),this.path=this.path?this.path:require("path");const t=this.path.resolve(this.dataFile),e=this.path.resolve(process.cwd(),this.dataFile),s=this.fs.existsSync(t),i=!s&&this.fs.existsSync(e);if(!s&&!i)return{};{const i=s?t:e;try{return JSON.parse(this.fs.readFileSync(i))}catch(t){return{}}}}}writedata(){if(this.isNode()){this.fs=this.fs?this.fs:require("fs"),this.path=this.path?this.path:require("path");const t=this.path.resolve(this.dataFile),e=this.path.resolve(process.cwd(),this.dataFile),s=this.fs.existsSync(t),i=!s&&this.fs.existsSync(e),r=JSON.stringify(this.data);s?this.fs.writeFileSync(t,r):i?this.fs.writeFileSync(e,r):this.fs.writeFileSync(t,r)}}lodash_get(t,e,s){const i=e.replace(/\[(\d+)\]/g,".$1").split(".");let r=t;for(const t of i)if(r=Object(r)[t],void 0===r)return s;return r}lodash_set(t,e,s){return Object(t)!==t?t:(Array.isArray(e)||(e=e.toString().match(/[^.[\]]+/g)||[]),e.slice(0,-1).reduce((t,s,i)=>Object(t[s])===t[s]?t[s]:t[s]=Math.abs(e[i+1])>>0==+e[i+1]?[]:{},t)[e[e.length-1]]=s,t)}getdata(t){let e=this.getval(t);if(/^@/.test(t)){const[,s,i]=/^@(.*?)\.(.*?)$/.exec(t),r=s?this.getval(s):"";if(r)try{const t=JSON.parse(r);e=t?this.lodash_get(t,i,""):e}catch(t){e=""}}return e}setdata(t,e){let s=!1;if(/^@/.test(e)){const[,i,r]=/^@(.*?)\.(.*?)$/.exec(e),o=this.getval(i),h=i?"null"===o?null:o||"{}":"{}";try{const e=JSON.parse(h);this.lodash_set(e,r,t),s=this.setval(JSON.stringify(e),i)}catch(e){const o={};this.lodash_set(o,r,t),s=this.setval(JSON.stringify(o),i)}}else s=this.setval(t,e);return s}getval(t){return this.isSurge()||this.isLoon()?$persistentStore.read(t):this.isQuanX()?$prefs.valueForKey(t):this.isNode()?(this.data=this.loaddata(),this.data[t]):this.data&&this.data[t]||null}setval(t,e){return this.isSurge()||this.isLoon()?$persistentStore.write(t,e):this.isQuanX()?$prefs.setValueForKey(t,e):this.isNode()?(this.data=this.loaddata(),this.data[e]=t,this.writedata(),!0):this.data&&this.data[e]||null}initGotEnv(t){this.got=this.got?this.got:require("got"),this.cktough=this.cktough?this.cktough:require("tough-cookie"),this.ckjar=this.ckjar?this.ckjar:new this.cktough.CookieJar,t&&(t.headers=t.headers?t.headers:{},void 0===t.headers.Cookie&&void 0===t.cookieJar&&(t.cookieJar=this.ckjar))}get(t,e=(()=>{})){t.headers&&(delete t.headers["Content-Type"],delete t.headers["Content-Length"]),this.isSurge()||this.isLoon()?(this.isSurge()&&this.isNeedRewrite&&(t.headers=t.headers||{},Object.assign(t.headers,{"X-Surge-Skip-Scripting":!1})),$httpClient.get(t,(t,s,i)=>{!t&&s&&(s.body=i,s.statusCode=s.status),e(t,s,i)})):this.isQuanX()?(this.isNeedRewrite&&(t.opts=t.opts||{},Object.assign(t.opts,{hints:!1})),$task.fetch(t).then(t=>{const{statusCode:s,statusCode:i,headers:r,body:o}=t;e(null,{status:s,statusCode:i,headers:r,body:o},o)},t=>e(t))):this.isNode()&&(this.initGotEnv(t),this.got(t).on("redirect",(t,e)=>{try{if(t.headers["set-cookie"]){const s=t.headers["set-cookie"].map(this.cktough.Cookie.parse).toString();s&&this.ckjar.setCookieSync(s,null),e.cookieJar=this.ckjar}}catch(t){this.logErr(t)}}).then(t=>{const{statusCode:s,statusCode:i,headers:r,body:o}=t;e(null,{status:s,statusCode:i,headers:r,body:o},o)},t=>{const{message:s,response:i}=t;e(s,i,i&&i.body)}))}post(t,e=(()=>{})){if(t.body&&t.headers&&!t.headers["Content-Type"]&&(t.headers["Content-Type"]="application/x-www-form-urlencoded"),t.headers&&delete t.headers["Content-Length"],this.isSurge()||this.isLoon())this.isSurge()&&this.isNeedRewrite&&(t.headers=t.headers||{},Object.assign(t.headers,{"X-Surge-Skip-Scripting":!1})),$httpClient.post(t,(t,s,i)=>{!t&&s&&(s.body=i,s.statusCode=s.status),e(t,s,i)});else if(this.isQuanX())t.method="POST",this.isNeedRewrite&&(t.opts=t.opts||{},Object.assign(t.opts,{hints:!1})),$task.fetch(t).then(t=>{const{statusCode:s,statusCode:i,headers:r,body:o}=t;e(null,{status:s,statusCode:i,headers:r,body:o},o)},t=>e(t));else if(this.isNode()){this.initGotEnv(t);const{url:s,...i}=t;this.got.post(s,i).then(t=>{const{statusCode:s,statusCode:i,headers:r,body:o}=t;e(null,{status:s,statusCode:i,headers:r,body:o},o)},t=>{const{message:s,response:i}=t;e(s,i,i&&i.body)})}}time(t,e=null){const s=e?new Date(e):new Date;let i={"M+":s.getMonth()+1,"d+":s.getDate(),"H+":s.getHours(),"m+":s.getMinutes(),"s+":s.getSeconds(),"q+":Math.floor((s.getMonth()+3)/3),S:s.getMilliseconds()};/(y+)/.test(t)&&(t=t.replace(RegExp.$1,(s.getFullYear()+"").substr(4-RegExp.$1.length)));for(let e in i)new RegExp("("+e+")").test(t)&&(t=t.replace(RegExp.$1,1==RegExp.$1.length?i[e]:("00"+i[e]).substr((""+i[e]).length)));return t}msg(e=t,s="",i="",r){const o=t=>{if(!t)return t;if("string"==typeof t)return this.isLoon()?t:this.isQuanX()?{"open-url":t}:this.isSurge()?{url:t}:void 0;if("object"==typeof t){if(this.isLoon()){let e=t.openUrl||t.url||t["open-url"],s=t.mediaUrl||t["media-url"];return{openUrl:e,mediaUrl:s}}if(this.isQuanX()){let e=t["open-url"]||t.url||t.openUrl,s=t["media-url"]||t.mediaUrl;return{"open-url":e,"media-url":s}}if(this.isSurge()){let e=t.url||t.openUrl||t["open-url"];return{url:e}}}};if(this.isMute||(this.isSurge()||this.isLoon()?$notification.post(e,s,i,o(r)):this.isQuanX()&&$notify(e,s,i,o(r))),!this.isMuteLog){let t=["","==============📣系统通知📣=============="];t.push(e),s&&t.push(s),i&&t.push(i),console.log(t.join("\n")),this.logs=this.logs.concat(t)}}log(...t){t.length>0&&(this.logs=[...this.logs,...t]),console.log(t.join(this.logSeparator))}logErr(t,e){const s=!this.isSurge()&&!this.isQuanX()&&!this.isLoon();s?this.log("",`❗️${this.name}, 错误!`,t.stack):this.log("",`❗️${this.name}, 错误!`,t)}wait(t){return new Promise(e=>setTimeout(e,t))}done(t={}){const e=(new Date).getTime(),s=(e-this.startTime)/1e3;this.log("",`🔔${this.name}, 结束! 🕛 ${s} 秒`),this.log(),(this.isSurge()||this.isQuanX()||this.isLoon())&&$done(t)}}(t,e)}
