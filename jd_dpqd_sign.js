/*
活动名称：批量店铺签到
活动链接：https://h5.m.jd.com/babelDiy/Zeus/2PAAf74aG3D61qvfKUM5dxUssJQ9/index.html?token=<token>
环境变量：jd_dpqd_tokens // 活动令牌，多个用英文逗号，@，&，换行分割
        jd_dpqd_task_threads // 控制签到并发线程数（正整数），默认1
        jd_dpqd_account_threads // 控制账号并发线程数（正整数），默认1
        jd_dpqd_account_interval // 自定义运行间隔时长（整数，单位毫秒），默认0
        jd_dpqd_max_retry // 签到火爆时的最大重试次数（整数），默认0
        jd_dpqd_prize_notify // 是否推送中奖信息（true/false），默认不推送

此脚本为高并发签到本，需要读取主脚本生成的活动信息缓存，自动过滤无效活动，签到后如有奖品则自动到账


cron:1 1 1 1 *

*/

const $ = new Env('批量店铺签到')
var iｉl='jsjiami.com.v7';const ll1I1=iii1II;function iii1II(_0x15d1e7,_0x49b856){const _0x33cceb=Iii11l();return iii1II=function(_0x4bc81e,_0x155df5){_0x4bc81e=_0x4bc81e-0x140;let _0x431822=_0x33cceb[_0x4bc81e];if(iii1II['HcSqfJ']===undefined){var _0x2d688c=function(_0x15c5f9){const _0x5a044f='abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789+/=';let _0x3afb21='',_0x144408='';for(let _0x282f05=0x0,_0x1ef0df,_0x3784b0,_0x49a94b=0x0;_0x3784b0=_0x15c5f9['charAt'](_0x49a94b++);~_0x3784b0&&(_0x1ef0df=_0x282f05%0x4?_0x1ef0df*0x40+_0x3784b0:_0x3784b0,_0x282f05++%0x4)?_0x3afb21+=String['fromCharCode'](0xff&_0x1ef0df>>(-0x2*_0x282f05&0x6)):0x0){_0x3784b0=_0x5a044f['indexOf'](_0x3784b0);}for(let _0x43ae7c=0x0,_0x2d1e34=_0x3afb21['length'];_0x43ae7c<_0x2d1e34;_0x43ae7c++){_0x144408+='%'+('00'+_0x3afb21['charCodeAt'](_0x43ae7c)['toString'](0x10))['slice'](-0x2);}return decodeURIComponent(_0x144408);};const _0x3b2516=function(_0x56d2bd,_0x32a939){let _0x3d6d2e=[],_0x5e9a29=0x0,_0x341356,_0x43d558='';_0x56d2bd=_0x2d688c(_0x56d2bd);let _0x2b30b7;for(_0x2b30b7=0x0;_0x2b30b7<0x100;_0x2b30b7++){_0x3d6d2e[_0x2b30b7]=_0x2b30b7;}for(_0x2b30b7=0x0;_0x2b30b7<0x100;_0x2b30b7++){_0x5e9a29=(_0x5e9a29+_0x3d6d2e[_0x2b30b7]+_0x32a939['charCodeAt'](_0x2b30b7%_0x32a939['length']))%0x100,_0x341356=_0x3d6d2e[_0x2b30b7],_0x3d6d2e[_0x2b30b7]=_0x3d6d2e[_0x5e9a29],_0x3d6d2e[_0x5e9a29]=_0x341356;}_0x2b30b7=0x0,_0x5e9a29=0x0;for(let _0x47b0a5=0x0;_0x47b0a5<_0x56d2bd['length'];_0x47b0a5++){_0x2b30b7=(_0x2b30b7+0x1)%0x100,_0x5e9a29=(_0x5e9a29+_0x3d6d2e[_0x2b30b7])%0x100,_0x341356=_0x3d6d2e[_0x2b30b7],_0x3d6d2e[_0x2b30b7]=_0x3d6d2e[_0x5e9a29],_0x3d6d2e[_0x5e9a29]=_0x341356,_0x43d558+=String['fromCharCode'](_0x56d2bd['charCodeAt'](_0x47b0a5)^_0x3d6d2e[(_0x3d6d2e[_0x2b30b7]+_0x3d6d2e[_0x5e9a29])%0x100]);}return _0x43d558;};iii1II['YAoLFg']=_0x3b2516,_0x15d1e7=arguments,iii1II['HcSqfJ']=!![];}const _0x5c0d6f=_0x33cceb[0x0],_0x3f2775=_0x4bc81e+_0x5c0d6f,_0x4012ae=_0x15d1e7[_0x3f2775];return!_0x4012ae?(iii1II['HGxzqy']===undefined&&(iii1II['HGxzqy']=!![]),_0x431822=iii1II['YAoLFg'](_0x431822,_0x155df5),_0x15d1e7[_0x3f2775]=_0x431822):_0x431822=_0x4012ae,_0x431822;},iii1II(_0x15d1e7,_0x49b856);}(function(lIIiIl,iI1Iil,il1iI,i1iIii,i1iIil,liI1il,llIlIi){return lIIiIl=lIIiIl>>0x7,liI1il='hs',llIlIi='hs',function(llIlIl,II11I,il1i1,lIIiIi,liI1iI){const lIIiI1=iii1II;lIIiIi='tfi',liI1il=lIIiIi+liI1il,liI1iI='up',llIlIi+=liI1iI,liI1il=il1i1(liI1il),llIlIi=il1i1(llIlIi),il1i1=0x0;const iI1Il1=llIlIl();while(!![]&&--i1iIii+II11I){try{lIIiIi=-parseInt(lIIiI1(0x18b,'!8Xl'))/0x1+-parseInt(lIIiI1(0x173,'#Z#G'))/0x2*(-parseInt(lIIiI1(0x151,'T0Bl'))/0x3)+-parseInt(lIIiI1(0x23d,'Sp9]'))/0x4*(-parseInt(lIIiI1(0x156,'gjV8'))/0x5)+parseInt(lIIiI1(0x1f7,'r]mC'))/0x6*(parseInt(lIIiI1(0x208,'dsy0'))/0x7)+parseInt(lIIiI1(0x180,'U54X'))/0x8+parseInt(lIIiI1(0x1a9,'1CPY'))/0x9+parseInt(lIIiI1(0x21a,'pyWH'))/0xa*(-parseInt(lIIiI1(0x207,'VVZE'))/0xb);}catch(i1iIl1){lIIiIi=il1i1;}finally{liI1iI=iI1Il1[liI1il]();if(lIIiIl<=i1iIii)il1i1?i1iIil?lIIiIi=liI1iI:i1iIil=liI1iI:il1i1=liI1iI;else{if(il1i1==i1iIil['replace'](/[LAyHbhGKdnTNVquOWrX=]/g,'')){if(lIIiIi===II11I){iI1Il1['un'+liI1il](liI1iI);break;}iI1Il1[llIlIi](liI1iI);}}}}}(il1iI,iI1Iil,function(i1lli1,llIlII,IIlII,lIIiII,i1iIlI,li111,liI1lI){return llIlII='\x73\x70\x6c\x69\x74',i1lli1=arguments[0x0],i1lli1=i1lli1[llIlII](''),IIlII='\x72\x65\x76\x65\x72\x73\x65',i1lli1=i1lli1[IIlII]('\x76'),lIIiII='\x6a\x6f\x69\x6e',(0x1625b8,i1lli1[lIIiII](''));});}(0x6180,0x3ac98,Iii11l,0xc5),Iii11l)&&(iｉl=0x237a);const jdCookie=require('./jdCookie'),notify=require(ll1I1(0x199,'XxxV')),common=require('./utils/Rebels_jdCommon'),{H5st,jsTk}=require(ll1I1(0x212,'2U70'));console[ll1I1(0x216,'WQDJ')](''),console[ll1I1(0x186,'!8Xl')](ll1I1(0x166,'pyWH')+$[ll1I1(0x1ea,'WQDJ')]+ll1I1(0x154,'gjV8')),console[ll1I1(0x19f,'P!]J')](ll1I1(0x213,'S)k^')),console['log'](ll1I1(0x14b,'v%aw')),console['log']('jd_dpqd_account_threads\x20//\x20控制账号并发，默认1'),console[ll1I1(0x17a,'FEXj')](ll1I1(0x141,'r]mC')),console[ll1I1(0x167,'#Z#G')](ll1I1(0x15b,'B70O')+$[ll1I1(0x221,'pyWH')]+'提示结束=========='),console['log']('');function Iii11l(){const IiillI=(function(){return[iｉl,'VTnGjqWLsbjniaymHiX.AcdrAoNmVHK.AhvuHO7r==','se3dTJRcJCkNW4ZcGq','W4bYW6vTW4ZcLmkvW5C','fv4FsJRdJYRdHCkxxaFdHW','qcenW78','WPKQWPT1','qbRcMeddKW','W6NdMN1xW63cVb4','WP3dHd8mtG','x0pcTgnRWRBcU8k1WPxdLdi1','i8obWPNcOSk8W64','FCodpa','A+kDPvFIN5CG562t5yIy5OMy5yIM','DXb2W6u','WQuyagu0','WQmlWORcUdPtWOG','W5ZcVCo8','lJiDW7NcT8oadutdSSoYE3XBWO4dnxv1lSk1WQS+lSoYWRJdTLy','WPdcLCkhW57cOq','fConWQf4WQPFmG','WOldUmkKimoh','nUkFPXBIN4CN56+G5yUU5OMh5yM1772s','vJrWW5hdUW','WOS5fW','lmoIWQxcOCkD','WQ8QWPddMW','FY1tW7JdSG','qCkoW7ODW4G','WP9zW6NcLXpdKa','WOyHW4LyW6W','WOxcQSo6W53dHG','WRxcVCkD','t1NdRcy','W6O6BSkTWQTymsBdL0hdL1PE','WRLcFhxdKa','WO7cT8ovWOZdGSkFrcCz','5yA757UP5y+F8jsKPq','W5dcRCoVWOFcG8kjWQFdP2BcPW','WPSQWQ5pWQO','WPZcSmouWOZdI8kw','WQBdHZexzqj5','WPLpW67cVrVdKqtdKCorpCkyrc/cIq','WPFdN3j0jq','trDLW7tdVa','6lEr5yYB5Psm5PAM','yGLdWQC','l3xdO8oJCG','qmk/WR7cKmko','qhfkhGG','WQ/dPMPbeq','WRvNn8o6W6Oc','WRtdUxXeoG','EmkjWOVcS8kvfCkwW4qgWOm9W5ddKMLeWQhcUW','WOP4W5lcJZC','WOmNWQrRjq','WOPZC3/dMG','z8oIp3iY','C20eW6tcQG','WP7cVSkAWQzU','WQ1IFNtdP8o0','xf0mWQGw','WQVcMCkTgw4','WPjbW6dcQay','WRtcOSkgc2K','4P6uW7ZOH7FMNAJOVzxOOBdPG4BLIlpKUyZPL6dORQmw','t03dRs/cTmk9W6xcHs10','W43dUMzsmSoCWR8','WP3cQSkSW5e','WOVcTSkPWRFdTW','vCkgW6C','W6TKW5C','wEkDHCox6k+n5Rgr5AwJ6lw077+9','5l2A5Ogs5yUs8y2KIU+6JW','5lQt6lgQ8lIHUa','jSo2WPdcRCkx','qSkgWQhcTmkb','W5VcG8ouWRBcOW','44oU6lA15y+e','WO1cW7pcMaa','hfJdR8ktW7S','WQZcGSkCWQtdRq','WRRcISkzWR7dRCogmcfaW70','WRBcNmktWQhdRmorbIS','77YO8ksQGW','WOBcGmkKW5lcPa','W7OOW7BcTa','iHL8l0y','WOq5hKWtWPjcwG','sJ8eW6pdRa','fM3dPmoLDSk6pSozWRZcR8kaW4BcSSowkSozomkWWP5Yn8kQW6XO','dWldQ3K1WQNcMSkYW7ldHYG0','W7KkW4VcOsu','W7qIW4VcGq8'].concat((function(){return['qqeeW6JdQa','vdukW7y','tvRcUInfW7FcVCk9W57dLcKFtmk0W6i','rHvbdI7dNtRdSmkOAd/dNhdcQCk2xK8','WOFcGCkGW4BcHa','uflcScG','w03dQY8','itHOheS','WPlcJCowAf4','i8oEWOy','5ys9xowpSFc6NOq','scZcKNtdRa','uSktW7SfW74','wcakW6FdUCoOtCoSWPdcJG7cHCk/fh0LWOVcSNSmprJdHSo9oK0CWR9KWR7dQ8o1WROUy8kNB0uBiSkBoYSaW6tdHmkwdqvOFmk9CtmMWRZcPrWfWPFcI8kVp8oAxwThpmo8f8oiWRPP','WRpdItCp','4PQWWPdORQZLHAJLR7NKU7dLVP3OPyhNMkZNJQZLORBLJORPH6tLK6ZLHl3OV5BOOl7OHQtMNkBVVle','cxJdUCoHuCoPFmkt','f8k0W6JdIKe','WPv+rmktW61rW7qPWP8','lSoDWO0','dmk6WO9ksG','WOFcL8kJmKu','cuVdTmohva','WO8QWRnyWPy1EdG','WQdcOSoSxvi','W4P8WOnlW5tdSG','q8o6e3roW70iWPhdReSa','WOWLWQj7WRy','W7ddHfDGW6W','n8oHW7ZcJCo2','FUA0V+wlUowMPoEcPoEjJq','W5r8WOXiW6BdS8oaWQBcQSkGj8kQ','u0pdUa','FN8tWQ4bF3WGWODwWPJcNgb0WQxdK8oPq8kIvG','W4P5WQPNWPmvybK','De0KtJqSaSkUW7GIWO4S','hmkDjmkWCG','WQ5cFxldMa','6lEN5y+W5PEW5PwBWRpWUjQP','xdSz','WOSZhKGZWPS','quGrWO0a','WPNcH8oDWOpdOa','zWTZW7ldV8oeFmoCFmoa','WP7cRmodWOa','gXPkbWjBWRqQl0JcPCo2W5T1WPZdMG','W4/cNtyjWRaSWRtcPbf6W4zNWQmdrCk3bCo95RA+5yIVW7eP77Yf5AEG5lQZ55wE6iMn5PEm6yc05y625yQu5yMv','buhdKSk3W7y','WRLqW5tcVt0','uLZcUG','DSkeWQFcTmkkeCkCW68','h8kFW7u','fNxdPSoXtq','mtzHWRVdU3lcTmk8W4hcTZxcKmk2','fEkEQr/INl9l562j5yU35As06lwydCoQWRm','qwD3aIG','raulW7/dHW','ioIVQUAWQUwrGow5ISkm','W5C5WQLZWQySzdLGhM0scKpcIeJdRHfZW40','WQ5JmmoPW4OdBHS','Bgu9W6S','s0KeW7FcHq','WR1Tn8o4','WO3cHmobWQ12W5ddNtRdRCkPo8o0pCkRWO3dI8kUm0C','CbjyWQnRW7lcPW','W57INi8t4P26vUEVJEwlV+wLQoI3VE+8HW','kCkLW5VdOvG','rZJcNLxdQZVdOSob','WRVcS8kjiq','W40He8kSW7bKW6e+','W5DMqa','WP1fW77cMW','sSkmW7q','o8oaW6FcJ8oFDrG','WRvTpG','4PM5iUIgS+wSH+s7L+I+UUIHJ+MwIUMyS+AxLoMxO+IUKUE9HoMxL+IVMq','Dwu5W7O','W47dIwzvW6e','W6ddRhT/W7K','WQVcQmkmnSoXt8owASk+WPe','dNJdOSoMya','WPeSW7C','WQDUFgFdTSoU','WOaQWP9K','l8oxWPNcUmk6W6Dx','WOmCWOZdU3C','WPLpW64','WOKUWOzjDSocyq','W7u3DetdUmoDCfq','ju0H','imklWP1izW','WQ5YyvBdIG','fSkiW7VdMa','W4hcMb0m'].concat((function(){return['WQZcJSkLnCog','WQNcR8kPW5/cTq','fCoBWQrMWQ5dmb0pW7VdPupdHW','WPBcG8omA0i6','a2zpWQlcVSoRuSkVWOJdIhtcKSoL','WRxcPCkaWRNdVW','WRylWO/cGtbhWPu7WQuBfmktWPPn','D8kdWQi','W67dLM5r','r8oAoKSX','WRjUD33dKmoZBLbEcCoRgNddHLW','WRSLWO5RWOq','CLCJW4tcMa','WRFdItmElqXLgCk3W5/dQq','WPpcOSokWOa','WPFcLmkeWOddGa','sa0hW4VdQK4','WO/dGZqmEq','5P6x5yIo5zM257M15B2r','WOZcVCkufudcSq','qHHllM8','W44Rl8kKW7vXW6asWRpdQIBcT8kjmCoFCJ7dRtrVW4tdHCoJW7bfWPK9e+IfUUwVHUs6PUI+ToIIPEMvVUMzJUAwR+MxNq','WPhdQty8BW','5PYA55685AAH5zoG7763','FHTnW6tdU8ogt8oQAColqItdU1X6WPlcTxSuW5bVW6qu','bKRdOCoyAq','W4K8fW','WOnxemoqW4S','vsVcHu7dJq','WP3cT8kTW5xcKWC','gCkae8kQwa','tmkhW4WYW6SazHOlW7NdNv7dRmo7W6r+gCkSWPtcN1PmW7BcToAnOEwjQ+EVPEwlKow4V+woHo++QUM5SUIUTNW','WQPNWRy','yNLueJK','WO5jsblcOSkIe8kkWRtcL8keWQ8','yCkMW4C','WRylWO8','dexdIIRcNCkHW5e','zXGvW7BdMa','WQ1NkSoP','5y+16ywb6k2v5PUuW5JdGmk0w8ouW4j8oNlcNq','W4GGfW','hmk+WPpdOSowW4JdNXpcNmkLn10','tb5SWQXg','qGefW5JdU1q','WO0Yl0S3WOjvBSk0WP3cR8kTWOpdRqxcLJldV2pcLq','imkCdSkH','W5n2W488FSkmkmk/W4FcRq','yKavWPmu','mCoAWOpcRCkV','WPa4WRXGWQq','WQldO8kl','tSoHW4xcVW','WPTdxKldTW','WOJcT8obW4JcLa','WO3cUCk5emoM','5RE65yUJ5BoN5P6u5BYL5AwU','WPVcG8kl','pZLTWRpdSNBcUCoTWOZdUq','WPBcICof','WPnpW6NcJrxdMqO','xG3cNfFdUa','WR9fBGtcJa','j8oCWPW','AxuoW4JcNW','hUkER8o94P2ijUEVPUwlOEAlGEwiPo++VW','WRnMbSo5W64BzYhdHKhdV0nFWQbcyh8vW5pdJwNcLXXx','W7VdJgPDW77cPHL+q8oQ','uG0hW4JdU1tcHNW','tqyAW4NdRfi','ESoubeqtW4G8WP/dNgjgoxtcLSoyDbFdN25d','W47dLCkuna5GW7pdPmkoW6VdVIa','WR1VDYlcKa','y3imW6G','W493WPLjW5ldMCojWQ3cJCk8o8kwpCoBWQNcTgKlW77dIq','eokFHCox6k+w5Ro95AwJ6lAQ776S5PEy5zo/5BQQ5PwI5OYZ77Yv8kk4Sq','EH5yWQvZW7y','WR/cUCkz','WOhcOCka','kCoxWO/cU8o2W6fEWOBcKCkk','xSoRW5u','omkCaW','f1/dO8ohta','h8kvW7ZdI3NdHG','W4ZdS8ktW5ZcMmoifqisB8ksE8kt','4P2QW4pMNRNOGQVMR7JNOj/LPiBNKynF','A1BcIrLL','WQ7cLSkfWPXW','j0OcWPfVW4/cRJpcPW','l8ogWPNcKSkt','tqbp','z3GCW4dcU8oFdqRdH8oY','WOO3aa'];}()));}()));}());Iii11l=function(){return IiillI;};return Iii11l();};let tokensList=(process[ll1I1(0x16b,'hwB@')]['jd_dpqd_tokens']||'')[ll1I1(0x1d8,'liyQ')](/[,@&|\n]+/g)['filter'](Boolean),taskThreads=process[ll1I1(0x236,'THpV')][ll1I1(0x172,'3bqq')]||'1',accountThreads=process['env'][ll1I1(0x144,'VpAp')]||'1';const runInterval=process[ll1I1(0x24a,'LtYR')][ll1I1(0x16e,'1CPY')]||'';let signHotMaxRetryTimes=process['env'][ll1I1(0x1bc,'LtYR')]||'0';const isNotify=process['env'][ll1I1(0x159,'P!]J')]===ll1I1(0x1b5,'ek9&');let TokensMap=new Map();const signStatusMessages={0x1805c007:'今日已签',0x1843da61:ll1I1(0x164,'KR0]'),0x1843da62:'活动已经结束',0x184253c7:ll1I1(0x1b4,'W0a*'),0x192:'活动无效','-1':ll1I1(0x255,'8i8]')},invalidTokensMap=new Map(),CacheFile=__dirname+ll1I1(0x21f,'VVZE'),cookiesArr=Object[ll1I1(0x15a,'8ef#')](jdCookie)[ll1I1(0x188,'P!]J')](liil11=>jdCookie[liil11])[ll1I1(0x237,'Sp9]')](iiillI=>iiillI);!cookiesArr[0x0]&&($[ll1I1(0x146,'r]mC')]($[ll1I1(0x251,'U54X')],'【提示】请先获取Cookie'),process[ll1I1(0x241,'tP9Z')](0x1));!(async()=>{const Ii1ili=ll1I1,l1l111={'CIeUQ':function(l1iIII,llI1I1){return l1iIII(llI1I1);},'TDYzn':function(IlIlil,lIli1I){return IlIlil>=lIli1I;},'LtHnY':function(II1il,lllI11,I1lIll,I1lIli,II1ii,IIIIII){return II1il(lllI11,I1lIll,I1lIli,II1ii,IIIIII);},'jMOXV':function(lillII,ii1ilI){return lillII>ii1ilI;},'oEmaK':function(lI1ll1,iIiI1){return lI1ll1(iIiI1);},'KLkce':Ii1ili(0x162,'U54X'),'ihfEA':function(liil1I,i11ii1){return liil1I(i11ii1);},'VbUGH':function(IlIliI,l1iII1){return IlIliI(l1iII1);},'xSqMl':function(iiill1,lIli1i){return iiill1>lIli1i;},'wRdRQ':function(IIIII1,I1lIlI){return IIIII1===I1lIlI;},'hlvdH':'wZHkC','Qlsvw':'bYsUY','aFzvS':function(ii1ill,II1iI){return ii1ill!==II1iI;},'yMEJN':function(llI1II,lIli1l){return llI1II(lIli1l);},'Tfxai':function(lillIi,illIi1){return lillIi!==illIi1;},'zEUen':'hktdh','BNpJs':Ii1ili(0x152,'PmdC'),'FWJeI':function(ii1ili,liil1i){return ii1ili!==liil1i;},'ZUIMU':Ii1ili(0x240,'Sp9]'),'iFsRI':function(lI1lil,i1l1iI){return lI1lil!==i1l1iI;},'mtsYH':Ii1ili(0x1c6,'WP6A')};try{notify['config']({'title':$[Ii1ili(0x238,'B70O')]});if(l1l111[Ii1ili(0x1d4,'TWn6')](tokensList['length'],0x0))tokensList=[...new Set(tokensList[Ii1ili(0x158,'07DY')](lI1lii=>lI1lii!==''))];if(tokensList[Ii1ili(0x20d,'P!]J')]<=0x0){console[Ii1ili(0x205,'T0Bl')](Ii1ili(0x1f4,'3bqq'));return;}const liil1l=l1l111[Ii1ili(0x20a,'Sp9]')](require,'fs');if(liil1l[Ii1ili(0x1d9,'liyQ')](CacheFile)){const Iiili1=liil1l[Ii1ili(0x204,'y6LU')](CacheFile,l1l111[Ii1ili(0x1c4,'1@Xx')]),Iil1l1=JSON[Ii1ili(0x235,'wF5Z')](Iiili1);for(const i1i11I in Iil1l1){TokensMap[Ii1ili(0x17d,'8ef#')](i1i11I,Iil1l1[i1i11I]);}}$[Ii1ili(0x1fc,'VVZE')]=null;if(runInterval)try{const il1iIl=l1l111[Ii1ili(0x16c,'XxxV')](parseInt,runInterval);l1l111['TDYzn'](il1iIl,0x0)&&($['waitTime']=il1iIl);}catch{console[Ii1ili(0x205,'T0Bl')](Ii1ili(0x230,'1CPY'));}try{const iii1ii=l1l111['VbUGH'](parseInt,signHotMaxRetryTimes);signHotMaxRetryTimes=l1l111[Ii1ili(0x214,'T(Ti')](iii1ii,0x0)?iii1ii:0x0;}catch{if(l1l111[Ii1ili(0x1c0,'3bqq')](l1l111[Ii1ili(0x219,'wF5Z')],l1l111[Ii1ili(0x1b6,'wF5Z')]))return;else signHotMaxRetryTimes=0x3;}try{if(l1l111['aFzvS']('vmKbb','vmKbb')){IiilI1[Ii1ili(0x22f,'1CPY')]('⚠\x20请先定义必要的环境变量后再运行脚本！');return;}else{const II11li=l1l111['yMEJN'](parseInt,taskThreads);if(II11li>0x0&&l1l111[Ii1ili(0x232,'8i8]')](II11li,0x1)){if(Ii1ili(0x1ed,'#Z#G')===l1l111['zEUen'])taskThreads=II11li;else{const iIIiiI=l1l111['CIeUQ'](IlI1l,lilIil);l1l111[Ii1ili(0x1cc,'liyQ')](iIIiiI,0x0)&&(i1l1li['waitTime']=iIIiiI);}}}}catch{taskThreads=0x1;}try{if(l1l111[Ii1ili(0x196,'P!]J')]!==Ii1ili(0x14d,'2U70'))IiilI[Ii1ili(0x165,'W0a*')](Ii1ili(0x181,'v%aw')+ii1I11+Ii1ili(0x21e,'XxxV')+(liIi1[Ii1ili(0x168,'WP6A')]||lI11II));else{const ililIi=parseInt(accountThreads);l1l111[Ii1ili(0x145,'wF5Z')](ililIi,0x0)&&l1l111[Ii1ili(0x1c5,'FEXj')](ililIi,0x1)&&(l1l111[Ii1ili(0x1fb,'wF5Z')](l1l111[Ii1ili(0x227,'tP9Z')],l1l111[Ii1ili(0x147,'1CPY')])?accountThreads=ililIi:(I1iIli=lI1Ill[Ii1ili(0x170,'07DY')],lI1Ili=IliilI[Ii1ili(0x1ad,'TWn6')]));}}catch{accountThreads=0x1;}await common[Ii1ili(0x1df,'P!]J')](accountThreads,cookiesArr,async(ililIl,liiI1l)=>{const iI1Ii1=Ii1ili;await l1l111[iI1Ii1(0x19c,'m0a#')](concMain,taskThreads,tokensList,ililIl,liiI1l,Main);if($[iI1Ii1(0x1f5,'wF5Z')])await $[iI1Ii1(0x231,'pyWH')]($[iI1Ii1(0x220,'1CPY')]);}),isNotify&&notify[Ii1ili(0x187,'XxxV')]()&&await notify['push']();}catch(i1l1II){if(l1l111[Ii1ili(0x17e,'wF5Z')](l1l111[Ii1ili(0x185,'hwB@')],Ii1ili(0x183,'W0a*')))console[Ii1ili(0x19f,'P!]J')](Ii1ili(0x1c8,'KfDP')+i1l1II);else{ii1li[Ii1ili(0x15f,'m0a#')](''+IIll1+ll1il+Ii1ili(0x16d,'WQDJ')+IiiIiI['join']('，')+'）');for(const I1l11l of ll1li){lliiiI[Ii1ili(0x171,'07DY')](I1l11l);}}}})()[ll1I1(0x1ae,'VVZE')](lilIIi=>$['logErr'](lilIIi))[ll1I1(0x225,'ek9&')](()=>$[ll1I1(0x223,'1CPY')]());async function Main(i1l1Il,llIli){const Ii1ill=ll1I1,i1i11l={'YlawN':function(Ilil1l,iIIiii){return Ilil1l(iIIiii);},'REeyY':function(iilll){return iilll();},'nTkvG':function(il1iI1,IlllIi,iIIiil){return il1iI1(IlllIi,iIIiil);},'Itllh':Ii1ill(0x1e7,'WQDJ'),'tRHqC':function(i1l1Ii,I1iIIi){return i1l1Ii===I1iIIi;},'WdSbr':function(I1iIIl,lI1IIl){return I1iIIl>lI1IIl;},'dDzfL':function(i1ilI,iii1lI){return i1ilI!==iii1lI;},'tnxWt':'aWXaO','Qilii':Ii1ill(0x1d0,'hwB@'),'QuYwg':Ii1ill(0x1bf,'Sp9]'),'tQuhM':Ii1ill(0x19e,'VpAp'),'pIQDW':function(i1ilI1,Iiilii){return i1ilI1===Iiilii;},'ZeZnA':function(Iil1li){return Iil1li();},'xElfC':'123','WjakR':function(Iiilil,Iil1ll){return Iiilil===Iil1ll;},'RgPXp':Ii1ill(0x1a0,'hwB@'),'CnTGF':Ii1ill(0x14f,'v%aw'),'RRjGk':Ii1ill(0x1a6,'TWn6'),'ksUZs':'interact_center_shopSign_signCollectGift','vLOmk':Ii1ill(0x176,'y6LU'),'fFwaJ':function(iillI,lI1III){return iillI(lI1III);},'zCeKq':Ii1ill(0x14c,'ioGh'),'ucxpY':Ii1ill(0x1e1,'wF5Z'),'IMHbJ':Ii1ill(0x1ce,'KR0]'),'IMTyJ':Ii1ill(0x224,'W0a*'),'EXNAb':Ii1ill(0x17b,'hwB@'),'eimDv':Ii1ill(0x191,'WQDJ'),'luGZQ':'https://h5.m.jd.com/','eznJH':'script','YRjrt':'no-cors','rJKIF':Ii1ill(0x14e,'5l$4'),'jWptf':function(IIliIi,IllIiI){return IIliIi<IllIiI;},'mlVjf':Ii1ill(0x140,'!8Xl'),'UeTTc':Ii1ill(0x20e,'1@Xx'),'yKheC':function(i1il1,I1l111,IIii1l){return i1il1(I1l111,IIii1l);},'aJLia':function(I1iIII,liiI11){return I1iIII>=liiI11;},'NLqJf':function(ililI1,IIii1i){return ililI1!==IIii1i;},'vFdRE':'APTZT','rcHbK':function(i1ili,Iiill1){return i1ili===Iiill1;},'kRAxy':function(I1iII1,lilII1){return I1iII1!==lilII1;},'zkztf':Ii1ill(0x1b3,'VpAp'),'RydxX':Ii1ill(0x215,'WP6A'),'Pkucd':function(iill1,iii1l1){return iill1/ iii1l1;},'injQz':function(IIliIl,II11ll){return IIliIl>II11ll;},'gboij':Ii1ill(0x23a,'KR0]'),'tphSe':function(liiI1I,ililII){return liiI1I<ililII;},'NqCQf':function(lI1II1,i1ilII){return lI1II1(i1ilII);}},{title:i1i11i,UA:II11l1,cookie:Iil1lI,message:IiiliI,jsToken:iii1iI}=llIli;if(invalidTokensMap[Ii1ill(0x179,'KfDP')](i1l1Il))return;let llIll='',il1iII='';const iilli=TokensMap[Ii1ill(0x23b,'WP6A')](i1l1Il);if(iilli)i1i11l['NLqJf'](Ii1ill(0x1e3,'ioGh'),i1i11l['vFdRE'])?(llIll=iilli['venderId'],il1iII=iilli[Ii1ill(0x16f,'8i8]')]):lii['assign'](IllI1i,i11I1l);else try{if(i1l1Il[Ii1ill(0x22a,'r]mC')](':')&&i1i11l[Ii1ill(0x1a5,'THpV')](i1l1Il['split'](':')[Ii1ill(0x1fe,'y6LU')],0x3)){const IllIi1=i1l1Il[Ii1ill(0x1c1,'XxxV')](':');if(!IllIi1[0x0]||!IllIi1[0x1]||!IllIi1[0x2])return;i1l1Il=IllIi1[0x0];if(i1i11l[Ii1ill(0x1a2,'VpAp')](i1l1Il[Ii1ill(0x246,'#Z#G')],0x20)||!/^[A-Z0-9]*$/['test'](i1l1Il))return;il1iII=IllIi1[0x1],llIll=IllIi1[0x2],IllIi1[0x2]['startsWith'](Ii1ill(0x23e,'VpAp'))&&i1i11l[Ii1ill(0x16a,'5l$4')](IllIi1[0x2][Ii1ill(0x1c3,'Sp9]')],0x8)&&!IllIi1[0x1][Ii1ill(0x234,'KfDP')](i1i11l[Ii1ill(0x1aa,'Sp9]')])&&(il1iII=IllIi1[0x2],llIll=IllIi1[0x1]),TokensMap['set'](i1l1Il,{'index':null,'venderId':llIll,'shopName':'','activityId':il1iII,'startTime':'','endTime':'','isValid':!![],'rules':[],'minLevel':null,'maxLevel':null});}}catch(lilIII){return;}if(!llIll||!il1iII){if(i1i11l[Ii1ill(0x1e0,'PmdC')]===i1i11l[Ii1ill(0x14a,'8ef#')])i1IIl=I1lll1;else return;}const IlllIl=Math['floor'](i1i11l[Ii1ill(0x1d3,'LtYR')](Date['now'](),0x3e8))+Ii1ill(0x22b,'P!]J');if(invalidTokensMap[Ii1ill(0x150,'R)Lb')](i1l1Il))return;let II11lI=![];await i1i11l[Ii1ill(0x1c7,'FEXj')](I1l11I,i1i11l['Itllh']);if($[Ii1ill(0x1fc,'VVZE')])await $[Ii1ill(0x18d,'B70O')]($[Ii1ill(0x189,'T0Bl')]);if(II11lI&&i1i11l['injQz'](signHotMaxRetryTimes,0x0)){if(i1i11l[Ii1ill(0x202,'O]&5')](i1i11l['gboij'],i1i11l['gboij'])){const iliIil=i1i11l[Ii1ill(0x169,')4cU')](iI1liI,()=>{const llIlI1=Ii1ill;i1i1I1===0x0&&(i1i11l[llIlI1(0x190,'GN)z')](lli,iliIil),i1i11l['REeyY'](liIlI));},0x64);}else{let iliIii=0x0;while(i1i11l[Ii1ill(0x1f1,'v%aw')](iliIii,signHotMaxRetryTimes)){if(invalidTokensMap['get'](i1l1Il))return;await i1i11l['NqCQf'](I1l11I,i1i11l['Itllh']);if($[Ii1ill(0x228,')4cU')])await $[Ii1ill(0x1f3,'GN)z')]($['waitTime']);if(!II11lI)break;iliIii++;}}}function lI1IIi(lill1i,il1li){const iI1IiI=Ii1ill;try{switch(lill1i){case i1i11l['Itllh']:if(i1i11l[iI1IiI(0x1bd,'WP6A')](il1li[iI1IiI(0x1cb,'HWlU')],0xc8)&&il1li['success']===!![]){const iIIill=[];if(il1li[iI1IiI(0x1dd,'ioGh')]&&i1i11l[iI1IiI(0x209,'8ef#')](il1li[iI1IiI(0x1eb,'T0Bl')][iI1IiI(0x17f,'tP9Z')],0x0))for(const iilii of il1li[iI1IiI(0x242,'S)k^')]){if(i1i11l['dDzfL'](i1i11l['tnxWt'],i1i11l[iI1IiI(0x200,'VVZE')]))IillIl[iI1IiI(0x1af,'U54X')](llliil,liIl1);else{const iilil=iilii?.['prizeList']||[];for(const Ill11l of iilil){const il1ll=Ill11l?.[iI1IiI(0x24b,'8i8]')],i1ilIi=Ill11l?.[iI1IiI(0x217,'LtYR')];let lill1l='';switch(il1ll){case 0x1:lill1l=i1i11l['Qilii'];break;case 0x4:lill1l=i1ilIi+iI1IiI(0x1d1,'T0Bl');break;case 0x6:lill1l=i1ilIi+'店铺积分🎟️';break;case 0x9:lill1l=Ill11l?.[iI1IiI(0x206,'1@Xx')][0x0]?.['skuName']+'🎁';break;case 0xa:lill1l=i1ilIi+iI1IiI(0x1ef,'wF5Z');break;case 0xe:lill1l=i1ilIi/0x64+iI1IiI(0x1ac,'VVZE');break;default:lill1l=iI1IiI(0x143,')4cU')+il1ll+'）';}iIIill[iI1IiI(0x18c,'PmdC')](lill1l);}}}if(iIIill['length']>0x0){console['log'](''+i1i11i+i1l1Il+iI1IiI(0x19d,'ek9&')+iIIill['join']('，')+'）');for(const l1l1i1 of iIIill){i1i11l[iI1IiI(0x1f6,'tP9Z')]('KtclI',i1i11l[iI1IiI(0x1b9,'ZvP*')])?llIlli[iI1IiI(0x1f8,'hwB@')](''+llIlll+lliii1+iI1IiI(0x194,'8ef#')):IiiliI['insert'](l1l1i1);}}else console[iI1IiI(0x155,'r]mC')](''+i1i11i+i1l1Il+'\x20➜\x20✅\x20签到成功');II11lI=![];}else{if(i1i11l[iI1IiI(0x20f,'U54X')](il1li[iI1IiI(0x175,'XxxV')],0xc8)){if(i1i11l[iI1IiI(0x1d2,'hwB@')](i1i11l['tQuhM'],i1i11l[iI1IiI(0x21d,'PmdC')])){llliii['log'](IllI11+iI1IiI(0x20b,'Sp9]'));return;}else{const llI11I=signStatusMessages[il1li[iI1IiI(0x22c,'WP6A')]]||il1li[iI1IiI(0x195,'VpAp')]+iI1IiI(0x203,'pyWH');[0x1843da61,0x1843da62,0x192][iI1IiI(0x1da,'liyQ')](il1li[iI1IiI(0x211,'U54X')])&&invalidTokensMap[iI1IiI(0x1cd,'v%aw')](i1l1Il,!![]),console[iI1IiI(0x20c,'PmdC')](''+i1i11i+i1l1Il+'\x20➜\x20❌\x20签到失败（'+llI11I+'）'),(i1i11l[iI1IiI(0x174,'5l$4')](il1li[iI1IiI(0x229,'KfDP')],'-1')||i1i11l[iI1IiI(0x21c,'2U70')](il1li[iI1IiI(0x160,'gjV8')],-0x1))&&(II11lI=!![]);}}else{if(il1li[iI1IiI(0x193,'3bqq')]){console['log'](''+i1i11i+i1l1Il+iI1IiI(0x226,'ZvP*')+il1li['msg']+'）');if(!signStatusMessages[il1li['code']])II11lI=!![];}else console['log'](''+i1i11i+i1l1Il+iI1IiI(0x21b,'2U70')+JSON[iI1IiI(0x1ab,'U54X')](il1li));}}break;}}catch(Il1i11){console[iI1IiI(0x218,'tP9Z')]('❌\x20未能正确处理\x20'+lill1i+'\x20请求响应\x20'+(Il1i11[iI1IiI(0x239,'hwB@')]||Il1i11));}}async function I1l11I(iii1li){const IIlI1=Ii1ill;if(i1i11l[IIlI1(0x24c,'3bqq')](IIlI1(0x19a,'HWlU'),i1i11l['RgPXp'])){let Iil1i1='',IIii11=null,iliIl1=null,Ii1il1=i1i11l[IIlI1(0x24e,'VVZE')],iii1ll={},IIliI1={};switch(iii1li){case IIlI1(0x24d,'Sp9]'):IIliI1={'appId':i1i11l[IIlI1(0x1b7,'LtYR')],'functionId':i1i11l['ksUZs'],'appid':i1i11l['vLOmk'],'body':{'token':i1l1Il,'venderId':i1i11l['YlawN'](parseInt,llIll)||'','activityId':i1i11l['fFwaJ'](parseInt,il1iII)||'','type':0x38,'actionType':0x7},'version':i1i11l[IIlI1(0x233,'8i8]')],'ua':II11l1},iii1ll=await H5st[IIlI1(0x23c,'B70O')](IIliI1),Iil1i1=i1i11l[IIlI1(0x1f9,'W#QX')],iliIl1=Object[IIlI1(0x256,'FEXj')]({},iii1ll[IIlI1(0x1c9,'T0Bl')],{'jsonp':'jsonp1003'});break;}const il1lI={'t':IlllIl,'loginType':'2','x-api-eid-token':iii1iI};IIii11&&Object[IIlI1(0x192,'hwB@')](IIii11,il1lI);iliIl1&&Object[IIlI1(0x1a4,'WP6A')](iliIl1,il1lI);const IliIIl={'url':Iil1i1,'method':Ii1il1,'headers':{'Accept':i1i11l['IMHbJ'],'Accept-Encoding':IIlI1(0x1e8,'!8Xl'),'Accept-Language':i1i11l[IIlI1(0x222,'pyWH')],'Connection':i1i11l['EXNAb'],'Content-Type':'text/plain','Host':i1i11l[IIlI1(0x1e5,'07DY')],'Referer':i1i11l['luGZQ'],'Sec-Fetch-Dest':i1i11l['eznJH'],'Sec-Fetch-Mode':i1i11l[IIlI1(0x23f,'W#QX')],'Sec-Fetch-Site':IIlI1(0x250,'GN)z'),'User-Agent':II11l1,'Cookie':Iil1lI},'params':iliIl1,'data':IIii11,'timeout':0x7530};i1i11l[IIlI1(0x244,'HWlU')](Ii1il1,i1i11l['CnTGF'])&&(delete IliIIl['data'],delete IliIIl[IIlI1(0x22e,'O]&5')][i1i11l[IIlI1(0x24f,'XxxV')]]);const I1il1l=0x3;let lI1l1l=0x0,IIliII=null,iiliI=![];while(i1i11l[IIlI1(0x248,'liyQ')](lI1l1l,I1il1l)){if(i1i11l[IIlI1(0x1ec,'dsy0')](i1i11l[IIlI1(0x1be,'B70O')],'cwcPm'))l1l11I=!![];else{const I1il1i=await common[IIlI1(0x197,'R)Lb')](IliIIl);if(!I1il1i[IIlI1(0x18f,'8i8]')]){IIliII=''+i1i11i+i1l1Il+IIlI1(0x1cf,'W#QX')+I1il1i[IIlI1(0x148,')4cU')]+IIlI1(0x1db,'!8Xl'),lI1l1l++;continue;}if(!I1il1i[IIlI1(0x1e6,'PmdC')]){if(i1i11l[IIlI1(0x163,'KfDP')]===i1i11l[IIlI1(0x182,'WQDJ')]){IIliII=''+i1i11i+i1l1Il+IIlI1(0x177,')4cU'),lI1l1l++;continue;}else iIII1I(ilil1i),i1i11l[IIlI1(0x157,'ek9&')](IlIIi);}i1i11l['yKheC'](lI1IIi,iii1li,I1il1i['data']),iiliI=![];break;}}i1i11l[IIlI1(0x1d7,'T(Ti')](lI1l1l,I1il1l)&&(console['log'](IIliII),iiliI&&($['outFlag']=!![]));}else{const i1iil=Iillii['split'](':');if(!i1iil[0x0]||!i1iil[0x1]||!i1iil[0x2])return;IlI1iI=i1iil[0x0];if(Iillil[IIlI1(0x253,'07DY')]!==0x20||!/^[A-Z0-9]*$/[IIlI1(0x153,'1CPY')](l1lIli))return;lIIiiI=i1iil[0x1],II1lil=i1iil[0x2],i1iil[0x2]['startsWith'](i1i11l[IIlI1(0x1dc,'HWlU')])&&i1i11l[IIlI1(0x243,'KfDP')](i1iil[0x2][IIlI1(0x246,'#Z#G')],0x8)&&!i1iil[0x1][IIlI1(0x210,'VpAp')](i1i11l['xElfC'])&&(lliil1=i1iil[0x2],IIllI=i1iil[0x1]),lIIii1[IIlI1(0x17c,'gjV8')](ll1i1,{'index':null,'venderId':IIli1i,'shopName':'','activityId':I1iIi1,'startTime':'','endTime':'','isValid':!![],'rules':[],'minLevel':null,'maxLevel':null});}}}async function concMain(llI11l=0x1,I1llIl,i1iii,I1llIi,IIii1I){const i1iIli=ll1I1,llI11i={'uQrXg':function(Iil1iI){return Iil1iI();},'Kkjwy':function(II11il,iIIil1){return II11il<iIIil1;},'jYDNb':function(IlllII,I1il1I){return IlllII>I1il1I;},'JjOrL':'【提示】请先获取Cookie','EolDu':i1iIli(0x1b2,'ZvP*'),'jkITd':function(II111,lI1l1I){return II111(lI1l1I);},'gmiKS':function(lill11,liI1i1,I11i11){return lill11(liI1i1,I11i11);},'ZSaIH':function(I1llII,Iil1il){return I1llII(Iil1il);},'hsfLf':'pt_pin','UAhGo':function(I11i1i,l1l1iI){return I11i1i===l1l1iI;},'pCoal':i1iIli(0x1b0,'GN)z'),'HftMY':function(I1llI1,I11i1l,il1il,Il1i1i){return I1llI1(I11i1l,il1il,Il1i1i);},'yDhrc':i1iIli(0x1f2,'PmdC'),'iRvHV':i1iIli(0x1ff,'3bqq')},i1iIi1=I1llIl[i1iIli(0x1a7,'KfDP')](iIIili=>iIIili),l1l1il=llI11i['ZSaIH'](decodeURIComponent,common[i1iIli(0x1b1,'WP6A')](i1iii,llI11i[i1iIli(0x15e,'VVZE')])),I11i1I=i1iIli(0x1d5,'ZvP*')+I1llIi+'】'+l1l1il+'：',iliIi1=await common[i1iIli(0x249,'R)Lb')](i1iii);if(!iliIi1&&llI11i[i1iIli(0x142,'GN)z')](typeof iliIi1,llI11i[i1iIli(0x18e,')4cU')])){console[i1iIli(0x22d,'v%aw')](I11i1I+'账号无效\x20🚫');return;}const l1l1ii=notify[i1iIli(0x149,'HWlU')](I1llIi,l1l1il),Il1i1I=common[i1iIli(0x1de,'dsy0')](l1l1il),{jsToken:Ii1iii}=await llI11i[i1iIli(0x252,'liyQ')](jsTk,Il1i1I,llI11i[i1iIli(0x1e9,'HWlU')],{'bizId':llI11i[i1iIli(0x1c2,'W0a*')],'v':i1iIli(0x19b,'v%aw'),'qs':'token='+I1llIl[0x0]}),iIIilI={'cookie':i1iii,'index':I1llIi,'title':I11i1I,'UA':Il1i1I,'message':l1l1ii,'jsToken':Ii1iii};let il1l1=0x0;async function Ii1iil(Ii1iiI){const i1iIll=i1iIli;await IIii1I(Ii1iiI,iIIilI),il1l1--,llI11i[i1iIll(0x15c,'1@Xx')](Ilil1i);}async function Ilil1i(){const i1lliI=i1iIli;while(llI11i[i1lliI(0x254,'GN)z')](il1l1,llI11l)&&llI11i[i1lliI(0x1fa,'FEXj')](i1iIi1[i1lliI(0x178,'ek9&')],0x0)){const Ilil1I=i1iIi1[i1lliI(0x1d6,'WP6A')]();il1l1++,await Ii1iil(Ilil1I);}}const iili1=Math['min'](i1iIi1[i1iIli(0x1ba,'1CPY')],llI11l),II11ii=[];for(let iliIiI=0x0;iliIiI<iili1;iliIiI++){if(i1iIli(0x1fd,'#Z#G')===i1iIli(0x161,'Sp9]')){const II11iI=i1iIi1[i1iIli(0x15d,'hwB@')]();il1l1++,II11ii[i1iIli(0x1a8,'T0Bl')](llI11i[i1iIli(0x201,'8i8]')](Ii1iil,II11iI));}else I1iIiI['waitTime']=li1I1;}await Promise[i1iIli(0x1ee,'hwB@')](II11ii),Ilil1i(),await new Promise(Iil1ii=>{const liI1l1=i1iIli,lill1I=llI11i[liI1l1(0x1a3,'v%aw')](setInterval,()=>{const IllIlI=liI1l1,Ii1ii1={'uDumc':llI11i[IllIlI(0x1bb,'ZvP*')]};il1l1===0x0&&(llI11i['EolDu']!==IllIlI(0x1f0,')4cU')?(llI11i[IllIlI(0x1e4,'ioGh')](clearInterval,lill1I),Iil1ii()):(lilIl1[IllIlI(0x198,'TWn6')](i1l1ii[IllIlI(0x1a1,'KR0]')],Ii1ii1[IllIlI(0x1b8,'2U70')]),i1l1['exit'](0x1)));},0x64);});}var version_ = 'jsjiami.com.v7';
// prettier-ignore
function Env(t,e){"undefined"!=typeof process&&JSON.stringify(process.env).indexOf("GITHUB")>-1&&process.exit(0);class s{constructor(t){this.env=t}send(t,e="GET"){t="string"==typeof t?{url:t}:t;let s=this.get;return"POST"===e&&(s=this.post),new Promise((e,i)=>{s.call(this,t,(t,s,r)=>{t?i(t):e(s)})})}get(t){return this.send.call(this.env,t)}post(t){return this.send.call(this.env,t,"POST")}}return new class{constructor(t,e){this.name=t,this.http=new s(this),this.data=null,this.dataFile="box.dat",this.logs=[],this.isMute=!1,this.isNeedRewrite=!1,this.logSeparator="\n",this.startTime=(new Date).getTime(),Object.assign(this,e),this.log("",`🔔${this.name}, 开始!`)}isNode(){return"undefined"!=typeof module&&!!module.exports}isQuanX(){return"undefined"!=typeof $task}isSurge(){return"undefined"!=typeof $httpClient&&"undefined"==typeof $loon}isLoon(){return"undefined"!=typeof $loon}toObj(t,e=null){try{return JSON.parse(t)}catch{return e}}toStr(t,e=null){try{return JSON.stringify(t)}catch{return e}}getjson(t,e){let s=e;const i=this.getdata(t);if(i)try{s=JSON.parse(this.getdata(t))}catch{}return s}setjson(t,e){try{return this.setdata(JSON.stringify(t),e)}catch{return!1}}getScript(t){return new Promise(e=>{this.get({url:t},(t,s,i)=>e(i))})}runScript(t,e){return new Promise(s=>{let i=this.getdata("@chavy_boxjs_userCfgs.httpapi");i=i?i.replace(/\n/g,"").trim():i;let r=this.getdata("@chavy_boxjs_userCfgs.httpapi_timeout");r=r?1*r:20,r=e&&e.timeout?e.timeout:r;const[o,h]=i.split("@"),n={url:`http://${h}/v1/scripting/evaluate`,body:{script_text:t,mock_type:"cron",timeout:r},headers:{"X-Key":o,Accept:"*/*"}};this.post(n,(t,e,i)=>s(i))}).catch(t=>this.logErr(t))}loaddata(){if(!this.isNode())return{};{this.fs=this.fs?this.fs:require("fs"),this.path=this.path?this.path:require("path");const t=this.path.resolve(this.dataFile),e=this.path.resolve(process.cwd(),this.dataFile),s=this.fs.existsSync(t),i=!s&&this.fs.existsSync(e);if(!s&&!i)return{};{const i=s?t:e;try{return JSON.parse(this.fs.readFileSync(i))}catch(t){return{}}}}}writedata(){if(this.isNode()){this.fs=this.fs?this.fs:require("fs"),this.path=this.path?this.path:require("path");const t=this.path.resolve(this.dataFile),e=this.path.resolve(process.cwd(),this.dataFile),s=this.fs.existsSync(t),i=!s&&this.fs.existsSync(e),r=JSON.stringify(this.data);s?this.fs.writeFileSync(t,r):i?this.fs.writeFileSync(e,r):this.fs.writeFileSync(t,r)}}lodash_get(t,e,s){const i=e.replace(/\[(\d+)\]/g,".$1").split(".");let r=t;for(const t of i)if(r=Object(r)[t],void 0===r)return s;return r}lodash_set(t,e,s){return Object(t)!==t?t:(Array.isArray(e)||(e=e.toString().match(/[^.[\]]+/g)||[]),e.slice(0,-1).reduce((t,s,i)=>Object(t[s])===t[s]?t[s]:t[s]=Math.abs(e[i+1])>>0==+e[i+1]?[]:{},t)[e[e.length-1]]=s,t)}getdata(t){let e=this.getval(t);if(/^@/.test(t)){const[,s,i]=/^@(.*?)\.(.*?)$/.exec(t),r=s?this.getval(s):"";if(r)try{const t=JSON.parse(r);e=t?this.lodash_get(t,i,""):e}catch(t){e=""}}return e}setdata(t,e){let s=!1;if(/^@/.test(e)){const[,i,r]=/^@(.*?)\.(.*?)$/.exec(e),o=this.getval(i),h=i?"null"===o?null:o||"{}":"{}";try{const e=JSON.parse(h);this.lodash_set(e,r,t),s=this.setval(JSON.stringify(e),i)}catch(e){const o={};this.lodash_set(o,r,t),s=this.setval(JSON.stringify(o),i)}}else s=this.setval(t,e);return s}getval(t){return this.isSurge()||this.isLoon()?$persistentStore.read(t):this.isQuanX()?$prefs.valueForKey(t):this.isNode()?(this.data=this.loaddata(),this.data[t]):this.data&&this.data[t]||null}setval(t,e){return this.isSurge()||this.isLoon()?$persistentStore.write(t,e):this.isQuanX()?$prefs.setValueForKey(t,e):this.isNode()?(this.data=this.loaddata(),this.data[e]=t,this.writedata(),!0):this.data&&this.data[e]||null}initGotEnv(t){this.got=this.got?this.got:require("got"),this.cktough=this.cktough?this.cktough:require("tough-cookie"),this.ckjar=this.ckjar?this.ckjar:new this.cktough.CookieJar,t&&(t.headers=t.headers?t.headers:{},void 0===t.headers.Cookie&&void 0===t.cookieJar&&(t.cookieJar=this.ckjar))}get(t,e=(()=>{})){t.headers&&(delete t.headers["Content-Type"],delete t.headers["Content-Length"]),this.isSurge()||this.isLoon()?(this.isSurge()&&this.isNeedRewrite&&(t.headers=t.headers||{},Object.assign(t.headers,{"X-Surge-Skip-Scripting":!1})),$httpClient.get(t,(t,s,i)=>{!t&&s&&(s.body=i,s.statusCode=s.status),e(t,s,i)})):this.isQuanX()?(this.isNeedRewrite&&(t.opts=t.opts||{},Object.assign(t.opts,{hints:!1})),$task.fetch(t).then(t=>{const{statusCode:s,statusCode:i,headers:r,body:o}=t;e(null,{status:s,statusCode:i,headers:r,body:o},o)},t=>e(t))):this.isNode()&&(this.initGotEnv(t),this.got(t).on("redirect",(t,e)=>{try{if(t.headers["set-cookie"]){const s=t.headers["set-cookie"].map(this.cktough.Cookie.parse).toString();s&&this.ckjar.setCookieSync(s,null),e.cookieJar=this.ckjar}}catch(t){this.logErr(t)}}).then(t=>{const{statusCode:s,statusCode:i,headers:r,body:o}=t;e(null,{status:s,statusCode:i,headers:r,body:o},o)},t=>{const{message:s,response:i}=t;e(s,i,i&&i.body)}))}post(t,e=(()=>{})){if(t.body&&t.headers&&!t.headers["Content-Type"]&&(t.headers["Content-Type"]="application/x-www-form-urlencoded"),t.headers&&delete t.headers["Content-Length"],this.isSurge()||this.isLoon())this.isSurge()&&this.isNeedRewrite&&(t.headers=t.headers||{},Object.assign(t.headers,{"X-Surge-Skip-Scripting":!1})),$httpClient.post(t,(t,s,i)=>{!t&&s&&(s.body=i,s.statusCode=s.status),e(t,s,i)});else if(this.isQuanX())t.method="POST",this.isNeedRewrite&&(t.opts=t.opts||{},Object.assign(t.opts,{hints:!1})),$task.fetch(t).then(t=>{const{statusCode:s,statusCode:i,headers:r,body:o}=t;e(null,{status:s,statusCode:i,headers:r,body:o},o)},t=>e(t));else if(this.isNode()){this.initGotEnv(t);const{url:s,...i}=t;this.got.post(s,i).then(t=>{const{statusCode:s,statusCode:i,headers:r,body:o}=t;e(null,{status:s,statusCode:i,headers:r,body:o},o)},t=>{const{message:s,response:i}=t;e(s,i,i&&i.body)})}}time(t,e=null){const s=e?new Date(e):new Date;let i={"M+":s.getMonth()+1,"d+":s.getDate(),"H+":s.getHours(),"m+":s.getMinutes(),"s+":s.getSeconds(),"q+":Math.floor((s.getMonth()+3)/3),S:s.getMilliseconds()};/(y+)/.test(t)&&(t=t.replace(RegExp.$1,(s.getFullYear()+"").substr(4-RegExp.$1.length)));for(let e in i)new RegExp("("+e+")").test(t)&&(t=t.replace(RegExp.$1,1==RegExp.$1.length?i[e]:("00"+i[e]).substr((""+i[e]).length)));return t}msg(e=t,s="",i="",r){const o=t=>{if(!t)return t;if("string"==typeof t)return this.isLoon()?t:this.isQuanX()?{"open-url":t}:this.isSurge()?{url:t}:void 0;if("object"==typeof t){if(this.isLoon()){let e=t.openUrl||t.url||t["open-url"],s=t.mediaUrl||t["media-url"];return{openUrl:e,mediaUrl:s}}if(this.isQuanX()){let e=t["open-url"]||t.url||t.openUrl,s=t["media-url"]||t.mediaUrl;return{"open-url":e,"media-url":s}}if(this.isSurge()){let e=t.url||t.openUrl||t["open-url"];return{url:e}}}};if(this.isMute||(this.isSurge()||this.isLoon()?$notification.post(e,s,i,o(r)):this.isQuanX()&&$notify(e,s,i,o(r))),!this.isMuteLog){let t=["","==============📣系统通知📣=============="];t.push(e),s&&t.push(s),i&&t.push(i),console.log(t.join("\n")),this.logs=this.logs.concat(t)}}log(...t){t.length>0&&(this.logs=[...this.logs,...t]),console.log(t.join(this.logSeparator))}logErr(t,e){const s=!this.isSurge()&&!this.isQuanX()&&!this.isLoon();s?this.log("",`❗️${this.name}, 错误!`,t.stack):this.log("",`❗️${this.name}, 错误!`,t)}wait(t){return new Promise(e=>setTimeout(e,t))}done(t={}){const e=(new Date).getTime(),s=(e-this.startTime)/1e3;this.log("",`🔔${this.name}, 结束! 🕛 ${s} 秒`),this.log(),(this.isSurge()||this.isQuanX()||this.isLoon())&&$done(t)}}(t,e)}
