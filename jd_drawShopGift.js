/*
活动名称：店铺关注有礼
活动链接：店铺首页关注按钮
环境变量：jd_drawShopGift_argv // 活动参数，支持格式：”<shopId(店铺id)>_<venderId(店主id)>“ 或 ”<venderId(店主id)>“ 或 ”<活动店铺首页链接>“ 或 ”<shopId(店铺id)>“ 或 ”<venderId(店主id)>
        jd_drawShopGift_threads // 控制并发线程数（正整数），默认1
        jd_drawShopGift_interval // 自定义运行间隔时长（整数，单位毫秒），默认1000
        jd_drawShopGift_notify // 是否推送通知（true/false），默认不推送

高并发脚本，黑号领不到奖品
活动限制IP严重，建议使用代理，谨慎使用并发

cron:1 1 1 1 *

*/

const $ = new Env('店铺关注有礼')
var iｉl='jsjiami.com.v7';const II1il=iii1II;(function(iIiII,iil1lI,iiiliI,li1i1I,illIii,ii1il1,lI1llI){return iIiII=iIiII>>0x7,ii1il1='hs',lI1llI='hs',function(illIil,Ill1I,i11iiI,lIli11,lllI1I){const lIli1I=iii1II;lIli11='tfi',ii1il1=lIli11+ii1il1,lllI1I='up',lI1llI+=lllI1I,ii1il1=i11iiI(ii1il1),lI1llI=i11iiI(lI1llI),i11iiI=0x0;const lillI1=illIil();while(!![]&&--li1i1I+Ill1I){try{lIli11=parseInt(lIli1I(0x1ba,'X3Bk'))/0x1*(parseInt(lIli1I(0x226,'v1c*'))/0x2)+parseInt(lIli1I(0x207,'!ZNy'))/0x3+parseInt(lIli1I(0x152,')u!e'))/0x4+-parseInt(lIli1I(0x1f8,'rL]w'))/0x5*(parseInt(lIli1I(0x1ea,'b7qD'))/0x6)+-parseInt(lIli1I(0x209,')rkp'))/0x7*(-parseInt(lIli1I(0x138,'!mZV'))/0x8)+-parseInt(lIli1I(0x18b,'JOxk'))/0x9*(-parseInt(lIli1I(0x1db,'B$e0'))/0xa)+parseInt(lIli1I(0x239,'vABG'))/0xb*(-parseInt(lIli1I(0x148,'v1c*'))/0xc);}catch(IlIlii){lIli11=i11iiI;}finally{lllI1I=lillI1[ii1il1]();if(iIiII<=li1i1I)i11iiI?illIii?lIli11=lllI1I:illIii=lllI1I:i11iiI=lllI1I;else{if(i11iiI==illIii['replace'](/[EqkAxQUGNHlIMuTLgKJF=]/g,'')){if(lIli11===Ill1I){lillI1['un'+ii1il1](lllI1I);break;}lillI1[lI1llI](lllI1I);}}}}}(iiiliI,iil1lI,function(i1l1i1,liil11,iiillI,l1l111,l1iIII,llI1I1,IlIlil){return liil11='\x73\x70\x6c\x69\x74',i1l1i1=arguments[0x0],i1l1i1=i1l1i1[liil11](''),iiillI='\x72\x65\x76\x65\x72\x73\x65',i1l1i1=i1l1i1[iiillI]('\x76'),l1l111='\x6a\x6f\x69\x6e',(0x160710,i1l1i1[l1l111](''));});}(0x5f80,0x837fe,Iii11l,0xc1),Iii11l)&&(iｉl=0x1b62);function iii1II(_0x1a5435,_0x165d9b){const _0x1daa68=Iii11l();return iii1II=function(_0x537d8f,_0xaac6e){_0x537d8f=_0x537d8f-0x10c;let _0x19278a=_0x1daa68[_0x537d8f];if(iii1II['Qwunzq']===undefined){var _0x247258=function(_0x193bdf){const _0x48572f='abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789+/=';let _0x174866='',_0x59833c='';for(let _0x2a8ad9=0x0,_0x184137,_0x1ccb50,_0x317b66=0x0;_0x1ccb50=_0x193bdf['charAt'](_0x317b66++);~_0x1ccb50&&(_0x184137=_0x2a8ad9%0x4?_0x184137*0x40+_0x1ccb50:_0x1ccb50,_0x2a8ad9++%0x4)?_0x174866+=String['fromCharCode'](0xff&_0x184137>>(-0x2*_0x2a8ad9&0x6)):0x0){_0x1ccb50=_0x48572f['indexOf'](_0x1ccb50);}for(let _0x3fc438=0x0,_0xfa9105=_0x174866['length'];_0x3fc438<_0xfa9105;_0x3fc438++){_0x59833c+='%'+('00'+_0x174866['charCodeAt'](_0x3fc438)['toString'](0x10))['slice'](-0x2);}return decodeURIComponent(_0x59833c);};const _0x198125=function(_0x2e7779,_0x5743e9){let _0x5d4240=[],_0x32575f=0x0,_0x4a5b87,_0x2d9385='';_0x2e7779=_0x247258(_0x2e7779);let _0x61f5c8;for(_0x61f5c8=0x0;_0x61f5c8<0x100;_0x61f5c8++){_0x5d4240[_0x61f5c8]=_0x61f5c8;}for(_0x61f5c8=0x0;_0x61f5c8<0x100;_0x61f5c8++){_0x32575f=(_0x32575f+_0x5d4240[_0x61f5c8]+_0x5743e9['charCodeAt'](_0x61f5c8%_0x5743e9['length']))%0x100,_0x4a5b87=_0x5d4240[_0x61f5c8],_0x5d4240[_0x61f5c8]=_0x5d4240[_0x32575f],_0x5d4240[_0x32575f]=_0x4a5b87;}_0x61f5c8=0x0,_0x32575f=0x0;for(let _0x3f6664=0x0;_0x3f6664<_0x2e7779['length'];_0x3f6664++){_0x61f5c8=(_0x61f5c8+0x1)%0x100,_0x32575f=(_0x32575f+_0x5d4240[_0x61f5c8])%0x100,_0x4a5b87=_0x5d4240[_0x61f5c8],_0x5d4240[_0x61f5c8]=_0x5d4240[_0x32575f],_0x5d4240[_0x32575f]=_0x4a5b87,_0x2d9385+=String['fromCharCode'](_0x2e7779['charCodeAt'](_0x3f6664)^_0x5d4240[(_0x5d4240[_0x61f5c8]+_0x5d4240[_0x32575f])%0x100]);}return _0x2d9385;};iii1II['gylVWg']=_0x198125,_0x1a5435=arguments,iii1II['Qwunzq']=!![];}const _0xa3b09d=_0x1daa68[0x0],_0x46b532=_0x537d8f+_0xa3b09d,_0x58307c=_0x1a5435[_0x46b532];return!_0x58307c?(iii1II['KZIOtv']===undefined&&(iii1II['KZIOtv']=!![]),_0x19278a=iii1II['gylVWg'](_0x19278a,_0xaac6e),_0x1a5435[_0x46b532]=_0x19278a):_0x19278a=_0x58307c,_0x19278a;},iii1II(_0x1a5435,_0x165d9b);}const jdCookie=require(II1il(0x1cb,'UXNs')),notify=require(II1il(0x1d6,'t0Ha')),common=require(II1il(0x112,'!ZNy'));function Iii11l(){const lillII=(function(){return[iｉl,'QqjMHsjAiUaxmkik.LFcuJNoMGmT.GkxvEI7KglT==','bCk6WRusBCk7W4DA','FmoHywldHa','e8oNW67cQLldMq','W5hdOCkpWOpcVq','xv4AWORcIq','sSoBtMldPq','WQGJWOtdGSovuSkH','WPaPy1pcIrpdHG','b8kVbSkYoq','amkXwJxcOsi','DwxcSmooWP5sW5vSBmknW6WMh8kYymkZ','gooaKow5K+MrVEwtVEENJUocRq','WRZdSWbS','eSo3W77cVfVdNSok','DuxdJSkcW6pcQCorWPBcIbTmqSkbuCkGW70','5P6h55+A5RAp5yMB54Mb5OcM','WRzRWQS','gdP2','fhtcTMlcUmkCWQldMSoWWO8','WQHHWR/dJqKZ','WRbosaC/','WQ5CBWCe','WPyYzhdcLWy','W7FdTti0cSkBW6VdIuJcLq','WRRdU8kXrXddUmkFWRJcTsKa','a8k1aSkgaW','sXRdObGx','WOWOzxZcIXxdIfjt','h8kWWRW','mmozW6pcU8kkWQa','W7mJmCoHWOtcN8o4afBdRCkNFmkHpCofAHaIWPJdGmkCfxO','gtrH','omkuBtNcNG','WQSymthcVSkysCo2','WQGJWPpdOmowva','W4fZWQpdLa','mSoyW5lcJSknWQO','W7vSDsxcVa','5yYa6ywD6k6a5PIdW6yAWQC+CmoruSoadGC','W6yXdCk5xxi','aJPVz8oxWOKLxq','d2tdQtyzW45EW7NdLCkj','W4JdS8ktWOZcRSofmmkz','W4PAW4dcOmkFsmk3v3W7cCoeuG','WPahWRFdUmo1','5P67552/5RwL5yUW54Ut5OoT','CCkFW7PhkW','WRZcUCobWPldSSozWRemEColmrFcKrFdHwS','W7u/lCojWRa','WRWslCkVfa','DwxcSmonWRv2','5P64556U5Asg5zgt6Agv5y6P54MC5OktgW','W7BcVqf5WRjlW6KSh8kjdCkyx0NdTmkWy8kezu3cImovW40mW6FcM8op','eZj+','bmkTfSkXj8oJW7tdSZJdLe9pWPK','W5XcWORdO8kA','WPCOy2xcLKJcJHTlWPtdH8kdWP/cHCoyWRWPW4lcUv1BeH1Tc21QWPRcVSojWPFdPSkrW5q','W6RdRmoeWPhdMCoxWQ0G','ySkuomo8W48','WQhcSSoeWP3dRW','WPHDuZu8','luKx','dSk6xrNcVtRcHCoYveVdGSkUWOv5W7DH','WOb8WPiDua','WPK1BW','z8kcl8oPW4RdGNK','W7feW6pdUSoFWRNdI8kj','gxJcPq','W51fW53dVSo7','WRKpWPtdPSoF','CSoYWOpdSSkJ','5y2O5yEL5BMQ6zcs5AE66lAs','W7FdSa82WQzQrG','W57cV8oGc28','W5XozXucbSoB','iSksW4PYWRS','yxxcQCoMWOH0vCoulmodCSk6W7GfW6BdV3xcMhjkqCoM','lCkgW4bDWOO','W75fW6ZdUSofWQRdI8kE','owmowHu','k8oiW5NcU8ooWQ/cHbFcKbK','WQyBW77dNmo1WQZdM8kV','lqSHWQC7WOG','ACkiW4XccmkTWPT5','WPKWEhRcLW','B3dcGSoJ','WQ0Uj3pdUaKOWRTeWOLPBSkL','ESogAwa','W7ykWOzOW6y','DCo2WQddM8k+','W592xSk1W4BdJG','WPGVkW','xcfL','BdqcWOiMtSkGW5RcVSoJWOqlgmkMWPijW6WgW7tcVa','WRf1WPCvxhC','xmkslLZdQW','qSoiWQFdPCke','W4n9WQK','WPKPWO7dOCoFtSkXW6pcQ8kibNW','4PM6zUIeIUwSJ+s7S+I/SoIIIEMuUUMzQ+AuH+MuIEIUP+E+JEMwM+ITUW','8jguGU+5Lq','n8oFWPSEsmo8WRvOWPtcHH/dGa','W53dUCktWPZcRSozdq','WP4LW7VdGmkNW5WPA8kv','CXldLZax','W7fcW7C'].concat((function(){return['bg7cL2lcMa','W7veW6ddUSovWQ/dGa','bSk8g8kKb8oVW5RdUq','xCogAxhdStFdKmkUi8kZW6RcKG','zSkpW5C','6lwh5y215Pw95PAx','5BI66zof5z6e5z6Z77+Tt8kZz2K8uSkceConsKnFW4VcGMfjWRzOW5HvqW3dUSkCcmkCWPBcJYVcHa','uLKUWPdcSW','uSk3bvBdM8o0bJv9WQRdGKpcPY4LdmkjWQ/dNSoB','cCoRBqtcMmkLrtfdWPddH1BcLW','d2lcLLRcHG','lCo7W6FcNM8','WPmZCa','ifRcTLpcTW','DtGYWPyltSkNW7NcICoKWPSHfmkFWPe/W6SmW6/cRMFdTuWaW4K2WPGF6iA55A6o5lMe6l6A6kkT6zEr6zM45PA46zsX77636BQZ6k+KgSo9eM8','gw/cGuFcIa','W40GWPH9W47cOW','WRZcVCo8WR3dPG','w0pcJ8owWOi','W4HTW43cPmky','ECkpm8oQW6ldGq','4PM4WRlOROpLOABLHylMOjVLVPxMRAdNOkpNMAJNJ4dLOB7LJ6VPH7u','j8k/v8kiWOO','BtKEWOCvwW','dMuHzba','WRT3AGe+','rSoNWR8LEmkIW6PD','cbCrWOaS','k+obM+w4LoMsQowDQUwFOEoaOmo6W4JcMmo7W7lcVwldL8kYumkrAIyhwCokWO/cJMXvi8okwG8jW6qEa8oJWQa','kCkvW5z5WRlcUxC+W542WQSjW78QW4pdJYCoumoIxIRcRW','FqTLWOrK','WR8RWPddOCod','pXLqymov','DuxdJSkyW6tcOSow','W7FdSYy','W6KXbmkFtNq','vSohWRVdHG','W7WPga','bSkIW4nPWOW','rHigWRep','WR/cRSouWQZdJ8oDWRCsw8oHoa0','WP17qGasn8obka','uJ/dStS0W4zyW7tdHq','bY5OvSoTWOq','CmkscmolW6m','D8oeWPqsW6ldPZydW588WRSHW4S','W6SUgSorxgJdUmkd','WRddSbiLWOq','WP0qa8kJeq','hwX5','yexdM8k5W5RcQSokWPW','tstdPa','W7VcQ8o1bKxdQG','W7G7gCkjq3q','qvS3WOFcTCoHW5zb','dCoTW7O','W5K5mmkozG','W6/cP8o+','W4TvzGxcUq','hSkObSkwp8oNW5a','WOHuWQeUEG','5Rw15yMy5lQV5A2Y5z+Y5OUa5BE16AoW6l22','zuBdK8kpW68','W7K8nSotWRi','rviXWOpcQmoS','D8khW4zA','WRHKEG','W4HOBJRcOq','n27cHMBcNa','j08i','lSojW5PAfmkLWO0LWQVcMGRdQSkpdX3dTWZcLJ3dKGqIW7m','y8oytq','8l2jPCkM','W4z8WR3dLmksW7S','WOuPq0tcRq','WPeet0FcJW','WOG9FMhcSrVdJfe','bSoNW6NcLLddGCoqW7tcNw3cHxLBWQVcHXe','FtmcWP4CtSk+','bCkBW6VcNSokWOWnW5VcISoM','tCoOx8kFhq','W4LTrSoboa','WOyLpCkzj8oEcq','D8oFCCktkG','zgxcQSoJWPvmW7vM','W5ddT8kqWO0','5P6h55+A5AEI5zcY6AgX5y+X54MX5Ocsoq','kW8HWP40','bc5JyCo6WRm8sHdcJmoHAmkqWOH5t8kUECop','WQBdHqOXWPG','W5iFgSk4qW','tsNdQWO7','WRCzadhcQCklD8obW6xcNcxdV8oQWOhcMCk9rmowg1hcP8oAWPpcK13cMUAAVEwqUEMcPEEDJI9oW6u/WOnJW7pdVaVcJSo/WORVV5JPU47OR6ZKURZMJiFPG6S','WQRcImoKWQNdUG','zCkiW5K','qKNcGmosWRK','W71mDJNcRW','sSoRW61ommo4WR9lD3XVrc4','W5LVEG3cHq','D8ohDgddPI0','WQr/WPCswhhdNMm','W64Mb8oXWQlcL8oInG','W50NWPLUW6BcSW','W507WOr3W4hcSmkzhWG','Ag7cTCobWOm','WRaPWONdUW','a8kQWQGE','st/dTYiPWPSEWR0'].concat((function(){return['WO0wjmkHA8keW4BdOCkxW5yc','dCoNW7pcUeRdHq','W7LyW6hcHCkJ','WR3dSczzWO0','6i2Q5y6R5RwK5yU95lY65Okf5AsX6lA3','CSkbW6jiea','ACoiBNe','z8k0cmouW6y','wmoUhx4','5lIF56Yg5zkY5BMC6zg36k275AYI5yY65lUJ5lUI576h','W57dUWKqkq','4PMYoUISJUwGNEwgPoAGV+w+MoATPoEGGoEAS+EpRUwHHEwmSUMfNq','jCogW7xcJhK','W7JcUSoWiwG','FK/dNq','WRdcUComWQG','qCoRWOWHrmkVW6vV','gSo5W5/cUmkA','W59mBW','rmoLfSkdi8oTW5pdVW','FdmjWPC','WRtdVrm','WP7dOqvRWQS','4PY5E+IeNoACV+I9K+IIRoMaJ+wiIos7V+MxU+ITQty','j8kYWQNdRWW','FtPhWOPq','WPWhWOpdHCogf8oZre8AhCo/zW','WRyPWOC','zSoczSkTkW','bNBcR27dO8kAWQtdISoEWOlcNW','f8kGW7rtWP0','WResoa','WP5OxHe','qd1fWPzX','qc9WWPrTgCoaW4SihKCEphldVCkZtW','W6W3eG','WR8Xc8oRWPlcM8o9gLRcVW','dmoVW6xcOSkO','WRFcS8os','heFcJutcNq','yoITMUAZVUwNUUI3HSoU4P20xUAuHUwsSEw6QUAuUEAoUa','CSogya','iCozW4ZcRCkS','amk2c8kebq','WQKUWO/dPCoZra','h8k6rZtcTItcPCo4','W5TAW5RcL8ksvCkoDW','WQfYWPygyMldP3CXxY7cQ8kpW40nqCk2WP4','W5ldUCkA','j8oiW4JcMmklWQhcMdRcGWHFimk6','6lAF5y+s5PE35PEF','BCobAhxdNt0','mCkEFG','qZPWWO5Mk8oBW4eH','DCoqr8kNcxDdW7RcLCoLj8klb8kdW7ldPHK','WQFdJtS','5PYA556R5Awu5zcM6Ako5y6A54Ie5OkM','WPasWRxdHmoU','yCktW5LLea','W4ayl8kXyG','W7OOcSoG','WOz1ta','ASkcW7bkd8kOWOLzWPhcKbJdImkkgJBdGGNcPZxdIuLIWRlcKUA3U+wjM+wmUUAxLq','lcy3rqOr','8yU6SCoz','FdmdWPeywW','pCkyW41AWPpcSG','oaSMWPGsWR8','ggXTW5eJaqSFW4S','omkvW4XoWR/cPe4s','b8oOW6G','5BI66zof5lQ55A6R5z+F','ibtdRCkCW4hcO8otWQK','qCoVW6S','WO1/xYCVoCoc','iw7cG2/cVG','eN7cTgzJW4D6W5pdRSkBW7m','WR1HWRJdSqSRkSozsmo/hqVdMCk1W6b9','W6iQhSkmxdRcUmoCuWGyWP5zWPxcSqbbztronSkEW4ddMSksdSo6WO0wW6CNW5pcMCkC','WRfTWQmfwG','W5GQWPH6W4RcPCk5hq','B8kFnCoU','W4z+DYhcHG','EhbQh11DWONcN8oyWPHQbhC','6i6O5y6k5Rww5yMA5l6y5Oga5AEH6lAp','z2NcTCooWRW','dSkMWRiLWQNcQNBdL8oo','CSorreNdKG','WRJcRSoqWRRdQmoq','4P28BUACQoECGUIVV+AWJSks','Cw/cTSo0','5P2Q552i5AEQ5zck6AgL5yYy54ME5Og/','WOy1iSkPlmoj','BSkvpCoTW7JdJxpcMCo7WRNdTgS','qI9SWOnNiq','w8k8nfhdVCo0aG0','W4L+WQhdNSks','W5FdPCkUWP3cQmouhmkobq','jICQqXKr','wqGIWRyF','W74KnW','iXFcJ8k6W4RcLSoCWRxcNq','W70MgSoK','w3BcMSoXWP8','WRrZWOe','paS7WOKBWRNcNam'];}()));}()));}());Iii11l=function(){return lillII;};return Iii11l();};console[II1il(0x153,'f&yg')](''),console[II1il(0x19c,'sOQ2')](II1il(0x11b,'Ju47')+$[II1il(0x121,'RFCN')]+II1il(0x1c8,'t0Ha')),console[II1il(0x146,'b]BE')](II1il(0x176,'!ZNy')),console[II1il(0x23f,'UXNs')]('jd_drawShopGift_threads\x20//\x20控制并发线程数，默认1'),console[II1il(0x14d,'t0Ha')](II1il(0x21a,'KZ@&')),console[II1il(0x175,'YCtJ')](II1il(0x128,'etIz')),console[II1il(0x203,')rkp')]('=========='+$[II1il(0x1c5,')rkp')]+'提示结束=========='),console[II1il(0x168,'RFCN')]('');const activityArgv=process['env'][II1il(0x214,'Kv8T')]||'';let taskThreads=process['env'][II1il(0x1c0,'5KdA')]||'1';const runInterval=process[II1il(0x12a,'!ZNy')]['jd_drawShopGift_interval']||'1000',isNotify=(process[II1il(0x231,'5KdA')]['jd_drawShopGift_notify']||process['env'][II1il(0x1ee,'3Cs!')])===II1il(0x158,'YCtJ'),cookiesArr=Object[II1il(0x147,'B$e0')](jdCookie)[II1il(0x1b3,'(OHd')](IllI1I=>jdCookie[IllI1I])['filter'](liIii=>liIii);!cookiesArr[0x0]&&($['msg']($['name'],'【提示】请先获取Cookie'),process[II1il(0x189,'(vIz')](0x1));!(async()=>{const lllI11=II1il,II1ll1={'OyQKt':lllI11(0x1e9,'RFCN'),'XApDl':function(IlI1Ii){return IlI1Ii();},'mSTNM':lllI11(0x173,'zacP')};notify['config']({'title':$[lllI11(0x230,'Ju47')]}),await II1ll1[lllI11(0x126,'zacP')](Main);if(isNotify&&notify['getMessage']()){if(II1ll1[lllI11(0x13f,'(vIz')]===II1ll1['mSTNM'])await notify[lllI11(0x136,'v1c*')]();else{II1liI[lllI11(0x1a0,'acMA')](II1ll1['OyQKt']),IlI1i1[lllI11(0x1c1,'(OHd')](l1lIl1[lllI11(0x1d1,'B$e0')]());return;}}})()['catch'](l1il1i=>$[II1il(0x1c9,'zacP')](l1il1i))['finally'](()=>$[II1il(0x1f9,'*Ri&')]());async function Main(){const I1lIll=II1il,ll1={'gaIfz':'⚠\x20自定义运行间隔时长设置错误','PIDUI':I1lIll(0x211,'!J$c'),'TyAdp':I1lIll(0x20f,'*Ri&'),'ZTcsy':function(iI1llI,llliii){return iI1llI>llliii;},'lxCLF':function(IllI11,l1llIi){return IllI11!==l1llIi;},'OvQeb':I1lIll(0x193,'Ic5x'),'kwfAa':'⚠\x20请先定义必要的环境变量后再运行脚本','bTbsa':I1lIll(0x137,'UXNs'),'pHQVk':function(II1llI,i11I11){return II1llI===i11I11;},'ByDmR':function(l1llIl,ii1I1l){return l1llIl===ii1I1l;},'lbhXa':I1lIll(0x201,'Kv8T'),'JTUQT':I1lIll(0x143,'acMA'),'qyUiV':'EXIej','TMrOw':I1lIll(0x11c,'Kpz4'),'mqsKa':function(ii1I1i,llI){return ii1I1i&&llI;},'zpGaR':'bHfgP','vJXvz':'店铺不存在','DFDsB':function(llliI,iI1li1){return llliI+iI1li1;},'ZnbWV':'pCAWN','Rfkkm':function(lllii1,liIli){return lllii1(liIli);},'CZPrH':function(liIll,IilIi1){return liIll>IilIi1;},'qTQrf':I1lIll(0x117,'[@Sq'),'rgMfm':function(iI1liI,l1lIiI){return iI1liI!==l1lIiI;},'THLSj':I1lIll(0x1ef,'vABG'),'iHGJT':I1lIll(0x18a,'rL]w')};try{if(!activityArgv){console['log'](ll1[I1lIll(0x24b,'sOQ2')]);return;}try{if(activityArgv[I1lIll(0x1f0,'a4no')](ll1[I1lIll(0x12c,'rL]w')])){const {shopId:IiI11,venderId:lli,vendorId:liIlI}=common[I1lIll(0x15a,'[k1P')](activityArgv);$['shopId']=IiI11,$[I1lIll(0x166,')u!e')]=lli||liIlI;}else{const lll=activityArgv['split']('_');ll1[I1lIll(0x11d,'!mZV')](lll[I1lIll(0x139,'!J$c')],0x2)?($['shopId']=lll[0x0],$[I1lIll(0x130,'acMA')]=lll[0x1]):$[I1lIll(0x1cc,'RFCN')]=lll[0x0];}}catch{if(ll1[I1lIll(0x227,'&5S(')](ll1[I1lIll(0x127,'UXNs')],ll1[I1lIll(0x1ed,'vABG')])){console['log'](ll1[I1lIll(0x171,'f&yg')]);return;}else I1llii['log'](ll1[I1lIll(0x21d,'B$e0')]);}finally{if(!$['venderId']&&!$[I1lIll(0x164,'f&yg')]){if(ll1[I1lIll(0x18f,'*Ri&')](ll1[I1lIll(0x20c,'XA(X')],ll1[I1lIll(0x1d0,'!ZNy')])){I1iIli[I1lIll(0x16f,'b7qD')](ll1[I1lIll(0x12b,'&03T')]),lI1Ill[I1lIll(0x1e5,'XA(X')](lI1Ili[I1lIll(0x1ac,'&03T')]());return;}else{console[I1lIll(0x23d,'mjRT')](ll1[I1lIll(0x1e8,'Ju47')]);return;}}}let llliiI;if($['venderId']&&!$[I1lIll(0x16b,'*Ri&')]){let iI1lii={'venderId':''[I1lIll(0x177,'JOxk')]($['venderId']||'')};for(let IilIii=0x0;IilIii<0x2;IilIii++){if(ll1[I1lIll(0x18d,'3Cs!')]('zMmhw',ll1[I1lIll(0x246,'rL]w')])){llliiI=await common[I1lIll(0x1cd,')u!e')](iI1lii);const {shopName:iI1lil,shopId:l1lIi1,venderId:iIli1l}=llliiI?.['shopBaseInfo'];if(ll1['mqsKa'](iI1lil,l1lIi1)&&iIli1l)break;iI1lii={'shopId':''[I1lIll(0x22f,'zacP')]($[I1lIll(0x165,'B%**')]||'')},llliiI={};}else lIIiil=l1lIii[I1lIll(0x1b5,'zd7D')];}}else ll1[I1lIll(0x110,'XA(X')](I1lIll(0x1a3,'*Ri&'),ll1['zpGaR'])?llliiI=await common[I1lIll(0x169,'Ic5x')]({'venderId':''['concat']($[I1lIll(0x188,'@fIB')]||''),'shopId':''[I1lIll(0x179,'KZ@&')]($['shopId']||'')}):(delete lIIiiI[I1lIll(0x19e,'5KdA')],delete II1lil['headers'][ll1[I1lIll(0x183,'XA(X')]]);const {shopName:IilIiI,shopId:i1i1I1,venderId:IlII1}=llliiI?.['shopBaseInfo'];if(!i1i1I1||!IlII1){console[I1lIll(0x1fd,'ue6p')](ll1['vJXvz']);return;}$[I1lIll(0x17a,'vABG')]=i1i1I1,$[I1lIll(0x17d,'vABG')]=IlII1,console[I1lIll(0x14d,'t0Ha')]((IilIiI&&'店铺名称：#'+IilIiI+'\x0a')+I1lIll(0x212,')u!e')+$['shopId']+'&venderId='+$[I1lIll(0x1a2,'v1c*')]+'\x0a'),notify[I1lIll(0x1d8,'arHI')](ll1[I1lIll(0x1b7,'YCtJ')](notify[I1lIll(0x208,'RFCN')],(IilIiI&&I1lIll(0x1ad,'&03T')+IilIiI)+I1lIll(0x228,'UXNs')+$['shopId']+I1lIll(0x15c,'5KdA')+$[I1lIll(0x1c3,'etIz')]));try{if(ll1[I1lIll(0x1d2,'5KdA')](I1lIll(0x1fb,'Ju47'),ll1['ZnbWV'])){const iil1iI=ll1[I1lIll(0x1e1,'acMA')](parseInt,taskThreads);ll1['CZPrH'](iil1iI,0x0)&&ll1['lxCLF'](iil1iI,0x1)&&(taskThreads=iil1iI);}else{lIIilI[I1lIll(0x245,'X3Bk')](I1lIll(0x249,'vABG')),II1li1[I1lIll(0x146,'b]BE')](l1lIlI['getInlineContent']());return;}}catch{if(ll1[I1lIll(0x222,'!QCF')](ll1[I1lIll(0x129,'B$e0')],ll1[I1lIll(0x23b,'b7qD')]))taskThreads=0x1;else{const lI1li1=i1ilil(lilIii);ll1[I1lIll(0x1b6,'YCtJ')](lI1li1,0x0)&&ll1[I1lIll(0x21b,'XA(X')](lI1li1,0x1)&&(iIIl1l=lI1li1);}}$[I1lIll(0x235,'YCtJ')]=null;if(runInterval)try{const iI11II=parseInt(runInterval);ll1[I1lIll(0x149,'Ic5x')](iI11II,0x0)&&($['waitTime']=iI11II);}catch{ll1[I1lIll(0x13d,'!ZNy')](ll1['THLSj'],ll1['iHGJT'])?console[I1lIll(0x1be,'v1c*')](ll1[I1lIll(0x125,'b7qD')]):(ilI1lI[I1lIll(0x161,'*Ri&')](I1lIll(0x1d5,'sOQ2')+IiiIll[I1lIll(0x133,'@fIB')](IIlii[I1lIll(0x223,'KZ@&')])),IlI1il['fix'](ll1['OvQeb']));}await common[I1lIll(0x197,'Kv8T')](taskThreads,cookiesArr,taskFnc);}catch(ilil1i){console['log'](I1lIll(0x14f,'(OHd')+ilil1i);}}async function taskFnc(IlIIi,IiI1l){const I1lIli=II1il,illlII={'zuTQH':I1lIli(0x229,'vABG'),'qJoRF':function(iIII1l,lllil){return iIII1l===lllil;},'YWBRT':I1lIli(0x22a,'[k1P'),'rKOHN':I1lIli(0x248,'acMA'),'tokHB':I1lIli(0x1b1,')u!e'),'cItse':'drawShopGift','znqFs':function(iI11Il,iIII1i){return iI11Il===iIII1i;},'EENoA':I1lIli(0x1fc,'5KdA'),'WEusV':I1lIli(0x181,'v1c*'),'UMtXy':I1lIli(0x156,'vABG'),'cwZsg':'402','jtaor':I1lIli(0x18e,'fl!J'),'dcpcR':I1lIli(0x141,'b]BE'),'MtEmX':I1lIli(0x1e6,'a4no'),'TrIgq':I1lIli(0x217,'!J$c'),'SgZrI':I1lIli(0x170,'[k1P'),'JOzUE':I1lIli(0x150,'!J$c'),'iPOOS':function(iil1i1,il1i11){return iil1i1||il1i11;},'Wpzpo':function(IlIll1,IlIII){return IlIll1(IlIII);},'XEpvI':function(ilil1l,illlIi){return ilil1l>illlIi;},'JBVsV':I1lIli(0x205,'f&yg'),'vrtbj':I1lIli(0x19b,'KZ@&'),'RuPtq':I1lIli(0x162,'Ic5x'),'sPDRz':'POST','owrkv':I1lIli(0x167,'acMA'),'qtvRA':I1lIli(0x1da,'[@Sq'),'DDhSG':'gzip,\x20deflate,\x20br','DITnA':'zh-Hans-CN;q=1,\x20en-CN;q=0.9,\x20zh-Hant-CN;q=0.8','rGxAz':'application/x-www-form-urlencoded','zAfhr':I1lIli(0x155,'XA(X'),'eRyWo':I1lIli(0x17c,'mjRT'),'QmAux':I1lIli(0x17e,'Ic5x'),'eCGHE':I1lIli(0x204,'f&yg'),'kdDyh':I1lIli(0x1eb,'X3Bk'),'jQcJM':function(I1lIii,IiI1I){return I1lIii!==IiI1I;},'rCaQD':I1lIli(0x21e,'3Cs!'),'rQcKu':function(illlIl,i11ill,IIIIIi){return illlIl(i11ill,IIIIIi);},'qkyTV':function(IIIIIl,I1lIil){return IIIIIl!==I1lIil;},'rhpVP':'csSyG','RYTbM':I1lIli(0x1bf,'Ic5x'),'hsdfd':I1lIli(0x16a,'!mZV'),'LBYiK':function(IIIl1i,liiII1){return IIIl1i+liiII1;},'GBYVg':function(IIIl1l,lllll){return IIIl1l-lllll;},'QKDiM':function(i11ili,iil1l1){return i11ili+iil1l1;},'ycNjE':function(lllli,iiili1){return lllli+iiili1;},'YNkCv':function(ill11i,lllill){return ill11i*lllill;},'wfiDb':'jYnQI','aatsJ':I1lIli(0x13c,'etIz'),'psGqy':function(ill11l,I1lIiI){return ill11l!==I1lIiI;},'auvKm':'dkiaS','OaWHL':'HYHqD','TgUvT':'活动不存在或已领过','ebRTV':I1lIli(0x1ce,'f&yg'),'OITcG':I1lIli(0x19f,'3Cs!'),'NlLOp':'取关店铺失败','rnDGF':I1lIli(0x232,'vABG')};if($[I1lIli(0x1c6,'Ic5x')])return{'runEnd':!![]};const iIII11=decodeURIComponent(common['getCookieValue'](IlIIi,illlII[I1lIli(0x20a,'UXNs')])),IiI1i=notify[I1lIli(0x190,'B$e0')](IiI1l,iIII11),llll1=await common['getLoginStatus'](IlIIi);if(!llll1&&typeof llll1===I1lIli(0x11a,'KZ@&')){IiI1i[I1lIli(0x113,'Kpz4')](illlII[I1lIli(0x1dc,'(vIz')]),console['log'](IiI1i['getInlineContent']());return;}const lil11l=common['genUA'](iIII11),i1i1Il=illlII[I1lIli(0x15d,'Ic5x')]('30.',Math[I1lIli(0x198,')rkp')](Math[I1lIli(0x196,'[k1P')]()*illlII['GBYVg'](0x2710,0x1869f)))+0x1869f,I1lIl1=illlII[I1lIli(0x1c2,'B%**')](illlII['ycNjE'](I1lIli(0x140,'B%**'),Math[I1lIli(0x1f6,'[@Sq')](illlII[I1lIli(0x233,'KZ@&')](Math['random'](),0x2710-0x1869f))),0x1869f),lil11i=common[I1lIli(0x1f4,'&5S(')](iIII11),IlIIl=common[I1lIli(0x1d4,'&03T')]();let lI1liI='',i1i1Ii='';await iI11Ii(illlII[I1lIli(0x216,'XA(X')]);if(!i1i1Ii){if(illlII['wfiDb']===illlII[I1lIli(0x24a,'b]BE')]){IiI1i[I1lIli(0x1e2,'[@Sq')](illlII[I1lIli(0x123,'&5S(')]),console[I1lIli(0x1b2,'zd7D')](IiI1i[I1lIli(0x1b0,'b]BE')]());return;}else{IiilI1['log']('⚠\x20请先定义必要的环境变量后再运行脚本');return;}}if($['runEnd'])return{'runEnd':!![]};lI1liI=i1i1Ii?.[I1lIli(0x1b4,'XA(X')];if(!lI1liI){if(illlII[I1lIli(0x159,'[k1P')](illlII[I1lIli(0x172,'!ZNy')],illlII[I1lIli(0x142,'#suj')])){IiI1i[I1lIli(0x14a,'!mZV')](illlII[I1lIli(0x13a,')u!e')]),console[I1lIli(0x1fe,'[k1P')](IiI1i['getInlineContent']());return;}else i1illi[I1lIli(0x131,'5KdA')]=i1illl;}if(i1i1Ii[I1lIli(0x1e4,'a4no')]){const Ill11=await common[I1lIli(0x1b9,'#suj')](![],$[I1lIli(0x132,'@fIB')],IlIIi);if(!Ill11&&typeof Ill11===I1lIli(0x20d,'a4no')){if(illlII[I1lIli(0x13b,'t0Ha')]===illlII['OITcG'])ll1l1[I1lIli(0x1a9,'[@Sq')]=!![];else{IiI1i[I1lIli(0x113,'Kpz4')](illlII['NlLOp']),console['log'](IiI1i[I1lIli(0x1ac,'&03T')]());return;}}}if($[I1lIli(0x20e,'arHI')])$[I1lIli(0x13e,'*Ri&')]($[I1lIli(0x118,'[@Sq')]);await iI11Ii(I1lIli(0x234,'B$e0'));if($[I1lIli(0x194,'ue6p')]){if(I1lIli(0x1d3,'ue6p')!==illlII[I1lIli(0x11f,'Kpz4')]){l1l1I1[I1lIli(0x15b,'zacP')](I1lIli(0x18c,'KZ@&')),I1iIll[I1lIli(0x1b2,'zd7D')](I1lliI[I1lIli(0x1e0,'B%**')]());return;}else return console[I1lIli(0x218,'[@Sq')](IiI1i[I1lIli(0x119,'!J$c')]()),{'runEnd':!![]};}if($[I1lIli(0x131,'5KdA')])$[I1lIli(0x10d,'!ZNy')]($[I1lIli(0x242,'69G8')]);console[I1lIli(0x23d,'mjRT')](IiI1i[I1lIli(0x185,'zd7D')]());function lllii(iI11I1,il1i1l){const II1ii=I1lIli;try{switch(iI11I1){case illlII['zuTQH']:if(il1i1l[II1ii(0x14c,'KZ@&')]==='0'&&il1i1l[II1ii(0x199,'RFCN')]&&il1i1l[II1ii(0x1c4,'f&yg')]){if(illlII['qJoRF'](II1ii(0x14e,'t0Ha'),illlII['YWBRT'])){iIIII1[II1ii(0x161,'*Ri&')](II1ii(0x17f,')u!e'));return;}else i1i1Ii=il1i1l['result'];}else illlII['rKOHN']===illlII['rKOHN']?IiI1i[II1ii(0x16c,'!QCF')](illlII['tokHB']):lI1Iil['venderId']=lilIiI[0x0];break;case illlII[II1ii(0x1e7,'f&yg')]:if(illlII[II1ii(0x134,'&03T')](il1i1l[II1ii(0x174,'5KdA')],'0')&&il1i1l['isSuccess']&&il1i1l[II1ii(0x241,'zacP')]){const {followCode:iil1ii,followDesc:IlIlli,giftCode:il1i1i,giftDesc:lil111,alreadyReceivedGifts:i11ilI}=il1i1l[II1ii(0x240,'X3Bk')];switch(iil1ii){case illlII[II1ii(0x224,'M15%')]:switch(il1i1i){case illlII['WEusV']:for(const ii1ii1 of i11ilI){if(illlII['znqFs'](illlII[II1ii(0x219,'XA(X')],'VPGWb')){i1l1li['log'](II1ii(0x221,'t0Ha'));return;}else{let lllil1=[ii1ii1?.[II1ii(0x1a8,'f&yg')],ii1ii1?.[II1ii(0x23e,'b]BE')]][II1ii(0x135,'f&yg')]('');switch(ii1ii1?.['prizeType']){case 0x1:case 0x2:case 0x3:IiI1i[II1ii(0x1b8,'[@Sq')](lllil1+II1ii(0x206,'Kv8T'));break;case 0x4:IiI1i[II1ii(0x115,')rkp')](lllil1+'🐶');break;case 0x6:IiI1i[II1ii(0x1ab,'B%**')](lllil1+'🎟️');break;default:IiI1i[II1ii(0x12f,'*Ri&')](lllil1);break;}}}break;case illlII[II1ii(0x187,'acMA')]:console[II1ii(0x111,'M15%')](lil111);for(let iil1il of['抢完']){if(lil111[II1ii(0x1f5,'!ZNy')](iil1il)){$[II1ii(0x237,'(OHd')]=!![],IiI1i[II1ii(0x19a,'JOxk')](lil111);break;}}break;case illlII[II1ii(0x1c7,'rL]w')]:IiI1i[II1ii(0x20b,'a4no')](illlII[II1ii(0x213,'69G8')]);break;default:!i11ilI?illlII[II1ii(0x202,'Ju47')](illlII[II1ii(0x151,'[k1P')],illlII[II1ii(0x1a7,'*Ri&')])?I1lllI=ill111:IiI1i[II1ii(0x113,'Kpz4')]('参与活动成功但未领取到奖品（'+il1i1i+'）'):(console[II1ii(0x1fe,'[k1P')](II1ii(0x122,')u!e')+JSON[II1ii(0x1bd,'[@Sq')](il1i1l[II1ii(0x1a4,'!J$c')])),IiI1i[II1ii(0x210,'!ZNy')](illlII['SgZrI']));break;}break;case illlII['JOzUE']:IiI1i['fix'](IlIlli);break;default:console['log']('未知活动状态\x20'+JSON[II1ii(0x16d,'[k1P')](il1i1l[II1ii(0x17b,'&5S(')])),IiI1i[II1ii(0x1d7,'(OHd')](illlII['tokHB']);}}else console[II1ii(0x19c,'sOQ2')]('❓'+iI11I1+'\x20'+JSON[II1ii(0x236,'UXNs')](il1i1l)),IiI1i[II1ii(0x22e,'#suj')](illlII[II1ii(0x244,'zacP')]);break;}}catch(i11il1){console[II1ii(0x243,'!J$c')]('❌\x20未能正确处理\x20'+iI11I1+'\x20请求响应\x20'+(i11il1[II1ii(0x1e3,'(vIz')]||i11il1));}}async function iI11Ii(ii1iiI){const IIIIII=I1lIli;if(illlII[IIIIII(0x1aa,'arHI')]===illlII['RuPtq']){const {shopId:ilil11,venderId:illlI1,vendorId:IIIl11}=II11Ii[IIIIII(0x16e,'Kpz4')](II11Il);IlI11[IIIIII(0x220,'(vIz')]=ilil11,iIIIIl[IIIIII(0x120,'&03T')]=illlII[IIIIII(0x23c,'ue6p')](illlI1,IIIl11);}else{if($['runEnd'])return;let I1lIi1='',liiIIi=null,lil11I=null,Iliii1=illlII[IIIIII(0x1d9,')rkp')],iIiIi={};switch(ii1iiI){case illlII[IIIIII(0x238,'(vIz')]:I1lIi1=IIIIII(0x186,'zacP'),iIiIi={'shopId':''['concat']($[IIIIII(0x10c,'69G8')]||''),'source':IIIIII(0x23a,'zacP'),'displayWidth':'1218.000000','sourceRpc':illlII[IIIIII(0x1a5,'RFCN')],'lng':I1lIl1,'lat':i1i1Il,'venderId':''[IIIIII(0x200,'acMA')]($['venderId']||'')},lil11I={'functionId':illlII[IIIIII(0x116,'[@Sq')]},liiIIi=common['queryStringToObject'](await common[IIIIII(0x22d,'b]BE')](illlII['zuTQH'],iIiIi));break;case'drawShopGift':I1lIi1=illlII[IIIIII(0x145,'X3Bk')],iIiIi={'follow':0x0,'shopId':''['concat']($['shopId']||''),'activityId':''[IIIIII(0x21c,'@fIB')](illlII[IIIIII(0x15f,'XA(X')](lI1liI,'')),'sourceRpc':IIIIII(0x1ff,'KZ@&'),'venderId':''['concat']($[IIIIII(0x1a1,'&5S(')]||'')},lil11I={'functionId':IIIIII(0x195,'(vIz')},liiIIi=common[IIIIII(0x124,'(OHd')](await common[IIIIII(0x182,'YCtJ')](illlII['cItse'],iIiIi));break;default:console[IIIIII(0x15e,'B$e0')](IIIIII(0x191,'[k1P')+ii1iiI);return;}const iil1ll={'url':I1lIi1,'method':Iliii1,'headers':{'Accept':IIIIII(0x10e,'sOQ2'),'Accept-Encoding':illlII[IIIIII(0x144,'!J$c')],'Accept-Language':illlII['DITnA'],'Connection':IIIIII(0x1f2,'Ic5x'),'Content-Type':illlII[IIIIII(0x1de,'YCtJ')],'Cookie':IlIIi,'J-E-H':IlIIl,'J-E-C':lil11i,'Sec-Fetch-Dest':IIIIII(0x22b,'f&yg'),'Sec-Fetch-Mode':IIIIII(0x192,'&03T'),'Sec-Fetch-Site':illlII['zAfhr'],'User-Agent':lil11l,'x-referer-package':'com.360buy.jdmobile','x-rp-client':illlII[IIIIII(0x21f,')u!e')]},'params':lil11I,'data':liiIIi,'timeout':0x7530};illlII[IIIIII(0x1dd,'B$e0')](Iliii1,illlII[IIIIII(0x225,'YCtJ')])&&(delete iil1ll[IIIIII(0x19e,'5KdA')],delete iil1ll['headers'][illlII['eCGHE']]);const iiilil=0x1;let iil1li=0x0,lillIl=null,iIiIl=![];while(iil1li<iiilil){if(illlII['kdDyh']===illlII[IIIIII(0x1a6,'69G8')]){const iiilii=await common[IIIIII(0x11e,'ue6p')](iil1ll);if(!iiilii[IIIIII(0x1af,'!J$c')]){if(illlII[IIIIII(0x1bc,'UXNs')](illlII[IIIIII(0x1f1,'M15%')],IIIIII(0x12e,'rL]w'))){lillIl=IIIIII(0x178,'acMA')+ii1iiI+'\x20请求失败\x20➜\x20'+iiilii['error'],iil1li++;continue;}else{const IlIli1=l1i11I(II11II);IlIli1>0x0&&(lilIli[IIIIII(0x131,'5KdA')]=IlIli1);}}if(!iiilii[IIIIII(0x1f7,'3Cs!')]){lillIl=IIIIII(0x114,'X3Bk')+ii1iiI+IIIIII(0x160,'Ic5x'),iil1li++;continue;}illlII['rQcKu'](lllii,ii1iiI,iiilii[IIIIII(0x1ae,'t0Ha')]),iIiIl=![];break;}else try{const lI1lli=illlII[IIIIII(0x10f,'rL]w')](Iliiii,i1illI);illlII[IIIIII(0x1fa,'@fIB')](lI1lli,0x0)&&(I1lll1[IIIIII(0x1ca,'(OHd')]=lI1lli);}catch{IIII1I[IIIIII(0x157,'etIz')](illlII[IIIIII(0x22c,'(OHd')]);}}iil1li>=iiilil&&(illlII[IIIIII(0x163,'arHI')](IIIIII(0x154,'Kpz4'),illlII[IIIIII(0x1bb,'arHI')])?l1lIil[IIIIII(0x1df,'M15%')](IIIIII(0x1cf,'#suj')):(console['log'](lillIl),iIiIl&&($[IIIIII(0x247,'arHI')]=!![])));}}}var version_ = 'jsjiami.com.v7';
// prettier-ignore
function Env(t,e){"undefined"!=typeof process&&JSON.stringify(process.env).indexOf("GITHUB")>-1&&process.exit(0);class s{constructor(t){this.env=t}send(t,e="GET"){t="string"==typeof t?{url:t}:t;let s=this.get;return"POST"===e&&(s=this.post),new Promise((e,i)=>{s.call(this,t,(t,s,r)=>{t?i(t):e(s)})})}get(t){return this.send.call(this.env,t)}post(t){return this.send.call(this.env,t,"POST")}}return new class{constructor(t,e){this.name=t,this.http=new s(this),this.data=null,this.dataFile="box.dat",this.logs=[],this.isMute=!1,this.isNeedRewrite=!1,this.logSeparator="\n",this.startTime=(new Date).getTime(),Object.assign(this,e),this.log("",`🔔${this.name}, 开始!`)}isNode(){return"undefined"!=typeof module&&!!module.exports}isQuanX(){return"undefined"!=typeof $task}isSurge(){return"undefined"!=typeof $httpClient&&"undefined"==typeof $loon}isLoon(){return"undefined"!=typeof $loon}toObj(t,e=null){try{return JSON.parse(t)}catch{return e}}toStr(t,e=null){try{return JSON.stringify(t)}catch{return e}}getjson(t,e){let s=e;const i=this.getdata(t);if(i)try{s=JSON.parse(this.getdata(t))}catch{}return s}setjson(t,e){try{return this.setdata(JSON.stringify(t),e)}catch{return!1}}getScript(t){return new Promise(e=>{this.get({url:t},(t,s,i)=>e(i))})}runScript(t,e){return new Promise(s=>{let i=this.getdata("@chavy_boxjs_userCfgs.httpapi");i=i?i.replace(/\n/g,"").trim():i;let r=this.getdata("@chavy_boxjs_userCfgs.httpapi_timeout");r=r?1*r:20,r=e&&e.timeout?e.timeout:r;const[o,h]=i.split("@"),n={url:`http://${h}/v1/scripting/evaluate`,body:{script_text:t,mock_type:"cron",timeout:r},headers:{"X-Key":o,Accept:"*/*"}};this.post(n,(t,e,i)=>s(i))}).catch(t=>this.logErr(t))}loaddata(){if(!this.isNode())return{};{this.fs=this.fs?this.fs:require("fs"),this.path=this.path?this.path:require("path");const t=this.path.resolve(this.dataFile),e=this.path.resolve(process.cwd(),this.dataFile),s=this.fs.existsSync(t),i=!s&&this.fs.existsSync(e);if(!s&&!i)return{};{const i=s?t:e;try{return JSON.parse(this.fs.readFileSync(i))}catch(t){return{}}}}}writedata(){if(this.isNode()){this.fs=this.fs?this.fs:require("fs"),this.path=this.path?this.path:require("path");const t=this.path.resolve(this.dataFile),e=this.path.resolve(process.cwd(),this.dataFile),s=this.fs.existsSync(t),i=!s&&this.fs.existsSync(e),r=JSON.stringify(this.data);s?this.fs.writeFileSync(t,r):i?this.fs.writeFileSync(e,r):this.fs.writeFileSync(t,r)}}lodash_get(t,e,s){const i=e.replace(/\[(\d+)\]/g,".$1").split(".");let r=t;for(const t of i)if(r=Object(r)[t],void 0===r)return s;return r}lodash_set(t,e,s){return Object(t)!==t?t:(Array.isArray(e)||(e=e.toString().match(/[^.[\]]+/g)||[]),e.slice(0,-1).reduce((t,s,i)=>Object(t[s])===t[s]?t[s]:t[s]=Math.abs(e[i+1])>>0==+e[i+1]?[]:{},t)[e[e.length-1]]=s,t)}getdata(t){let e=this.getval(t);if(/^@/.test(t)){const[,s,i]=/^@(.*?)\.(.*?)$/.exec(t),r=s?this.getval(s):"";if(r)try{const t=JSON.parse(r);e=t?this.lodash_get(t,i,""):e}catch(t){e=""}}return e}setdata(t,e){let s=!1;if(/^@/.test(e)){const[,i,r]=/^@(.*?)\.(.*?)$/.exec(e),o=this.getval(i),h=i?"null"===o?null:o||"{}":"{}";try{const e=JSON.parse(h);this.lodash_set(e,r,t),s=this.setval(JSON.stringify(e),i)}catch(e){const o={};this.lodash_set(o,r,t),s=this.setval(JSON.stringify(o),i)}}else s=this.setval(t,e);return s}getval(t){return this.isSurge()||this.isLoon()?$persistentStore.read(t):this.isQuanX()?$prefs.valueForKey(t):this.isNode()?(this.data=this.loaddata(),this.data[t]):this.data&&this.data[t]||null}setval(t,e){return this.isSurge()||this.isLoon()?$persistentStore.write(t,e):this.isQuanX()?$prefs.setValueForKey(t,e):this.isNode()?(this.data=this.loaddata(),this.data[e]=t,this.writedata(),!0):this.data&&this.data[e]||null}initGotEnv(t){this.got=this.got?this.got:require("got"),this.cktough=this.cktough?this.cktough:require("tough-cookie"),this.ckjar=this.ckjar?this.ckjar:new this.cktough.CookieJar,t&&(t.headers=t.headers?t.headers:{},void 0===t.headers.Cookie&&void 0===t.cookieJar&&(t.cookieJar=this.ckjar))}get(t,e=(()=>{})){t.headers&&(delete t.headers["Content-Type"],delete t.headers["Content-Length"]),this.isSurge()||this.isLoon()?(this.isSurge()&&this.isNeedRewrite&&(t.headers=t.headers||{},Object.assign(t.headers,{"X-Surge-Skip-Scripting":!1})),$httpClient.get(t,(t,s,i)=>{!t&&s&&(s.body=i,s.statusCode=s.status),e(t,s,i)})):this.isQuanX()?(this.isNeedRewrite&&(t.opts=t.opts||{},Object.assign(t.opts,{hints:!1})),$task.fetch(t).then(t=>{const{statusCode:s,statusCode:i,headers:r,body:o}=t;e(null,{status:s,statusCode:i,headers:r,body:o},o)},t=>e(t))):this.isNode()&&(this.initGotEnv(t),this.got(t).on("redirect",(t,e)=>{try{if(t.headers["set-cookie"]){const s=t.headers["set-cookie"].map(this.cktough.Cookie.parse).toString();s&&this.ckjar.setCookieSync(s,null),e.cookieJar=this.ckjar}}catch(t){this.logErr(t)}}).then(t=>{const{statusCode:s,statusCode:i,headers:r,body:o}=t;e(null,{status:s,statusCode:i,headers:r,body:o},o)},t=>{const{message:s,response:i}=t;e(s,i,i&&i.body)}))}post(t,e=(()=>{})){if(t.body&&t.headers&&!t.headers["Content-Type"]&&(t.headers["Content-Type"]="application/x-www-form-urlencoded"),t.headers&&delete t.headers["Content-Length"],this.isSurge()||this.isLoon())this.isSurge()&&this.isNeedRewrite&&(t.headers=t.headers||{},Object.assign(t.headers,{"X-Surge-Skip-Scripting":!1})),$httpClient.post(t,(t,s,i)=>{!t&&s&&(s.body=i,s.statusCode=s.status),e(t,s,i)});else if(this.isQuanX())t.method="POST",this.isNeedRewrite&&(t.opts=t.opts||{},Object.assign(t.opts,{hints:!1})),$task.fetch(t).then(t=>{const{statusCode:s,statusCode:i,headers:r,body:o}=t;e(null,{status:s,statusCode:i,headers:r,body:o},o)},t=>e(t));else if(this.isNode()){this.initGotEnv(t);const{url:s,...i}=t;this.got.post(s,i).then(t=>{const{statusCode:s,statusCode:i,headers:r,body:o}=t;e(null,{status:s,statusCode:i,headers:r,body:o},o)},t=>{const{message:s,response:i}=t;e(s,i,i&&i.body)})}}time(t,e=null){const s=e?new Date(e):new Date;let i={"M+":s.getMonth()+1,"d+":s.getDate(),"H+":s.getHours(),"m+":s.getMinutes(),"s+":s.getSeconds(),"q+":Math.floor((s.getMonth()+3)/3),S:s.getMilliseconds()};/(y+)/.test(t)&&(t=t.replace(RegExp.$1,(s.getFullYear()+"").substr(4-RegExp.$1.length)));for(let e in i)new RegExp("("+e+")").test(t)&&(t=t.replace(RegExp.$1,1==RegExp.$1.length?i[e]:("00"+i[e]).substr((""+i[e]).length)));return t}msg(e=t,s="",i="",r){const o=t=>{if(!t)return t;if("string"==typeof t)return this.isLoon()?t:this.isQuanX()?{"open-url":t}:this.isSurge()?{url:t}:void 0;if("object"==typeof t){if(this.isLoon()){let e=t.openUrl||t.url||t["open-url"],s=t.mediaUrl||t["media-url"];return{openUrl:e,mediaUrl:s}}if(this.isQuanX()){let e=t["open-url"]||t.url||t.openUrl,s=t["media-url"]||t.mediaUrl;return{"open-url":e,"media-url":s}}if(this.isSurge()){let e=t.url||t.openUrl||t["open-url"];return{url:e}}}};if(this.isMute||(this.isSurge()||this.isLoon()?$notification.post(e,s,i,o(r)):this.isQuanX()&&$notify(e,s,i,o(r))),!this.isMuteLog){let t=["","==============📣系统通知📣=============="];t.push(e),s&&t.push(s),i&&t.push(i),console.log(t.join("\n")),this.logs=this.logs.concat(t)}}log(...t){t.length>0&&(this.logs=[...this.logs,...t]),console.log(t.join(this.logSeparator))}logErr(t,e){const s=!this.isSurge()&&!this.isQuanX()&&!this.isLoon();s?this.log("",`❗️${this.name}, 错误!`,t.stack):this.log("",`❗️${this.name}, 错误!`,t)}wait(t){return new Promise(e=>setTimeout(e,t))}done(t={}){const e=(new Date).getTime(),s=(e-this.startTime)/1e3;this.log("",`🔔${this.name}, 结束! 🕛 ${s} 秒`),this.log(),(this.isSurge()||this.isQuanX()||this.isLoon())&&$done(t)}}(t,e)}
